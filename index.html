<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-1540370877163743">
    <title>Ethiofly - Compare & Book Cheap Flights from Ethiopia</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="https://i.postimg.cc/L6sR9Bvr/20260110-010256.png" type="image/png">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script data-noptimize="1" data-cfasync="false" data-wpfc-render="false">
  (function () {
      var script = document.createElement("script");
      script.async = 1;
      script.src = 'https://emrld.cc/NDg2MjA5.js?t=486209';
      document.head.appendChild(script);
  })();
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1540370877163743"
     crossorigin="anonymous"></script>
     <script async src="https://www.googletagmanager.com/gtag/js?id=G-J088RBW7LG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-J088RBW7LG');
</script>
    <style>
        /* ============================================
           Ethiofly - Complete CSS Styles
           ============================================ */
        
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --light: #f9fafb;
            --dark: #1f2937;
            --gray: #6b7280;
            --gray-light: #e5e7eb;
            --shadow: 0 3px 6px rgba(2,6,23,0.04);
            --shadow-lg: 0 8px 20px rgba(2,6,23,0.06);
            --radius: 10px;
            --radius-sm: 6px;
        }

       /* ðŸŒˆ GLOBAL APP BACKGROUND */
        body {
            background:
                radial-gradient(circle at top left, rgba(37,99,235,0.12), transparent 40%),
                radial-gradient(circle at bottom right, rgba(16,185,129,0.12), transparent 40%),
                linear-gradient(180deg, #f8fafc, #eef2ff);
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }

        /* Header & Navigation */
        .header {
            background: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .logo-img {
            height: 36px;
            width: auto;
            object-fit: contain;
        }

        /* Make all images scale with their container */
        img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        .logo h1 {
            color: var(--primary);
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--info));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            white-space: nowrap;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            flex: 1;
        }

        .nav-center {
            margin: 0 auto;
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        /* Hamburger (hidden on desktop) */
        .hamburger {
            display: none;
            background: transparent;
            border: none;
            font-size: 1.25rem;
            color: var(--dark);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
        }

        /* Mobile / Tablet styles for navigation */
        @media (max-width: 900px) {
            .hamburger { display: block; }

            .nav-links {
                display: none;
                position: fixed;
                top: 64px;
                right: 0;
                width: 100%;
                height: calc(100% - 64px);
                background: white;
                flex-direction: column;
                align-items: flex-start;
                padding: 1.25rem;
                gap: 0.75rem;
                overflow-y: auto;
                box-shadow: var(--shadow-lg);
                z-index: 2000;
            }

            .nav-links.open { display: flex; }

            .nav-link { width: 100%; padding: 0.75rem 1rem; font-size: 1.05rem; border-radius: 8px; }

            .logo h1 { font-size: 1.1rem; }

            .navbar { padding: 0.75rem 1rem; }

            /* Make dropdowns span the menu width on mobile */
            .currency-dropdown { right: 1rem; left: 1rem; min-width: auto; width: calc(100% - 2rem); }
            .user-dropdown { right: 1rem; left: 1rem; min-width: auto; width: calc(100% - 2rem); }

            /* Make header not overly tall */
            .header { padding-bottom: 0; }
        }

        .nav-link {
            text-decoration: none;
            color: var(--gray);
            font-weight: 500;
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
            font-size: 0.9rem;
        }

        .nav-link:hover,
        .nav-link.active {
            background: var(--light);
            color: var(--primary);
        }
.flight-filters {
    display: flex;
    gap: 10px;
    margin: 20px 0;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 8px 16px;
    border: 2px solid #e0e0e0;
    background: white;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
}

.filter-btn:hover {
    border-color: #3498db;
    background: #f0f7ff;
}

.filter-btn.active {
    background: #3498db;
    color: white;
    border-color: #3498db;
}

.no-flights {
    text-align: center;
    padding: 40px;
    color: #666;
}

.no-flights i {
    font-size: 48px;
    color: #ccc;
    margin-bottom: 15px;
}

.no-flights h3 {
    margin: 10px 0;
    color: #333;
}
        /* Currency Selector */
        .currency-selector {
            position: relative;
        }

        .currency-btn {
            background: var(--light);
            border: 2px solid var(--gray-light);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            font-size: 0.85rem;
            color: var(--dark);
            font-weight: 500;
        }

        .currency-btn:hover {
            background: var(--gray-light);
        }

        .currency-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
            padding: 0.5rem 0;
            min-width: 220px;
            display: none;
            z-index: 1001;
            max-height: 350px;
            overflow-y: auto;
        }

        .currency-selector:hover .currency-dropdown {
            display: block;
        }

        .currency-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 0.9rem;
        }

        .currency-option:hover {
            background: var(--light);
        }

        .currency-option.active {
            background: var(--light);
            color: var(--primary);
            font-weight: 600;
        }

        .currency-symbol {
            width: 30px;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .currency-code {
            font-weight: 600;
            min-width: 60px;
        }

        .currency-name {
            color: var(--gray);
            font-size: 0.85rem;
        }

        .deal-badge {
            position: relative;
        }

        .badge-new {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
        }

        /* User Menu */
        .user-menu {
            position: relative;
        }

        .user-btn {
            background: var(--light);
            border: 2px solid var(--gray-light);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            font-size: 0.85rem;
            color: var(--dark);
        }

        .user-btn:hover {
            background: var(--gray-light);
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
            padding: 0.5rem 0;
            min-width: 200px;
            display: none;
            z-index: 1000;
        }

        .user-menu:hover .user-dropdown {
            display: block;
        }

        .user-dropdown a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            text-decoration: none;
            color: var(--gray);
            transition: background 0.3s;
            font-size: 0.9rem;
        }

        .user-dropdown a:hover {
            background: var(--light);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--gray-light);
            margin: 0.5rem 0;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 1.5rem auto;
            padding: 0 1.5rem;
        }

        /* Page Sections */
        .page-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.9), rgba(59, 130, 246, 0.8)),
                        url('https://images.unsplash.com/photo-1436491865332-7a61a109cc05?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80') center/cover;
            border-radius: var(--radius);
            padding: 3rem 1.5rem;
            text-align: center;
            color: white;
            margin-bottom: 2rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 1.5rem;
            line-height: 1.5;
        }

        /* Search Container */
      /* Updated Search Container Background */
.search-container {
    background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
    border-radius: var(--radius);
    padding: 1.5rem;
    box-shadow: var(--shadow-lg);
    margin-bottom: 2rem;
}

/* Search Form - Single Line Layout */
.search-form {
    background: white;
    border-radius: 12px;
    padding: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
    position: relative;
}

/* Make individual fields flexible and responsive */
.search-form .form-group { flex: 1 1 180px; min-width: 120px; }
.search-form .swap-btn { flex: 0 0 auto; display:flex; align-items:center; justify-content:center; }
.search-form .passenger-input { min-width: 170px; }

@media (max-width: 768px) {
    .search-form { padding: 1rem; gap: 0.5rem; }
    .search-form .form-group { flex: 1 1 100%; min-width: 0; }
    .search-form .swap-btn { order: 2; margin: 0.5rem 0; }
} 
 /* Flight Segments */
        .flight-segments {
            margin: 20px 0;
        }
        
        .segments-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-weight: 300;
            color: var(--dark);
        }
        
        .segments-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .segment-item {
            display: flex;
            gap: 16px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .segment-number {
            width: 14px;
            height: 14px;
            background: var(--light);
            color: var(--dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 300;
            flex-shrink: 0;
        }
        
        .segment-details {
            flex: 1;
        }
        
        .segment-route {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .segment-from, .segment-to {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .segment-info {
            display: flex;
            gap: 16px;
            margin-bottom: 8px;
            font-size: 12px;
            color: var(--gray);
        }
        
        .segment-times {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--gray);
        }
/* Real Stop Details */
        .real-stop-details {
            margin-bottom: 20px;
        }
        
        .stop-details-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .stop-title {
            font-weight: 600;
            color: var(--dark);
        }
        
        .total-layover {
            margin-left: auto;
            font-size: 14px;
            color: var(--gray);
        }
        
        .stops-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .stop-item {
            display: flex;
            gap: 16px;
            padding: 16px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .stop-number {
            width: 32px;
            height: 32px;
            background: var(--info);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .stop-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .stop-location {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .stop-city-country {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }
        
        .stop-city {
            font-size: 16px;
            color: var(--dark);
        }
        
        .stop-country {
            font-size: 12px;
            color: var(--gray);
        }
        
        .stop-airport {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }
        
        .stop-code {
            font-weight: 600;
            color: var(--primary);
            font-size: 14px;
        }
        
        .stop-name {
            font-size: 13px;
            color: var(--gray);
        }
        
        .stop-terminal {
            font-size: 12px;
            color: var(--gray);
            background: #f8fafc;
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .stop-timing {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .stop-arrival, .stop-departure {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
  .stop-cities-info {
            margin-top: 8px;
            padding: 8px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .stop-cities-label {
            font-size: 11px;
            color: var(--gray);
            margin-bottom: 4px;
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .stop-cities-list {
            font-size: 13px;
            color: var(--dark);
            font-weight: 500;
        }
        
        .btn-show-stop-details {
            margin-top: 12px;
            background: none;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        
        .btn-show-stop-details:hover {
            background: var(--primary);
            color: white;
        }
        
        .stop-details-panel {
            margin-top: 20px;
            padding: 16px;
            border-top: 1px solid #e5e7eb;
            background: #f8fafc;
            border-radius: 8px;
        }
        
 /* Footer */
        .footer {
            background: var(--dark);
            color: white;
            margin-top: 3rem;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2.5rem 1.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 2.5rem;
        }

        .footer-section h4 {
            font-size: 1.1rem;
            margin-bottom: 1.25rem;
            color: var(--gray-light);
        }

        .footer-section a {
            display: block;
            color: #9ca3af;
            text-decoration: none;
            margin-bottom: 0.75rem;
            transition: color 0.3s;
            font-size: 0.9rem;
        }

        .footer-section a:hover {
            color: white;
        }

        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-links a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .social-links a:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }

        .footer-bottom {
            text-align: center;
            padding: 1.25rem;
            border-top: 1px solid #374151;
            color: #9ca3af;
            font-size: 0.9rem;
        }


/* Stop Information Styles */
.flight-stop-center {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    padding: 1rem;
    min-width: 200px;
}

.flight-route-line {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    opacity: 0.2;
    z-index: 1;
}

.stop-info-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: white;
    border-radius: 12px;
    border: 1px solid rgba(37, 99, 235, 0.1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    z-index: 2;
    position: relative;
    min-width: 180px;
}

.duration-section {
    text-align: center;
}

.duration-text {
    font-size: 0.85rem;
    color: var(--gray);
    margin-bottom: 0.25rem;
}

.duration-value {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--dark);
}

.stop-badge-container {
    margin: 0.5rem 0;
}

.nonstop-badge {
    background: linear-gradient(135deg, var(--secondary), #0d966e);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.stop-badge {
    background: linear-gradient(135deg, var(--warning), #d97706);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.multi-stop-badge {
    background: linear-gradient(135deg, var(--danger), #dc2626);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

/* Layover Information */
.layover-section {
    background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.05));
    border-radius: 8px;
    padding: 0.75rem;
    border: 1px solid rgba(245, 158, 11, 0.2);
    margin-top: 0.5rem;
    text-align: center;
    min-width: 160px;
}

.layover-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(245, 158, 11, 0.1);
}

.layover-duration {
    font-size: 0.85rem;
    color: var(--warning);
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-weight: 600;
}

.layover-badge {
    background: var(--warning);
    color: white;
    font-size: 0.7rem;
    padding: 0.15rem 0.5rem;
    border-radius: 4px;
    font-weight: 600;
}

.layover-details {
    font-size: 0.9rem;
}

.layover-city {
    font-weight: 600;
    color: var(--dark);
    margin-bottom: 0.25rem;
}

.layover-code {
    font-size: 0.85rem;
    color: var(--primary);
    font-weight: 600;
}
/* Book Now Button Styles */
.btn-select-flight {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    margin-top: 10px;
    font-size: 14px;
}

.btn-select-flight:hover {
    background: linear-gradient(135deg, #059669, #047857);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
}

.btn-select-flight:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none !important;
}

/* Price display */
.price-with-currency {
    text-align: center;
    margin-bottom: 10px;
}

.currency-symbol-large {
    font-size: 18px;
    font-weight: 600;
    color: var(--primary);
    margin-right: 4px;
}

.price-amount-large {
    font-size: 22px;
    font-weight: 700;
    color: var(--dark);
    line-height: 1;
}

.per-person {
    font-size: 12px;
    color: var(--gray);
    margin-top: 4px;
}

.price-original {
    font-size: 11px;
    color: var(--gray);
    text-decoration: line-through;
    margin-top: 2px;
}
.layover-terminal {
    font-size: 0.8rem;
    color: var(--gray);
    margin-top: 0.25rem;
}

/* Connection Indicator */
.flight-connection {
    position: relative;
    width: 100%;
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px dashed rgba(37, 99, 235, 0.2);
}
.flight-line {
    display: grid;
    grid-template-columns: 1fr auto 1fr; /* Departure | Center | Arrival */
    align-items: center; 
}
.flight-stop-center {
    text-align: center;
}

.connection-line {
    position: absolute;
    top: -1px;
    left: 0;
    right: 0;
    height: 1px;
    background: repeating-linear-gradient(
        90deg,
        transparent,
        transparent 5px,
        var(--primary) 5px,
        var(--primary) 10px
    );
}

.connection-dot {
    width: 8px;
    height: 8px;
    background: var(--primary);
    border-radius: 50%;
    position: absolute;
    top: -4px;
    left: 50%;
    transform: translateX(-50%);
}

.connection-text {
    text-align: center;
    font-size: 0.75rem;
    color: var(--gray);
    margin-top: 0.5rem;
}

/* Flight Info Summary */
.flight-info-summary {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 1.5rem;
    margin: 1.5rem 0;
    padding: 1.5rem;
    background: linear-gradient(135deg, #f8fafc, #eef2ff);
    border-radius: 12px;
    border: 1px solid #e5e7eb;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.info-label {
    font-size: 0.85rem;
    color: var(--gray);
    font-weight: 500;
}

.info-value {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--dark);
}

.eco-badge {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
    color: var(--secondary);
    padding: 0.75rem 1rem;
    border-radius: 8px;
    border: 1px solid rgba(16, 185, 129, 0.2);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.25rem;
    min-width: 180px;
}

.eco-badge i {
    font-size: 1.2rem;
    margin-bottom: 0.25rem;
}

.eco-badge span {
    font-weight: 600;
    font-size: 0.9rem;
}

.eco-subtext {
    font-size: 0.75rem;
    opacity: 0.8;
    text-align: center;
}

/* Compare Deals */
.compare-deals-container {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    margin: 1.5rem 0;
    border: 1px solid #e5e7eb;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
}

.compare-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e5e7eb;
}

.compare-header h3 {
    font-size: 1.1rem;
    color: var(--dark);
    font-weight: 600;
}

.best-total-fare {
    text-align: right;
}

.best-label {
    font-size: 0.85rem;
    color: var(--gray);
    margin-bottom: 0.25rem;
}

.best-price {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--secondary);
}

.deals-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.deal-card {
    background: white;
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid #e5e7eb;
    transition: all 0.3s;
}

.deal-card:hover {
    border-color: var(--primary);
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
}

.deal-card.best-value {
    border: 2px solid var(--secondary);
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.02), white);
}

.deal-provider {
    font-size: 0.9rem;
    color: var(--gray);
    margin-bottom: 0.5rem;
}

.deal-badge {
    background: linear-gradient(135deg, var(--info), #2563eb);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    display: inline-block;
}

.deal-card.best-value .deal-badge {
    background: linear-gradient(135deg, var(--secondary), #0d966e);
}

.deal-price {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--dark);
    margin: 0.5rem 0;
}

.deal-total {
    font-size: 0.85rem;
    color: var(--gray);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .flight-info-summary {
        grid-template-columns: 1fr;
    }
    
    .deals-grid {
        grid-template-columns: 1fr;
    }
    
    .flight-stop-center {
        min-width: 160px;
    }
    
    .stop-info-container {
        min-width: 140px;
        padding: 0.75rem;
    }
}

/* Single Line Form Row */
.form-row {
    display: flex;
    flex: 1;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
}

/* Compact Form Groups */
.form-group {
    position: relative;
    flex: 1;
    min-width: 150px;
}

/* Icon inside inputs */
.form-group .input-icon {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--primary);
    font-size: 0.95rem;
    pointer-events: none;
    opacity: 0.95;
}

.form-group input {
    padding-right: 2.75rem; /* make space for input icon */
}

.form-group label {
    display: none; /* Hide labels for compact layout */
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid var(--gray-light);
    border-radius: 8px;
    font-size: 0.95rem;
    transition: all 0.3s;
    font-family: inherit;
    background: white;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

/* Compact Passenger Selector */
.passengers-selector {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border-radius: 12px;
    padding: 1rem;
    box-shadow: var(--shadow-lg);
    border: 2px solid var(--gray-light);
    z-index: 1000;
    display: none;
}

.passengers-selector.show {
    display: block;
    animation: slideDown 0.3s ease;
}

.passenger-type {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.passenger-type:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}

.passenger-label {
    font-weight: 500;
    color: var(--dark);
    font-size: 0.9rem;
    flex: 1;
}

.passenger-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.passenger-controls button {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 2px solid var(--gray-light);
    background: white;
    color: var(--gray);
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.passenger-controls button:hover {
    border-color: var(--primary);
    color: var(--primary);
    background: var(--light);
}

.passenger-controls button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.passenger-controls input {
    width: 40px;
    text-align: center;
    border: 2px solid var(--gray-light);
    border-radius: 6px;
    padding: 0.4rem;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--dark);
    background: white;
}

.passenger-summary {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid var(--gray-light);
    text-align: center;
    font-weight: 600;
    color: var(--primary);
    font-size: 0.85rem;
    line-height: 1.4;
}

/* Swap Button - Positioned between From and To fields */
.swap-btn {
    position: relative;
    height: 100%;
    display: flex;
    align-items: center;
    margin: 0 -10px; /* Negative margin to overlap slightly */
    z-index: 2;
}

.swap-btn button {
    background: white;
    border: 2px solid var(--gray-light);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--gray);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.swap-btn button:hover {
    background: var(--primary);
    color: white;
    transform: rotate(180deg) scale(1.1);
    border-color: var(--primary);
    box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
}

/* Alternative: Absolute positioning */
.swap-btn-alt {
    position: absolute;
    left: calc(50% - 18px);
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
}

/* Or inline positioning with the fields */
.search-fields-container {
    display: flex;
    flex: 1;
    gap: 0;
    align-items: center;
    flex-wrap: wrap;
    position: relative;
}

.search-fields-container .form-group {
    flex: 1;
    min-width: 150px;
}

/* Make swap button appear between fields */
.search-fields-container .form-group:nth-child(1),
.search-fields-container .form-group:nth-child(3) {
    position: relative;
}

.swap-btn-between {
    order: 2; /* Place between first and third form-group */
    margin: 0 -12px; /* Pull it into the space between fields */
}

/* Form Actions - Now in line */
.form-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.btn-search {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    border: none;
    padding: 0.875rem 1.75rem;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: inherit;
    white-space: nowrap;
}

.btn-search:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
}

/* Checkbox in line */
.checkbox {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    user-select: none;
    font-size: 0.9rem;
    color: white;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    margin-left: auto;
}

.checkbox input[type="checkbox"] {
    width: auto;
    margin: 0;
}

/* Date Input Icons */
.date-input-wrapper {
    position: relative;
    flex: 1;
}

.date-input-wrapper input {
    padding-left: 2.5rem !important;
}

.date-input-wrapper::before {
    content: 'ðŸ“…';
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1rem;
    z-index: 1;
}

/* Passenger Input Styling */
.passenger-input {
    background: white;
    border: 2px solid var(--gray-light);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    font-size: 0.95rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-width: 180px;
}

.passenger-input:hover {
    border-color: var(--primary);
}

.passenger-display {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--dark);
    font-weight: 500;
}

.passenger-display i {
    color: var(--gray);
}

/* Checkbox on LEFT side */
.checkbox-left {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    user-select: none;
    font-size: 0.9rem;
    color: white;
    background: rgba(255, 255, 255, 0.1);
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    transition: background 0.3s;
    order: 1; /* First item */
    margin-right: auto; /* Push everything else to right */
}

.checkbox-left:hover {
    background: rgba(255, 255, 255, 0.2);
}

.checkbox-left input[type="checkbox"] {
    width: auto;
    margin: 0;
}


/* Direct flights checkbox (LEFT) */
.checkbox-left {
    order: 1;
    flex: 0 0 auto;
    margin-right: auto;
}


/* Search Tabs Styling */
.search-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.25rem;
    flex-wrap: wrap;
}

.search-tab {
    padding: 0.6rem 1.25rem;
    border: none;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s;
    font-family: inherit;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    color: white;
}

.search-tab.active {
    background: white;
    color: var(--primary);
}

.search-tab:hover:not(.active) {
    background: rgba(255, 255, 255, 0.3);
}

/* Responsive Design for Single Line */
@media (max-width: 1200px) {
    .form-row { flex-wrap: wrap; }
    .form-group { min-width: calc(33.333% - 0.5rem); }
    .passenger-input { min-width: 160px; }
}

@media (max-width: 768px) {
    .search-form { flex-direction: column; align-items: stretch; gap: 0.75rem; }

    .search-tabs { display: flex; gap: 0.5rem; padding: 6px; background: rgba(16,185,129,0.06); border-radius: 12px; }
    .search-tab { background: transparent; color: var(--dark); border-radius: 9999px; padding: 0.5rem 0.85rem; font-size: 0.95rem; }
    .search-tab.active { background: white; color: var(--primary-dark); box-shadow: var(--shadow); }

    .form-row { flex-direction: column; gap: 0.9rem; }
    .form-group { min-width: 100%; }

    .input-with-icon input { height: 56px; padding: 14px 44px 14px 16px; border-radius: 12px; background: #eef6f1; border: none; font-size: 1rem; }
    .input-with-icon .input-icon { right: 14px; color: #6b7280; }

    .swap-btn { display: none; }

    .btn-search { margin-left: 0 !important; display: block; width: 100%; background: #14532d; color: #fff; height: 56px; border-radius: 12px; font-weight: 700; font-size: 1.05rem; border: none; }

    .form-actions { flex-direction: column; width: 100%; }

    .checkbox { margin-left: 0; justify-content: flex-start; }

    /* Give page content space for fixed bottom nav */
    .main-container { padding-bottom: 92px; }
}

/* Extra small phones */
@media (max-width: 420px) {
    .input-with-icon input { height: 56px; font-size: 0.98rem; }
    .search-tabs { padding: 5px; }
    .hero { padding: 2rem 1rem; }
}   

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-family: inherit;
            text-decoration: none;
            font-size: 0.9rem;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--info));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--gray);
            border: 2px solid var(--gray-light);
        }

        .btn-secondary:hover {
            background: var(--gray-light);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-select-flight {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            width: 100%;
            justify-content: center;
        }

        .btn-select-flight:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* Per Person Price */
        .per-person {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 0.25rem;
            text-align: center;
        }

        /* Search Results */
        .results-container {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
        }

        .results-header {
            background: white;
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .results-stats {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .stat-item i {
            color: var(--primary);
            font-size: 1rem;
        }

        .currency-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: auto;
            padding: 0.5rem 1rem;
            background: var(--light);
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
        }

        .currency-display .currency-symbol {
            color: var(--primary);
            font-weight: bold;
        }

        .filters {
            background: var(--light);
            border-radius: 8px;
            padding: 0.6rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.6rem;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .filter-group select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--gray-light);
            border-radius: 6px;
            background: white;
            font-size: 0.9rem;
        }

        .airline-filters {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .airline-filters label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* Quick Filters */
        .quick-filters {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .quick-filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-light);
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            min-width: 120px;
            justify-content: center;
        }

        .quick-filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .quick-filter-btn:hover:not(.active) {
            background: var(--light);
        }

        /* Enhanced Flight Cards â€“ Premium Look */
/* ================================
   COMPACT FLIGHT CARD â€“ ALL IN ONE
   ================================ */

.flight-card {
    background: #ffffff;
    border: 1px solid #eef2f6;
    border-radius: 10px;
    padding: 0.6rem;
    margin-bottom: 0.6rem;
    font-size: 0.92rem;
    color: #0f172a;
    position: relative;
    overflow: visible;
    box-shadow: var(--shadow);
    transition: transform 0.18s ease, box-shadow 0.18s ease;
    cursor: pointer;
}

.flight-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

/* remove strong top accent for subtle look */
.flight-card::before { display: none; }

/* Header */
.flight-header { padding: 0.25rem 0.4rem; gap: 0.6rem; align-items: center; }

.header-price { margin-left: auto; text-align: right; }
.header-price-amount { font-size: 1.2rem; font-weight: 800; color: #0f172a; }
.header-badge { font-size: 0.66rem; color: #065f46; background: #d1fae5; padding: 4px 8px; border-radius: 999px; display:inline-block; margin-top:6px; }

/* Flight details â€“ three columns with center timeline */
.flight-details-grid {
    display: grid;
    grid-template-columns: 1fr 80px 1fr;
    gap: 0.4rem;
    padding: 0.25rem 0;
    align-items: center;
}

.flight-time-block { background: transparent; padding: 0; border-radius: 6px; text-align: left; }

.time-large { font-size: 2rem; font-weight: 800; color: #1f2d78; }
.airport-code { font-size: 1rem; font-weight: 800; color: #0f172a; margin-top: 6px; }
.airport-name, .flight-date { font-size: 0.78rem; color: #64748b; }
/* Center timeline */
.flight-stop-center { display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px; }
.flight-route-line { width: 100%; height: 3px; background: linear-gradient(90deg,#e6eef9,#eef2f6); border-radius: 6px; position: relative; }
.flight-route-line::before { content: '\2708'; /* airplane glyph */
    position: absolute; left: 50%; top: -12px; transform: translateX(-50%); background: #ffffff; color: #1f2d78; font-size: 18px; padding: 6px; border-radius: 50%; box-shadow: 0 6px 18px rgba(31,45,120,0.06); }
.duration-section { text-align:center; }
.duration-text { font-size: 0.64rem; color: #94a3b8; }
.duration-value { font-size: 0.82rem; color: #06b37d; font-weight:700; margin-top:2px; }
.stop-badge-container .nonstop-badge, .stop-badge-container .stop-badge, .stop-badge-container .multi-stop-badge { font-size: 0.75rem; padding: 6px 10px; border-radius: 999px; display:inline-flex; align-items:center; gap:8px; background: #eef2f6; color: #0f172a; }

.layover-badge { display:inline-block; background:#eef2ff; color:#1f2d78; padding:6px 10px; border-radius:8px; font-weight:700; font-size:0.76rem; box-shadow: 0 4px 10px rgba(31,45,120,0.04); }


/* Price & Select */
.flight-price-section { grid-column: 1 / -1; margin-top: 6px; padding: 0; background: transparent; }
.btn-select-flight { background: linear-gradient(135deg, #06b37d, #059669); color: white; border: none; padding: 10px 12px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.18s; display: block; width: 100%; font-size: 14px; box-shadow: 0 6px 18px rgba(5,150,105,0.10); }
.btn-select-flight:hover { transform: translateY(-1px); box-shadow: 0 10px 24px rgba(5,150,105,0.12); }

/* Quick filters responsive horizontal scroller */
.quick-filters { display:flex; gap:0.6rem; margin-bottom: 1rem; overflow-x:auto; padding-bottom:6px; -webkit-overflow-scrolling:touch; }
.quick-filters::-webkit-scrollbar { display: none; }
.quick-filter-btn { flex: 0 0 auto; min-width: 110px; border-radius: 999px; }

/* Results footer */
.results-footer { text-align:center; margin-top: 14px; }
.results-count { color: #94a3b8; font-size: 0.9rem; }

        /* Two-column search layout */
        .search-layout {
            display: grid;
            grid-template-columns: 220px 1fr;
            gap: 12px;
            align-items: start;
        }

        .sidebar {
            background: linear-gradient(180deg,#cfe7ff,#dff5ff);
            border-radius: 6px;
            padding: 9px;
            height: fit-content;
        }

        .sidebar .filter-card {
            background: white;
            border-radius: 5px;
            padding: 6px;
            margin-bottom: 12px;
            box-shadow: var(--shadow);
        }

        .sidebar h3 {
            font-size: 1rem;
            color: #0f172a;
            margin-bottom: 8px;
        }

        /* Make the main results area match screenshot spacing */
        .main-results { padding: 6px 0; }

        /* Price box on the right of each card */
        .flight-card { display: grid; grid-template-columns: 1fr 220px; gap: 16px; align-items: center; }
        .flight-card .flight-details-grid { grid-column: 1 / 2; }
        .flight-card .flight-price-section { grid-column: 2 / 3; margin-top: 0; }
        .flight-price-section { text-align: right; }
        .header-price-amount { color: #059669; font-size: 1.25rem; }
        .btn-select-flight { width: 100%; padding: 10px 12px; border-radius: 8px; }

        /* Sidebar responsive collapse */
        @media (max-width: 900px) {
            .search-layout { grid-template-columns: 1fr; }
            .sidebar { order: 2; }
            .main-results { order: 1; }
            .flight-card { grid-template-columns: 1fr; }
            .flight-card .flight-price-section { grid-column: 1 / -1; text-align: left; }
        }

/* Small screen tweaks (center header and tabs) */
@media (max-width: 480px) {
    .results-header { justify-content: center; text-align:center; }
    .results-header button#backToSearch { position:absolute; left: 14px; top: 18px; }
}

/* Featured / Best Deal styling
   Use an in-card badge instead of a large rotated ribbon that disrupts layout */
.flight-card.featured {
    background: linear-gradient(180deg,#ffffff,#f8fafc);
    border: 1px solid rgba(34,197,94,0.06);
}

/* Hide legacy rotated ribbon (caused layout issues for some cards) */
.flight-card.featured::after { display: none; }

/* In-card best-deal badge (renders inside card content) */
.best-deal-banner {
    position: absolute;
    left: 12px;
    top: 12px;
    background: #22c55e;
    color: #fff;
    font-size: 0.72rem;
    padding: 6px 10px;
    border-radius: 8px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 6px 14px rgba(34,197,94,0.08);
}

/* ================= HEADER ================= */
.flight-header {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    gap: 0.75rem;
    padding-bottom: 0.35rem;
    margin-bottom: 0.35rem;
    border-bottom: 1px solid #f1f5f9;
}

.header-price {
    margin-left: auto;
    text-align: right;
}

.header-price-amount { font-size: 1rem; font-weight: 700; color: var(--dark); }
.header-badge { font-size: 0.7rem; color: #065f46; background: #d1fae5; padding: 3px 8px; border-radius: 8px; display:inline-block; margin-top:4px; }

.airline {
    display: flex;
    align-items: center;
    gap: 0.4rem;
}

.airline-logo-container {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    background: #fff;
    border: 1px solid #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: center;
}

.airline-logo-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.airline-name {
    font-size: 0.8rem;
    font-weight: 600;
}

.flight-class-badge {
    font-size: 0.7rem;
    background: #f1f5f9;
    padding: 2px 6px;
    border-radius: 4px;
}

/* ================= DETAILS ================= */
.flight-details-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.4rem;
    padding: 0.3rem 0;
}

.flight-time-block,
.flight-duration-block {
    background: #f8fafc;
    padding: 0.35rem;
    border-radius: 6px;
    text-align: center;
}

.time-large {
    font-size: 1.05rem;
    font-weight: 700;
}

.airport-code {
    font-size: 0.85rem;
    font-weight: 600;
    color: #2563eb;
}

.airport-name,
.flight-date,
.duration-text {
    font-size: 0.65rem;
    color: #64748b;
}

.duration-value {
    font-size: 0.9rem;
    font-weight: 600;
}

.flight-stops {
    font-size: 0.7rem;
    color: #16a34a;
}

/* ================= PRICE ================= */
.flight-price-section {
    margin-top: 0.35rem;
    padding: 0.45rem;
    background: linear-gradient(
        135deg,
        rgba(37, 99, 235, 0.05),
        rgba(16, 185, 129, 0.05)
    );
    border-radius: 8px;
    text-align: center;
}

.price-amount-large {
    font-size: 1.2rem;
    font-weight: 700;
    color: #16a34a;
}

.price-original {
    font-size: 0.7rem;
    color: #94a3b8;
    text-decoration: line-through;
}

.conversion-note {
    font-size: 0.6rem;
    color: #64748b;
}

/* ================= ACTIONS ================= */
.flight-actions {
    margin-top: 0.35rem;
    padding-top: 0.35rem;
    border-top: 1px solid #f1f5f9;
    display: flex;
    gap: 0.4rem;
}

        .flight-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray);
            font-size: 0.85rem;
        }

        .meta-item i {
            color: var(--primary);
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Price Breakdown */
        .price-breakdown {
            background: var(--light);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .price-breakdown.show {
            display: block;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .breakdown-header {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--dark);
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--gray-light);
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .breakdown-item:last-child {
            border-bottom: none;
        }

        .breakdown-item.subtotal {
            border-top: 1px solid var(--gray-light);
            margin-top: 0.5rem;
            padding-top: 0.75rem;
            font-weight: 600;
            color: var(--dark);
        }

        .breakdown-item.total {
            border-top: 2px solid var(--gray-light);
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            font-weight: 700;
            color: var(--primary);
            font-size: 1rem;
        }

        /* Price Change Indicators */
        .price-change {
            font-size: 0.8rem;
            font-weight: 500;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            margin-left: 0.5rem;
        }

        .price-change.up {
            color: #059669;
            background: rgba(5, 150, 105, 0.1);
        }

        .price-change.down {
            color: #dc2626;
            background: rgba(220, 38, 38, 0.1);
        }

        /* No Results */
        .no-results-enhanced {
            text-align: center;
            padding: 3rem 1.5rem;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow);
        }

        .no-results-icon {
            font-size: 3rem;
            color: var(--gray-light);
            margin-bottom: 1.5rem;
        }

        /* Currency Disclaimer */
        .currency-disclaimer {
            margin-top: 2rem;
            padding: 1.25rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(16, 185, 129, 0.05));
            border-radius: 12px;
            border: 1px solid rgba(59, 130, 246, 0.1);
            text-align: center;
        }

        /* Popular Destinations */
        .popular-destinations {
            margin-top: 3rem;
        }

        .destinations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .destination-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            cursor: pointer;
        }

        .destination-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .destination-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .destination-info {
            padding: 1.25rem;
        }

        .destination-info h4 {
            margin-bottom: 0.5rem;
            color: var(--dark);
            font-size: 1.1rem;
        }

        /* Loading Animation */
        .loading-flights {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
        }

        .flight-card-skeleton {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--gray);
            text-align: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-light);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Airport Suggestions */
        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius-sm);
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .suggestion-item {
            padding: 0.8rem;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .suggestion-item:hover {
            background: var(--light);
        }

        .suggestion-code {
            background: var(--primary);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .suggestion-details {
            flex: 1;
        }

        .suggestion-city {
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        .suggestion-name {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .suggestion-country {
            font-size: 0.75rem;
            color: var(--gray);
            margin-top: 0.1rem;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: var(--radius-sm);
            padding: 1rem 1.25rem;
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            animation: slideInRight 0.3s ease;
            max-width: 350px;
            border-left: 4px solid var(--info);
        }
   
        .notification.success {
            border-left-color: var(--secondary);
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-content i {
            font-size: 1.2rem;
        }

        .notification.success .notification-content i {
            color: var(--secondary);
        }

        .notification.error .notification-content i {
            color: var(--danger);
        }

        .notification.warning .notification-content i {
            color: var(--warning);
        }

        .notification-content span {
            flex: 1;
            font-size: 0.9rem;
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            line-height: 1;
            padding: 0 0.3rem;
        }

        .notification-close:hover {
            color: var(--dark);
        }
      .return-row {
  display: grid;
  grid-template-columns: 1fr 1.2fr 1fr;
  align-items: center;
  padding: 20px 0;
  border-top: 1px solid #eef1f4;
}

.return-block {
  text-align: left;
}

.return-block.right {
  text-align: right;
}

.return-center {
  text-align: center;
}

.return-label {
  font-size: 12px;
  color: #888;
  margin-bottom: 4px;
}

.return-stop-text {
  font-size: 14px;
  font-weight: 600;
  color: #0f766e;
}

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        /* User Menu */
        .user-menu {
            position: relative;
        }

        .user-btn {
            background: var(--light);
            border: 2px solid var(--gray-light);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            font-size: 0.85rem;
            color: var(--dark);
        }

        .user-btn:hover {
            background: var(--gray-light);
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
            padding: 0.5rem 0;
            min-width: 200px;
            display: none;
            z-index: 1000;
        }

        .user-menu:hover .user-dropdown {
            display: block;
        }

        .user-dropdown a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            text-decoration: none;
            color: var(--gray);
            transition: background 0.3s;
            font-size: 0.9rem;
        }

        .user-dropdown a:hover {
            background: var(--light);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--gray-light);
            margin: 0.5rem 0;
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 1.5rem auto;
            padding: 0 1.5rem;
            min-height: calc(100vh - 200px);
        }

        /* Page Sections */
        .page-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.9), rgba(59, 130, 246, 0.8)),
                        url('https://images.unsplash.com/photo-1436491865332-7a61a109cc05?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80') center/cover;
            border-radius: var(--radius);
            padding: 3rem 1.5rem;
            text-align: center;
            color: white;
            margin-bottom: 2rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 1.5rem;
            line-height: 1.5;
        }



        /* Auth Container */
        .auth-container {
            max-width: 500px;
            margin: 2rem auto;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .auth-tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid var(--gray-light);
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: all 0.3s;
            font-family: inherit;
            font-size: 0.95rem;
        }

        .auth-tab.active {
            background: white;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .auth-form-container {
            padding: 2rem;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-subtitle {
            color: var(--gray);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .auth-link {
            text-align: center;
            margin-top: 1rem;
            color: var(--gray);
        }

        .auth-link a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .auth-link a:hover {
            text-decoration: underline;
        }
    /* Dashboard Container */
    .dashboard-container {
        max-width: 1200px;
        margin: 2rem auto;
        background: white;
        border-radius: 16px;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
    }
    
    .admin-dashboard {
        background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
    }
    
    /* Dashboard Header */
    .dashboard-header {
        background: linear-gradient(135deg, var(--primary), var(--info));
        color: white;
        padding: 2.5rem;
        display: flex;
        align-items: center;
        gap: 1.5rem;
        flex-wrap: wrap;
    }
    
    .admin-dashboard .dashboard-header {
        background: linear-gradient(135deg, #1e293b, #475569);
    }
    
    .dashboard-header .avatar-circle {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        font-weight: bold;
        border: 3px solid rgba(255, 255, 255, 0.3);
    }
    
    .admin-avatar {
        background: rgba(255, 255, 255, 0.3);
    }
    
    .dashboard-info {
        flex: 1;
    }
    
    .dashboard-info h2 {
        font-size: 1.8rem;
        margin-bottom: 0.5rem;
    }
    
    .dashboard-info p {
        opacity: 0.9;
        font-size: 1rem;
    }
    
    .dashboard-stats {
        display: flex;
        gap: 2rem;
    }
    
    .dashboard-stats .stat-item {
        text-align: center;
        min-width: 120px;
    }
    
    .dashboard-stats strong {
        display: block;
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }
    
    .dashboard-stats span {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    /* Dashboard Navigation */
    .dashboard-nav {
        display: flex;
        background: var(--light);
        border-bottom: 1px solid var(--gray-light);
        overflow-x: auto;
    }
    
    .dashboard-nav-btn {
        padding: 1.25rem 1.5rem;
        background: none;
        border: none;
        cursor: pointer;
        font-weight: 500;
        color: var(--gray);
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        border-bottom: 3px solid transparent;
        white-space: nowrap;
        font-size: 0.95rem;
    }
    
    .dashboard-nav-btn:hover {
        background: white;
        color: var(--primary);
    }
    
    .dashboard-nav-btn.active {
        background: white;
        color: var(--primary);
        border-bottom-color: var(--primary);
    }
    
    /* Dashboard Content */
    .dashboard-content {
        padding: 2rem;
    }
    
    .dashboard-tab {
        display: none;
        animation: fadeIn 0.3s ease;
    }
    
    .dashboard-tab.active {
        display: block;
    }
    
    .dashboard-section {
        margin-bottom: 2rem;
    }
    
    .dashboard-section h3 {
        font-size: 1.4rem;
        margin-bottom: 1.5rem;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    /* Empty States */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--gray);
    }
    
    .empty-state i {
        color: var(--gray-light);
        margin-bottom: 1rem;
    }
    
    .empty-state h4 {
        color: var(--dark);
        margin-bottom: 0.5rem;
    }
    
    .empty-state p {
        margin-bottom: 1.5rem;
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
    }
    
    /* Admin Tables */
    .table-container {
        overflow-x: auto;
        border-radius: 8px;
        border: 1px solid var(--gray-light);
    }
    
    .admin-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .admin-table thead {
        background: var(--light);
    }
    
    .admin-table th {
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        color: var(--dark);
        border-bottom: 1px solid var(--gray-light);
        font-size: 0.9rem;
    }
    
    .admin-table td {
        padding: 1rem;
        border-bottom: 1px solid var(--gray-light);
        font-size: 0.9rem;
    }
    
    .admin-table tbody tr:hover {
        background: rgba(37, 99, 235, 0.02);
    }
    
    .empty-table {
        text-align: center;
        padding: 3rem !important;
        color: var(--gray);
    }
    
    .empty-table i {
        font-size: 2rem;
        margin-bottom: 1rem;
        color: var(--gray-light);
    }
    
    /* Rules Editor */
    .rules-editor {
        background: var(--light);
        padding: 1.5rem;
        border-radius: 8px;
        margin-top: 1rem;
    }
    
    .rules-editor .form-group {
        margin-bottom: 1.5rem;
    }
    
    /* Finance Stats */
    .finance-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        border: 1px solid var(--gray-light);
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }
    
    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
    }
    
    .revenue .stat-icon { background: linear-gradient(135deg, #10b981, #059669); }
    .bookings .stat-icon { background: linear-gradient(135deg, #3b82f6, #2563eb); }
    .refunds .stat-icon { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .commission .stat-icon { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
    
    .stat-content {
        flex: 1;
    }
    
    .stat-content h4 {
        font-size: 0.9rem;
        color: var(--gray);
        margin-bottom: 0.25rem;
    }
    
    .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 0.25rem;
    }
    
    .stat-change {
        font-size: 0.85rem;
        font-weight: 600;
    }
    
    .stat-change.positive {
        color: #10b981;
    }
    
    .stat-change.negative {
        color: #ef4444;
    }
    
    .report-actions {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .dashboard-header {
            padding: 1.5rem;
            flex-direction: column;
            text-align: center;
        }
        
        .dashboard-stats {
            width: 100%;
            justify-content: center;
            gap: 1rem;
        }
        
        .dashboard-stats .stat-item {
            min-width: auto;
            flex: 1;
        }
        
        .dashboard-nav {
            flex-wrap: wrap;
        }
        
        .dashboard-nav-btn {
            flex: 1;
            min-width: 140px;
            justify-content: center;
            padding: 1rem;
        }
        
        .finance-stats-grid {
            grid-template-columns: 1fr;
        }
        
        .report-actions {
            flex-direction: column;
        }
        
        .report-actions button {
            width: 100%;
        }
    }
    
    @media (max-width: 480px) {
        .dashboard-stats {
            flex-direction: column;
            gap: 1rem;
        }
        
        .dashboard-nav-btn {
            min-width: 100%;
        }
    }
        /* Profile Container */
        .profile-container {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            max-width: 800px;
            margin: 0 auto;
        }

        .profile-header {
            padding: 2.5rem 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--info));
            color: white;
            text-align: center;
        }

        .avatar-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto 1.25rem;
            border: 4px solid rgba(255, 255, 255, 0.3);
        }

        .profile-info h2 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .profile-info p {
            opacity: 0.9;
            margin-bottom: 1.5rem;
        }

        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .profile-stats .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
        }

        .profile-stats strong {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .profile-stats span {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .profile-nav {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid var(--gray-light);
            flex-wrap: wrap;
            overflow-x: auto;
        }

        .profile-nav-btn {
            padding: 1rem 1.25rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: inherit;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            font-size: 0.9rem;
        }

        .profile-nav-btn.active {
            color: var(--primary);
            background: white;
            border-bottom-color: var(--primary);
        }

        .profile-content {
            padding: 2rem;
        }

        .profile-tab {
            display: none;
        }

        .profile-tab.active {
            display: block;
        }

        .profile-section {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--gray-light);
        }

        .profile-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .profile-section h3 {
            font-size: 1.25rem;
            color: var(--dark);
            margin-bottom: 1.5rem;
        }

        .profile-form {
            display: grid;
            gap: 1.5rem;
        }

        .password-section {
            background: var(--light);
            padding: 1.5rem;
            border-radius: var(--radius-sm);
            margin-top: 2rem;
        }

               /* Footer */
        .footer {
            background: var(--dark);
            color: white;
            margin-top: 3rem;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2.5rem 1.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 2.5rem;
        }

        .footer-section h4 {
            font-size: 1.1rem;
            margin-bottom: 1.25rem;
            color: var(--gray-light);
        }

        .footer-section a {
            display: block;
            color: #9ca3af;
            text-decoration: none;
            margin-bottom: 0.75rem;
            transition: color 0.3s;
            font-size: 0.9rem;
        }

        .footer-section a:hover {
            color: white;
        }

        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .social-links a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .social-links a:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }

        .footer-bottom {
            text-align: center;
            padding: 1.25rem;
            border-top: 1px solid #374151;
            color: #9ca3af;
            font-size: 0.9rem;
        }

        /* Responsive Design for Laptop/Tablet */
        @media (min-width: 768px) {
            .navbar {
                padding: 1rem 2rem;
            }
            
            .nav-link {
                padding: 0.5rem 1rem;
                font-size: 1rem;
            }
            
            .main-container {
                margin: 2rem auto;
                padding: 0 2rem;
            }
            
            .hero {
                padding: 4rem 2rem;
            }
            
            .hero h1 {
                font-size: 3rem;
            }
            
            .search-container {
                padding: 2rem;
            }
            
            .search-tab {
                font-size: 1rem;
                padding: 0.75rem 1.5rem;
            }
            
            .form-row {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .passenger-type {
                flex-direction: row;
            }
            
            .flight-details-grid {
                grid-template-columns: 1fr auto 1fr auto;
                gap: 1.5rem;
            }
            
            .flight-duration-block,
            .flight-price-section {
                grid-column: auto;
            }
            
            .flight-time-block {
                text-align: left;
            }
            
            .flight-time-block.text-right {
                text-align: right;
            }
            
            .flight-actions {
                flex-direction: row;
                justify-content: space-between;
            }
            
            .flight-meta {
                justify-content: flex-start;
            }
            
            .action-buttons {
                justify-content: flex-end;
            }
            
            .btn-select-flight {
                width: auto;
            }
            
            .profile-header {
                padding: 3rem 2rem;
            }
            
            .avatar-circle {
                width: 100px;
                height: 100px;
                font-size: 2.5rem;
            }
            
            .profile-info h2 {
                font-size: 2rem;
            }
        }

        /* Responsive Design for Desktop */
        @media (min-width: 1024px) {
            .logo h1 {
                font-size: 1.8rem;
            }
            
            .nav-links {
                gap: 1.5rem;
            }
            
            .hero h1 {
                font-size: 3.5rem;
            }
            
            .flight-details-grid {
                grid-template-columns: 1.5fr 0.8fr 1.5fr 1fr;
            }
            
            .footer-content {
                padding: 3rem 2rem;
                gap: 3rem;
            }
        }
.flight-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  align-items: center;   /* simi vertical */
}

.flight-go,
.flight-return {
  min-height: 80px;      /* ama height fixed haddii loo baahdo */
  display: flex;
  flex-direction: column;
  justify-content: center;
}

        /* Responsive Design for Mobile */
        @media (max-width: 480px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .nav-links {
                width: 100%;
                justify-content: center;
            }

            .logo { justify-content: center; }
            .logo h1 {
                font-size: 1.4rem;
                text-align: center;
            }

            /* Mobile header quick nav styles (hidden by default, shown on very small screens) */
            .mobile-header-nav { display: none; gap: 0.6rem; justify-content: center; align-items: center; width: 100%; }
            .mobile-header-nav .mh-btn { background: #f1f7f2; border: none; border-radius: 14px; padding: 0.6rem 0.9rem; display: inline-flex; align-items: center; gap: 0.6rem; font-weight: 600; color: var(--dark); font-size: 0.95rem; cursor: pointer; }
            .mobile-header-nav .mh-btn i { font-size: 1rem; color: var(--primary); }
            .mobile-header-nav .mh-btn.active, .mobile-header-nav .mh-btn[aria-current="page"] { background: linear-gradient(135deg, #e6f7ef, #d1f1df); color: var(--primary); box-shadow: 0 6px 18px rgba(7,64,32,0.06); }

            /* Hide standard nav-links on very small screens to avoid duplication; the hamburger can still open the full nav */
            .nav-links { display: none; }

            @media (max-width: 480px) {
                .mobile-header-nav { display: flex; margin-top: 0.5rem; }
                .nav-links.show { display: flex; flex-direction: column; }
            }

            .hero {
                padding: 1.75rem 1rem;
            }

            .hero h1 {
                font-size: 1.8rem;
            }

            .hero p {
                font-size: 1rem;
            }

            /* Compact the search container and make inputs look like the screenshot */
            .search-container {
                padding: 1rem;
            }

            /* Make tabs appear as pill buttons across the top */
            .search-tabs {
                display: flex;
                gap: 0.5rem;
                margin-bottom: 1rem;
            }

            .search-tab {
                flex: 1 1 auto;
                text-align: center;
                padding: 0.75rem 0.6rem;
                border-radius: 14px;
                background: #f1f7f2; /* soft green tint */
                color: var(--dark);
                font-weight: 600;
                font-size: 0.95rem;
                border: none;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }

            .search-tab.active {
                background: linear-gradient(135deg, #e6f7ef, #d1f1df);
                color: var(--primary);
                box-shadow: 0 6px 18px rgba(7, 64, 32, 0.06);
            }

            /* Stack fields vertically and use roomy, pill-like inputs */
            .search-form {
                padding: 0.75rem 0;
                gap: 0.6rem;
            }

            .search-form .form-group {
                width: 100%;
                flex: 1 1 100%;
            }

            .search-form .form-group input,
            .search-form .form-group select,
            .search-form .passenger-display {
                background: #f3faf5;
                border: none;
                height: 54px;
                border-radius: 12px;
                padding: 0 1rem;
                font-size: 1rem;
                box-shadow: none;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .search-form .date-input-wrapper input {
                height: 54px;
            }

            /* Date row (two small date pills side by side) */
            .date-row {
                display: flex;
                gap: 0.5rem;
                width: 100%;
            }

            .date-row .date-col { flex: 1; }

            .date-row .date-col .date-input-wrapper input {
                height: 44px;
                border-radius: 10px;
                background: #f3faf5;
                padding: 0 0.9rem;
                font-size: 0.95rem;
            }

            /* Combined passenger + class display */
            .passenger-class-display {
                width: 100%;
                height: 54px;
                display: flex;
                align-items: center;
                padding: 0 1rem;
                border-radius: 12px;
                background: #f3faf5;
                font-weight: 600;
                color: var(--dark);
            }

            /* Hide the native class select on small screens (we show combined display) */
            .passenger-class-group + .form-group select#class {
                display: none;
            }

            .swap-btn {
                order: 2;
                margin: 0.25rem 0;
                align-self: center;
                width: 44px;
                height: 44px;
                border-radius: 10px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                background: #fff;
                border: 1px solid rgba(0,0,0,0.04);
                box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            }

            /* Primary search button: full-width, tall, pill-shaped */
            .btn-search {
                width: 100%;
                height: 56px;
                border-radius: 12px;
                font-size: 1.05rem;
                font-weight: 700;
                background: linear-gradient(135deg, #10b981, #059669);
                color: #fff;
                border: none;
                box-shadow: 0 8px 18px rgba(5,150,105,0.12);
            }

            .results-header {
                flex-direction: column;
                text-align: center;
            }

            .currency-display {
                margin: 1rem auto 0 auto;
            }

            .filters {
                flex-direction: column;
                align-items: flex-start;
            }

            .filter-group {
                width: 100%;
            }

            .airline-filters {
                width: 100%;
            }

            .quick-filter-btn {
                min-width: calc(50% - 0.375rem);
            }

            .passenger-type {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }

            .passenger-controls {
                width: 100%;
                justify-content: space-between;
            }

            .profile-nav {
                flex-direction: column;
            }

            .profile-nav-btn {
                justify-content: center;
                width: 100%;
            }

            .profile-stats {
                gap: 1.5rem;
            }

            .profile-stats strong {
                font-size: 1.5rem;
            }

            .social-buttons {
                flex-direction: column;
            }

            .destination-card img {
                height: 150px;
            }

            .notification {
                left: 1rem;
                right: 1rem;
                max-width: calc(100% - 2rem);
            }
        }

        /* Fix for very small screens */
        @media (max-width: 320px) {
            .logo h1 {
                font-size: 1.2rem;
            }
            
            .nav-link {
                font-size: 0.85rem;
                padding: 0.4rem 0.6rem;
            }
            
            .currency-btn, .user-btn {
                padding: 0.4rem 0.6rem;
                font-size: 0.8rem;
            }
            
            .search-tab {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }

/* Airline Logo Styles - ADD THESE */
.airline-logo {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, var(--primary), var(--info));
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1rem;
}

.airline-logo-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 8px;
}

.airline-logo-container {
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border: 1px solid var(--gray-light);
    overflow: hidden;
}

/* Airline colors for logos */
.airline-ET { background: linear-gradient(135deg, #006400, #008000); } /* Ethiopian - Green */
.airline-EK { background: linear-gradient(135deg, #d71921, #ff0000); } /* Emirates - Red */
.airline-QR { background: linear-gradient(135deg, #8b4513, #a0522d); } /* Qatar - Maroon */
.airline-TK { background: linear-gradient(135deg, #e30a17, #ff0000); } /* Turkish - Red */
.airline-MS { background: linear-gradient(135deg, #ff0000, #ff4500); } /* EgyptAir - Red */
.airline-KQ { background: linear-gradient(135deg, #ff0000, #ff6347); } /* Kenya Airways - Red */
/* ÙÙŠ CSS Ø£Ø¶Ù */
.auth-buttons {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.hidden {
    display: none !important;
}

/* ØªØ­Ø¯ÙŠØ« Ø£Ù†Ù…Ø§Ø· Ø²Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
.user-menu {
    position: relative;
}

.user-btn {
    background: var(--light);
    border: 2px solid var(--gray-light);
    padding: 0.5rem 0.75rem;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    transition: all 0.3s;
    font-family: inherit;
    font-size: 0.85rem;
    color: var(--dark);
}

.user-btn:hover {
    background: var(--gray-light);
}

.user-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow-lg);
    padding: 0.5rem 0;
    min-width: 200px;
    display: none;
    z-index: 1000;
}
/* Error Message Styles */
.error-message {
    color: #ef4444;
    font-size: 0.85rem;
    margin-top: 0.25rem;
    display: none;
    padding: 0.25rem 0.5rem;
    background: rgba(239, 68, 68, 0.05);
    border-radius: 4px;
    border-left: 3px solid #ef4444;
}

.error-message a {
    color: #2563eb;
    text-decoration: underline;
    font-weight: 500;
}

.error-message a:hover {
    color: #1d4ed8;
}

.hint-text {
    color: #6b7280;
    font-size: 0.75rem;
    margin-top: 0.25rem;
    display: block;
}

/* Success message styles */
.success-message {
    color: #10b981;
    font-size: 0.85rem;
    margin-top: 0.25rem;
    display: none;
    padding: 0.25rem 0.5rem;
    background: rgba(16, 185, 129, 0.05);
    border-radius: 4px;
    border-left: 3px solid #10b981;
}

/* Form validation states */
.form-group input:invalid:not(:placeholder-shown),
.form-group input.error {
    border-color: #ef4444;
}

.form-group input:valid:not(:placeholder-shown) {
    border-color: #10b981;
}

/* Loading button */
button:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

/* Checkbox error state */
.checkbox input:invalid + label {
    color: #ef4444;
}

.checkbox input:valid + label {
    color: #10b981;
}
.user-dropdown.show {
    display: block;
}

.user-dropdown a {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    text-decoration: none;
    color: var(--gray);
    transition: background 0.3s;
    font-size: 0.9rem;
}

.user-dropdown a:hover {
    background: var(--light);
}

.dropdown-divider {
    height: 1px;
    background: var(--gray-light);
    margin: 0.5rem 0;
}
/* Password Error Styles */
.password-container {
    position: relative;
    display: flex;
    align-items: center;
}

.toggle-password {
    position: absolute;
    right: 10px;
    background: none;
    border: none;
    color: var(--gray);
    cursor: pointer;
    padding: 5px;
    font-size: 1rem;
}

.toggle-password:hover {
    color: var(--primary);
}

/* Shake animation for wrong password */
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
    20%, 40%, 60%, 80% { transform: translateX(5px); }
}

.shake {
    animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    border-color: #ef4444 !important;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}

/* Password strength indicator */
.password-strength {
    margin-top: 0.5rem;
}

.strength-meter {
    height: 4px;
    background: #e5e7eb;
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 0.25rem;
}

.strength-bar {
    height: 100%;
    width: 0%;
    transition: width 0.3s, background-color 0.3s;
    border-radius: 2px;
}

.strength-text {
    font-size: 0.75rem;
    font-weight: 500;
    min-height: 1rem;
}

/* Password hints */
.password-hints {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.5rem;
    font-size: 0.85rem;
}

.forgot-password {
    color: var(--primary);
    text-decoration: none;
    font-weight: 500;
}

.forgot-password:hover {
    text-decoration: underline;
    color: var(--primary-dark);
}

/* Form focus states */
.form-group input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    outline: none;
}

/* Error input state */
.form-group input.error {
    border-color: #ef4444;
    background: rgba(239, 68, 68, 0.05);
}

/* Success input state */
.form-group input.success {
    border-color: #10b981;
    background: rgba(16, 185, 129, 0.05);
}

/* Loading button animation */
.btn-loading {
    position: relative;
    color: transparent !important;
}

.btn-loading::after {
    content: '';
    position: absolute;
    width: 20px;
    height: 20px;
    top: 50%;
    left: 50%;
    margin-left: -10px;
    margin-top: -10px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: button-spinner 0.6s linear infinite;
}

@keyframes button-spinner {
    to { transform: rotate(360deg); }
}

/* Login attempts counter */
.login-attempts {
    font-size: 0.75rem;
    color: #f59e0b;
    margin-top: 0.5rem;
    display: none;
}

.login-attempts.show {
    display: block;
}



/* Account lock warning */
.account-lock {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    border-radius: 8px;
    padding: 0.75rem;
    margin-top: 1rem;
    font-size: 0.85rem;
    color: #ef4444;
}

.account-lock i {
    margin-right: 0.5rem;
}
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.modal-box {
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    width: 300px;
    text-align: center;
}

.hide {
    display: none;
}

.modal-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
}

.btn-danger {
    background: #e11d48;
    color: white;
    border: none;
    padding: 8px 14px;
    border-radius: 6px;
}

.btn-secondary {
    background: #e5e7eb;
    border: none;
    padding: 8px 14px;
    border-radius: 6px;
}
.auth-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 14px 28px;
  font-size: 1.125rem; /* text-lg */
  font-weight: bold;
  border-radius: 10px;
  text-decoration: none;
  color: white;
  transition: all 0.3s ease-in-out;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.login-btn {
  background-color: #2563eb; /* Blue */
}

.login-btn:hover {
  background-color: #1d4ed8;
  transform: translateY(-2px);
}

.create-btn {
  background-color: #16a34a; /* Green */
}

.create-btn:hover {
  background-color: #15803d;
  transform: translateY(-2px);
}

/* icon spacing */
.auth-btn i {
  margin-right: 8px;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .auth-buttons {
        flex-direction: column;
        width: 100%;
        margin-top: 1rem;
    }
    
    .user-menu {
        width: 100%;
        margin-top: 1rem;
    }
    
    .user-btn {
        width: 100%;
        justify-content: center;
    }
    
    .user-dropdown {
        position: static;
        width: 100%;
        margin-top: 0.5rem;
    }
}
            .btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.85rem;
            }
        }

        /* Accessibility helper to visually hide while remaining readable by screen readers */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Mobile toggle & menu behavior */
        .mobile-toggle {
            display: none;
            background: transparent;
            border: 2px solid var(--gray-light);
            padding: 0.45rem;
            border-radius: 8px;
            font-size: 1.1rem;
            color: var(--dark);
            cursor: pointer;
        }

        /* For small screens and tablets */
        @media (max-width: 768px) {
            .mobile-toggle {
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }

            .nav-links {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.28s ease-in-out, padding 0.2s;
                width: 100%;
                flex-direction: column;
            }

            .nav-links.show {
                max-height: 900px; /* expand to show items */
                padding-top: 0.75rem;
                padding-bottom: 0.75rem;
            }

            .nav-links a.nav-link  {
                padding: 0.6rem 0;
                width: 100%;
            }
        }

        /* Mobile bottom navigation (icons like mobile app) */
        .mobile-bottom-nav {
            display: none; /* shown on small screens */
        }

        .mobile-bottom-nav .mb-nav-item {
            text-decoration: none;
            color: var(--gray);
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            padding: 6px 8px;
            font-size: 12px;
        }

        .mobile-bottom-nav .mb-nav-item i {
            font-size: 18px;
        }

        .mobile-bottom-nav .mb-nav-item.active {
            color: var(--primary);
        }

        @media (max-width: 480px) {
            .mobile-bottom-nav {
                display: flex;
                position: fixed;
                left: 0;
                right: 0;
                bottom: 0;
                background: #fff;
                border-top: 1px solid var(--gray-light);
                padding: 8px 12px;
                justify-content: space-around;
                z-index: 1003;
            }

            /* create space at bottom so content doesn't get hidden behind the nav */
            body {
                padding-bottom: 74px;
            }
        }

    </style>

    <style>
    /* Input with icon */
    .input-with-icon { position: relative; }
    .input-with-icon input { width: 100%; box-sizing: border-box; }
    .input-with-icon .input-icon { position: absolute; top: 50%; transform: translateY(-50%); right: 12px; font-size: 1.05rem; color: var(--gray); }

    /* Special Offer */
    .promo-row { display: flex; gap: 1rem; margin-top: 1rem; align-items: flex-start; flex-wrap: wrap; }
    .special-offer { background: white; border-radius: 12px; padding: 12px; display: flex; align-items: center; justify-content: space-between; gap: 12px; box-shadow: var(--shadow); flex: 1 1 100%; }
    .offer-text { max-width: calc(100% - 96px); }
    .offer-label { color: var(--gray); font-size: 0.9rem; margin-bottom: 4px; }
    .special-offer h3 { margin: 0 0 6px 0; font-size: 1.05rem; color: var(--dark); }
    .offer-sub { color: #4b5563; font-size: 0.95rem; margin-top: 2px; }
    .offer-img { width: 78px; height: 78px; object-fit: cover; border-radius: 8px; }

    /* Recent searches */
    .recent-searches { flex: 1 1 100%; margin-top: 8px; }
    .recent-searches h3 { margin: 16px 0 8px 4px; }
    .recent-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 8px; }
    .recent-item { display: flex; gap: 12px; align-items: center; background: white; padding: 10px; border-radius: 10px; box-shadow: var(--shadow); }
    .recent-icon { width: 44px; height: 44px; border-radius: 10px; display: grid; place-items: center; background: #f1f7f3; color: var(--primary); }
    .recent-body .muted { color: #6b7280; font-size: 0.92rem; }

    /* Bottom Navigation */
    .bottom-nav { display: none; }
    @media (max-width: 900px) {
        .bottom-nav { display: flex; position: fixed; left: 0; right: 0; bottom: 0; height: 70px; background: white; border-top: 1px solid #e6e6e6; box-shadow: 0 -4px 18px rgba(0,0,0,0.04); align-items: center; justify-content: space-around; z-index: 9999; }
        .bottom-nav a { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; color: #4b5563; text-decoration: none; font-size: 0.8rem; }
        .bottom-nav a .fa { font-size: 1.1rem; }
        .bottom-nav a.active { color: var(--primary-dark); }
        .main-container { padding-bottom: 90px; }

        /* Filter FAB */
        .filter-fab { position: fixed; right: 18px; bottom: 92px; width: 54px; height: 54px; border-radius: 50%; background: var(--primary); color: white; border: none; display: grid; place-items: center; box-shadow: 0 8px 22px rgba(37,99,235,0.16); z-index: 10001; }
        .filter-fab i { font-size: 1.1rem; }
    }
    </style>
    
    <!-- Flight Details Panel Styles -->
    <style>
        /* Flight Details Panel Styles */
        #flightDetailsPanel {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            margin-top: 2rem;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        #flightDetailsPanel.active {
            display: block;
        }
        
        .flight-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .airline-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
       
        
        .airline-text h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        
        .airline-text p {
            margin: 0.25rem 0 0 0;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .flight-status {
            text-align: right;
        }
        
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .flight-duration {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .flight-timeline {
            margin: 1.5rem 0;
        }
        
        .timeline-row {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            align-items: center;
        }
        
        .timeline-departure,
        .timeline-arrival {
            text-align: center;
        }
        
        .timeline-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        
        .flight-route-line {
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            opacity: 0.2;
        }
        
        .additional-info {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray-light);
        }
        
        .additional-info h4 {
            margin-bottom: 1rem;
            color: var(--dark);
        }
        
        .additional-info ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .additional-info li {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            color: var(--gray);
        }
        
        .additional-info i {
            color: var(--secondary);
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        /* ================= RESULTS PAGE LAYOUT ================= */

.results-layout {
    display: grid;
    grid-template-columns: 260px 1fr 340px;
    gap: 20px;
    align-items: start;
    width: 100%;
}

/* ================= LEFT SIDEBAR ================= */

.sidebar {
    background: #f8fafc;
    border-radius: 12px;
    padding: 18px;
    height: fit-content;
    border: 1px solid #e5e7eb;
}

/* ================= MAIN RESULTS ================= */

.main-results {
    width: 100%;
}

/* Flight Card Styling */
.flight-card {
    background: white;
    border-radius: 14px;
    padding: 18px;
    margin-bottom: 15px;
    border: 1px solid #e5e7eb;
    box-shadow: 0 4px 10px rgba(0,0,0,0.04);
}

.flight-card-main {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.flight-info {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 25px;
}

.flight-times .time {
    font-size: 18px;
    font-weight: bold;
}

.flight-times .city {
    font-size: 13px;
    color: gray;
}

.flight-arrow {
    font-size: 22px;
    color: #3b82f6;
}

.flight-actions {
    text-align: right;
    min-width: 160px;
}

.flight-price {
    font-size: 20px;
    font-weight: bold;
    color: #16a34a;
}

.flight-select-btn {
    margin-top: 6px;
    background: #16a34a;
    border: none;
    color: white;
    padding: 9px 14px;
    border-radius: 8px;
    cursor: pointer;
    width: 100%;
}

.flight-select-btn:hover {
    background: #15803d;
}

/* Meta Bar */
.flight-meta-bar {
    margin-top: 12px;
    padding-top: 10px;
    border-top: 1px solid #e5e7eb;
    display: flex;
    justify-content: space-around;
    font-size: 13px;
    color: #555;
}

/* ================= RIGHT DETAILS PANEL ================= */

.details-panel {
    background: #ffffff;
    border-radius: 14px;
    padding: 18px;
    border: 1px solid #e5e7eb;
    height: fit-content;
    position: sticky;
    top: 20px;
}

/* ================= RESPONSIVE FIX ================= */

@media (max-width: 1100px) {
    .results-layout {
        grid-template-columns: 1fr;
    }

    .details-panel {
        position: relative;
        top: 0;
    }
}

        .modal-box {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.3s ease;
        }
        
        .booking-details {
            background: var(--light);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* Layover info */
        .layover-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }
        
        .layover-duration {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--warning);
            font-weight: 600;
        }
        
        .layover-badge {
            background: var(--warning);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
<!-- Header -->
<header class="header">
    <nav class="navbar">
        <!-- LOGO -->
        <a href="#" class="logo" onclick="showPage('flights')">
            <img src="https://i.postimg.cc/L6sR9Bvr/20260110-010256.png" alt="Ethiofly Logo" class="logo-img">
            <h1>ETHIOFLY</h1>
        </a>

        <!-- Mobile hamburger -->
        <button class="hamburger" id="hamburgerBtn" aria-controls="navLinks" aria-expanded="false" aria-label="Toggle navigation">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="nav-links" id="navLinks" role="navigation">
            <div class="nav-center">
                <a href="#" class="nav-link active" onclick="showPage('flights')"><i class="fas fa-plane"></i> Flights</a>
                <a href="#" class="nav-link" onclick="showPage('hotels')"><i class="fas fa-hotel"></i> Hotels</a>
            </div>
        <div class="currency-selector">
                    <button class="currency-btn" id="currencyBtn">
                        <i class="fas fa-money-bill-wave"></i>
                        <span id="currentCurrency">USD</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="currency-dropdown" id="currencyDropdown">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            <!-- AUTH BUTTONS (Initially shown) -->
            <div id="authButtons" class="flex gap-4">
  <!-- Login -->
  <a href="#" 
     class="auth-btn login-btn" 
     onclick="showPage('auth'); switchAuthTab('login')">
    <i class="fas fa-sign-in-alt mr-2"></i> Login
  </a>
                
            </div>

            <!-- USER MENU (Initially hidden) -->
            <div class="user-menu hidden" id="userMenu">
                <button class="user-btn" id="userMenuBtn">
                    <i class="fas fa-user-circle"></i>
                    <span id="userName">User</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="user-dropdown" id="userDropdown">
                    <a href="#" onclick="showPage('profile')"><i class="fas fa-user"></i> My Profile</a>
                    <a href="#" onclick="showPage('bookings')"><i class="fas fa-ticket-alt"></i> My Bookings</a>
                    <a href="#" onclick="showPage('saved')"><i class="fas fa-bookmark"></i> Saved Flights</a>
                    <div class="dropdown-divider"></div>
                    <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
            </div>
        </div>
    </nav>
</header>
         <section id="flights-page" class="page-section active">
            <div class="hero">
               
            </div>

             <div class="search-container">
    <div class="search-tabs">
        <button class="search-tab active" data-type="round">
            <i class="fas fa-exchange-alt"></i> Round Trip
        </button>
        <button class="search-tab" data-type="oneway">
            <i class="fas fa-arrow-right"></i> One Way
        </button>
        <button class="search-tab" data-type="multi">
            <i class="fas fa-route"></i> Multi-City
        </button>
    </div>

    <form class="search-form" id="flightSearchForm">
        <div class="form-row">
            <div class="form-group">
                <input type="text" id="from" placeholder="From City or Airport" 
                       value="New York (JFK)" required>
                <div class="suggestions" id="fromSuggestions"></div>
            </div>
            
            <div class="swap-btn">
                <button type="button" id="swapLocations" title="Swap locations">
                    <i class="fas fa-exchange-alt"></i>
                </button>
            </div>

            <div class="form-group">
                <input type="text" id="to" placeholder="To City or Airport" required>
                <div class="suggestions" id="toSuggestions"></div>
            </div>

            <div class="form-group">
                <div class="date-input-wrapper">
                    <input type="date" id="departure" required>
                </div>
            </div>

            <div class="form-group">
                <div class="date-input-wrapper">
                    <input type="date" id="return" placeholder="Return Date">
                </div>
            </div>


           <div class="form-group">
    <div class="passenger-input" id="passengerTrigger">
        <div class="passenger-display">
            <i class="fas fa-users"></i>
            <span id="passengerCount"> Adults</span>
            <i class="fas fa-chevron-down"></i>
        </div>
    </div>
    <div class="passengers-selector" id="passengersSelector">
        <div class="passenger-type">
            <span class="passenger-label">Adults (12+)</span>
            <div class="passenger-controls">
                <button type="button" class="passenger-minus" data-type="adults" disabled>âˆ’</button>
                <input type="number" id="adultsCount" value="1" min="1" max="9" readonly>
                <button type="button" class="passenger-plus" data-type="adults">+</button>
            </div>
        </div>
        <div class="passenger-type">
            <span class="passenger-label">Children (2-11)</span>
            <div class="passenger-controls">
                <button type="button" class="passenger-minus" data-type="children" disabled>âˆ’</button>
                <input type="number" id="childrenCount" value="0" min="0" max="8" readonly>
                <button type="button" class="passenger-plus" data-type="children">+</button>
            </div>
        </div>
        <div class="passenger-type">
            <span class="passenger-label">Infants (0-1)</span>
            <div class="passenger-controls">
                <button type="button" class="passenger-minus" data-type="infants" disabled>âˆ’</button>
                <input type="number" id="infantsCount" value="0" min="0" max="8" readonly>
                <button type="button" class="passenger-plus" data-type="infants">+</button>
            </div>
        </div>
        <div class="passenger-summary" id="passengerSummary">
            Total:  Passengers<br><small> Adults</small>
        </div>
    </div>
</div>
            <div class="form-group">
                <select id="class">
                    <option value="economy">Economy</option>
                    <option value="premium_economy">Premium Economy</option>
                    <option value="business">Business</option>
                    <option value="first">First Class</option>
                </select>
            </div>
 <label class="checkbox">
                <input type="checkbox" id="directOnly">
                <span>Direct flights only</span>
            </label>

            <!-- Search button on far right -->
            <button type="submit" class="btn-search" style="margin-left: auto;">
                <i class="fas fa-search"></i>
                <span>SEARCH</span>
            </button>
        </div>
    </form>
</div>    
   
                <!-- Search Results -->
                <div class="results-container hidden" id="searchResults">
                    <div class="search-layout">
                        <aside class="sidebar">
                            <div class="sidebar-inner">
                                <div class="filter-card">
                                    <h3>Filter</h3>
                                    <div class="filter-group">
                                        <label>Sort by:</label>
                                        <select id="sortBy">
                                            <option value="price">Price (Lowest)</option>
                                            <option value="duration">Duration (Shortest)</option>
                                            <option value="departure">Departure Time</option>
                                            <option value="airline">Airline</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="filter-card">
                                    <h3>Airlines</h3>
                                    <div class="airline-filters" id="airlineFilters">
                                        <!-- Populated dynamically from search results -->
                                    </div>
                                </div>

                                <div class="filter-card">
                                    <h3>Price</h3>
                                    <div>
                                        <input type="range" id="priceRange" min="0" max="2000" step="10">
                                        <div class="mt-2 text-sm">USD <span id="priceMin">0</span> - USD <span id="priceMax">2000</span></div>
                                    </div>
                                </div>
                            </div>
                        </aside>


                        <main class="main-results">
                            <div class="results-header">
                                <div>
                                    <h2 id="searchRoute">Addis Ababa (ADD) â†’ Dubai (DXB)</h2>

                                    <div class="results-stats">
                                        <div class="stat-item">
                                         
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-secondary" id="backToSearch">
                                    <i class="fas fa-arrow-left"></i> back to Search
                                </button>
                            </div>

                            <div id="quickFiltersContainer">
                                <!-- Quick filters will be inserted here -->
                            </div>

                            <div id="resultsList">
                                <!-- Flight results will be loaded here by JavaScript -->
                                <div class="loading">
                                    <div class="spinner"></div>
                                    <p>Searching for the best flights...</p>
                                </div>
                            </div>
                            
                            <!-- Flight Details Panel (Added Here) -->
                            <div id="flightDetailsPanel"></div>

                            <div class="results-footer">
                                <p id="resultsCount" class="results-count">Showing 0 of 0 flight options</p>
                            </div>
                        </main>
                    </div>
                </div>

            <!-- Popular Destinations -->
            <div class="popular-destinations">
                <h2 class="text-center mb-4">Popular Destinations from Ethiopia</h2>
                <div class="destinations-grid">
                    <div class="destination-card" onclick="setDestination('Dubai (DXB)')">
                        <img src="https://images.unsplash.com/photo-1512453979798-5ea266f8880c?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Dubai">
                        <div class="destination-info">
                            <h4>Dubai, UAE</h4>
                            <p>From <span class="destination-price">USD 250</span></p>
                            <button class="btn btn-primary mt-2" onclick="setDestination('Dubai (DXB)')">
                                <i class="fas fa-search"></i> Search Flights
                            </button>
                        </div>
                    </div>
                    <div class="destination-card" onclick="setDestination('Istanbul (IST)')">
                        <img src="https://images.unsplash.com/photo-1523531294919-4bcd7c65e216?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Istanbul">
                        <div class="destination-info">
                            <h4>Istanbul, Turkey</h4>
                            <p>From <span class="destination-price">USD 330</span></p>
                            <button class="btn btn-primary mt-2" onclick="setDestination('Istanbul (IST)')">
                                <i class="fas fa-search"></i> Search Flights
                            </button>
                        </div>
                    </div>
                    <div class="destination-card" onclick="setDestination('Nairobi (NBO)')">
                        <img src="https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Nairobi">
                        <div class="destination-info">
                            <h4>Nairobi, Kenya</h4>
                            <p>From <span class="destination-price">USD 270</span></p>
                            <button class="btn btn-primary mt-2" onclick="setDestination('Nairobi (NBO)')">
                                <i class="fas fa-search"></i> Search Flights
                            </button>
                        </div>
                    </div>
                    <div class="destination-card" onclick="setDestination('London (LHR)')">
                        <img src="https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="London">
                        <div class="destination-info">
                            <h4>London, UK</h4>
                            <p>From <span class="destination-price">USD 490</span></p>
                            <button class="btn btn-primary mt-2" onclick="setDestination('London (LHR)')">
                                <i class="fas fa-search"></i> Search Flights
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Authentication Page -->
<section id="auth-page" class="page-section">
    <div class="auth-container">
        <div class="auth-tabs">
            <button class="auth-tab active" data-auth="login">Sign In</button>
            <button class="auth-tab" data-auth="signup">Sign Up</button>
        </div>
        
        <!-- Login Form -->
        <div id="loginForm" class="auth-form active">
            <form id="loginFormActual" class="auth-form-container">
                <h2>Welcome Back to Ethiofly</h2>
                <p class="auth-subtitle">Sign in to access your dashboard</p>
                
                <div class="form-group">
                    <label for="loginEmail">Email Address *</label>
                    <input type="email" id="loginEmail" placeholder="you@example.com" required>
                    <div class="error-message" id="loginEmailError"></div>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Password *</label>
                    <div class="password-container">
                        <input type="password" id="loginPassword" placeholder="Enter your password" required>
                        <button type="button" class="toggle-password" onclick="togglePasswordVisibility('loginPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <div class="error-message" id="loginPasswordError"></div>
                    <div class="password-hints">
                        <a href="#" onclick="showForgotPasswordModal()" class="forgot-password">
                            <i class="fas fa-key"></i> Forgot password?
                        </a>
                    </div>
                </div>
                
                <div class="form-group checkbox">
                    <input type="checkbox" id="remember">
                    <label for="remember">Remember me</label>
                </div>
                
                <button type="submit" class="btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
                
                <p class="auth-link mt-3">
                    Don't have an account? 
                    <a href="#" onclick="switchAuthTab('signup')">
                        <i class="fas fa-user-plus"></i> Sign up here
                    </a>
                </p>
            </form>
        </div>
        
        <!-- Signup Form -->
        <div id="signupForm" class="auth-form">
            <form id="signupFormActual" class="auth-form-container">
                <h2>Create Your Ethiofly Account</h2>
                <p class="auth-subtitle">Join to book flights and manage your travel</p>
                
                <div class="form-group">
                    <label for="signupFullName">Full Name *</label>
                    <input type="text" id="signupFullName" placeholder="Enter your full name" required>
                    <div class="error-message" id="signupNameError"></div>
                </div>
                
                <div class="form-group">
                    <label for="signupEmail">Email Address *</label>
                    <input type="email" id="signupEmail" placeholder="you@example.com" required>
                    <div class="error-message" id="signupEmailError"></div>
                    <small class="hint-text">We'll use this email for login and notifications</small>
                </div>
                
                <div class="form-group">
                    <label for="signupPhone">Phone Number *</label>
                    <input type="tel" id="signupPhone" placeholder="+251 911 123 456" required>
                    <div class="error-message" id="signupPhoneError"></div>
                    <small class="hint-text">Ethiopian format: +251 9XX XXX XXX</small>
                </div>
                
                <div class="form-group">
                    <label for="signupPassword">Password *</label>
                    <input type="password" id="signupPassword" placeholder="Create a strong password" required>
                    <div class="error-message" id="signupPasswordError"></div>
                    <small class="hint-text">At least 8 characters with letters and numbers</small>
                </div>
                
                <div class="form-group">
                    <label for="signupConfirmPassword">Confirm Password *</label>
                    <input type="password" id="signupConfirmPassword" placeholder="Confirm your password" required>
                    <div class="error-message" id="signupConfirmPasswordError"></div>
                </div>
                
                <div class="form-group checkbox">
                    <input type="checkbox" id="signupTerms" required>
                    <label for="signupTerms">
                        I agree to the <a href="#" onclick="showPage('terms')">Terms of Service</a> and <a href="#" onclick="showPage('privacy')">Privacy Policy</a> *
                    </label>
                </div>
                
                <button type="submit" class="btn-primary btn-block">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
                
                <p class="auth-link mt-3">
                    Already have an account? 
                    <a href="#" onclick="switchAuthTab('login')">
                        <i class="fas fa-sign-in-alt"></i> Log in here
                    </a>
                </p>
            </form>
        </div>
    </div>
</section>

<!-- User Dashboard Section -->
<section id="user-dashboard-page" class="page-section">
    <div class="dashboard-container">
        <div class="dashboard-header">
            <div class="avatar-circle">
                <span id="userAvatarInitials">UA</span>
            </div>
            <div class="dashboard-info">
                <h2>My Dashboard</h2>
                <p>Welcome back, <span id="userDashboardName">User</span></p>
            </div>
            <div class="dashboard-stats">
                <div class="stat-item">
                    <strong id="userBookingsCount">0</strong>
                    <span>Active Bookings</span>
                </div>
                <div class="stat-item">
                    <strong id="userPendingActions">0</strong>
                    <span>Pending Actions</span>
                </div>
            </div>
        </div>

        <div class="dashboard-nav">
            <button class="dashboard-nav-btn active" data-tab="user-bookings">
                <i class="fas fa-ticket-alt"></i> My Bookings
            </button>
            <button class="dashboard-nav-btn" data-tab="user-refund">
                <i class="fas fa-undo"></i> Request Refund
            </button>
            <button class="dashboard-nav-btn" data-tab="user-change">
                <i class="fas fa-exchange-alt"></i> Request Change
            </button>
            <button class="dashboard-nav-btn" data-tab="user-profile">
                <i class="fas fa-user"></i> Profile
            </button>
            <button class="dashboard-nav-btn" data-tab="user-saved">
                <i class="fas fa-bookmark"></i> Saved Flights
            </button>
        </div>

        <div class="dashboard-content">
            <!-- My Bookings Tab -->
            <div class="dashboard-tab active" id="user-bookings-tab">
                <div class="dashboard-section">
                    <h3><i class="fas fa-ticket-alt"></i> My Bookings</h3>
                    <div class="search-filter">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchBookings" placeholder="Search bookings...">
                        </div>
                        <select id="filterBookingStatus" class="filter-select">
                            <option value="all">All Bookings</option>
                            <option value="upcoming">Upcoming</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    
                    <div class="bookings-list" id="bookingsList">
                        <!-- Bookings will be loaded here -->
                        <div class="empty-state">
                            <i class="fas fa-ticket-alt fa-3x"></i>
                            <h4>No bookings yet</h4>
                            <p>You haven't made any flight bookings yet.</p>
                            <button onclick="showPage('flights')" class="btn-primary">
                                <i class="fas fa-search"></i> Search Flights
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Request Refund Tab -->
            <div class="dashboard-tab" id="user-refund-tab">
                <div class="dashboard-section">
                    <h3><i class="fas fa-undo"></i> Request Refund</h3>
                    
                    <!-- Active bookings eligible for refund -->
                    <div class="card">
                        <div class="card-header">
                            <h4>Eligible Bookings for Refund</h4>
                        </div>
                        <div class="card-body">
                            <div class="empty-state">
                                <i class="fas fa-undo fa-3x"></i>
                                <h4>No eligible bookings</h4>
                                <p>You don't have any bookings eligible for refund at the moment.</p>
                                <button onclick="showPage('bookings')" class="btn-primary">
                                    <i class="fas fa-ticket-alt"></i> View My Bookings
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Refund requests history -->
                    <div class="card mt-3">
                        <div class="card-header">
                            <h4>My Refund Requests</h4>
                        </div>
                        <div class="card-body">
                            <div class="empty-state">
                                <i class="fas fa-history fa-3x"></i>
                                <h4>No refund requests</h4>
                                <p>You haven't submitted any refund requests yet.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Request Change Tab -->
            <div class="dashboard-tab" id="user-change-tab">
                <div class="dashboard-section">
                    <h3><i class="fas fa-exchange-alt"></i> Request Change</h3>
                    
                    <!-- Active bookings eligible for changes -->
                    <div class="card">
                        <div class="card-header">
                            <h4>Eligible Bookings for Changes</h4>
                        </div>
                        <div class="card-body">
                            <div class="empty-state">
                                <i class="fas fa-exchange-alt fa-3x"></i>
                                <h4>No eligible bookings</h4>
                                <p>You don't have any bookings eligible for changes at the moment.</p>
                                <button onclick="showPage('bookings')" class="btn-primary">
                                    <i class="fas fa-ticket-alt"></i> View My Bookings
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Change requests history -->
                    <div class="card mt-3">
                        <div class="card-header">
                            <h4>My Change Requests</h4>
                        </div>
                        <div class="card-body">
                            <div class="empty-state">
                                <i class="fas fa-history fa-3x"></i>
                                <h4>No change requests</h4>
                                <p>You haven't submitted any change requests yet.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div class="dashboard-tab" id="user-profile-tab">
                <div class="dashboard-section">
                    <h3><i class="fas fa-user"></i> Profile Settings</h3>
                    
                    <div class="profile-form-container">
                        <form id="profileForm" class="profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="userFirstName">First Name</label>
                                    <input type="text" id="userFirstName" value="John">
                                </div>
                                
                                <div class="form-group">
                                    <label for="userLastName">Last Name</label>
                                    <input type="text" id="userLastName" value="Doe">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="userEmail">Email Address</label>
                                <input type="email" id="userEmail" value="john.doe@example.com" disabled>
                                <small class="hint-text">Contact support to change email</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="userPhone">Phone Number</label>
                                <input type="tel" id="userPhone" value="+251 911 000 000">
                            </div>
                            
                            <div class="form-group">
                                <label for="userCountry">Country</label>
                                <select id="userCountry">
                                    <option value="ET" selected>Ethiopia</option>
                                    <option value="US">United States</option>
                                    <option value="GB">United Kingdom</option>
                                    <option value="AE">United Arab Emirates</option>
                                    <option value="SA">Saudi Arabia</option>
                                    <option value="KE">Kenya</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="userAddress">Address</label>
                                <textarea id="userAddress" rows="2" placeholder="Enter your address"></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                                <button type="button" class="btn-secondary" onclick="resetProfileForm()">
                                    <i class="fas fa-undo"></i> Cancel
                                </button>
                            </div>
                        </form>
                        
                        <!-- Password Change Section -->
                        <div class="password-section">
                            <h4><i class="fas fa-key"></i> Change Password</h4>
                            <form id="passwordForm">
                                <div class="form-group">
                                    <label for="currentPassword">Current Password</label>
                                    <input type="password" id="currentPassword" placeholder="Enter current password">
                                </div>
                                
                                <div class="form-group">
                                    <label for="newPassword">New Password</label>
                                    <input type="password" id="newPassword" placeholder="Enter new password">
                                </div>
                                
                                <div class="form-group">
                                    <label for="confirmNewPassword">Confirm New Password</label>
                                    <input type="password" id="confirmNewPassword" placeholder="Confirm new password">
                                </div>
                                
                                <button type="submit" class="btn-primary">
                                    <i class="fas fa-key"></i> Change Password
                                </button>
                            </form>
                        </div>
                        
                        <!-- Account Actions -->
                        <div class="account-actions">
                            <h4><i class="fas fa-cog"></i> Account Actions</h4>
                            <div class="action-buttons">
                                <button class="btn btn-secondary" onclick="exportUserData()">
                                    <i class="fas fa-download"></i> Export My Data
                                </button>
                                <button class="btn btn-danger" onclick="showDeleteAccountModal()">
                                    <i class="fas fa-trash"></i> Delete Account
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Saved Flights Tab -->
            <div class="dashboard-tab" id="user-saved-tab">
                <div class="dashboard-section">
                    <h3><i class="fas fa-bookmark"></i> Saved Flights</h3>
                    
                    <div class="saved-flights-list">
                        <div class="empty-state">
                            <i class="fas fa-bookmark fa-3x"></i>
                            <h4>No saved flights</h4>
                            <p>You haven't saved any flights yet.</p>
                            <p>When searching for flights, click the bookmark icon to save them here.</p>
                            <button onclick="showPage('flights')" class="btn-primary">
                                <i class="fas fa-search"></i> Search Flights
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Forgot Password Modal -->
<div id="forgotPasswordModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Reset Password</h2>
            <button class="close-modal" onclick="closeModal('forgotPasswordModal')">&times;</button>
        </div>
        <div class="modal-body">
            <p>Enter your email address and we'll send you a link to reset your password.</p>
            <div class="form-group">
                <label for="resetEmail">Email Address</label>
                <input type="email" id="resetEmail" placeholder="you@example.com">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('forgotPasswordModal')">Cancel</button>
            <button class="btn btn-primary" onclick="sendResetLink()">Send Reset Link</button>
        </div>
    </div>
</div>

<!-- Delete Account Modal -->
<div id="deleteAccountModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Delete Account</h2>
            <button class="close-modal" onclick="closeModal('deleteAccountModal')">&times;</button>
        </div>
        <div class="modal-body">
            <p style="color: var(--danger);"><i class="fas fa-exclamation-triangle"></i> <strong>Warning:</strong> This action cannot be undone.</p>
            <p>All your data, including bookings and saved flights, will be permanently deleted.</p>
            <div class="form-group">
                <label for="deleteConfirmPassword">Enter your password to confirm:</label>
                <input type="password" id="deleteConfirmPassword" placeholder="Enter your password">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal('deleteAccountModal')">Cancel</button>
            <button class="btn btn-danger" onclick="confirmDeleteAccount()">Delete My Account</button>
        </div>
    </div>
</div>
 </section>

        <!-- Other Pages (Coming Soon) -->
           <section id="hotels-page" class="page-section">
    <div class="search-container">
        <form class="search-form" id="hotelSearchForm">
            <div class="form-row">
                <div class="form-group">
                    <input type="text" id="hotelLocation" placeholder="City, region, or landmark" required>
                    <div class="suggestions" id="locationSuggestions"></div>
                </div>
                
                <div class="form-group">
                    <div class="date-input-wrapper">
                        <input type="date" id="checkIn" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="date-input-wrapper">
                        <input type="date" id="checkOut" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="passenger-input" id="roomTrigger">
                        <div class="passenger-display">
                            <i class="fas fa-bed"></i>
                            <span id="roomCount">1 Room, 2 Guests</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                    <div class="passengers-selector" id="roomsSelector">
                        <div class="passenger-type">
                            <span class="passenger-label">Rooms</span>
                            <div class="passenger-controls">
                                <button type="button" class="passenger-minus" data-type="rooms" disabled>âˆ’</button>
                                <input type="number" id="roomsCount" value="1" min="1" max="5" readonly>
                                <button type="button" class="passenger-plus" data-type="rooms">+</button>
                            </div>
                        </div>
                        <div class="passenger-type">
                            <span class="passenger-label">Adults</span>
                            <div class="passenger-controls">
                                <button type="button" class="passenger-minus" data-type="adultsHotel" disabled>âˆ’</button>
                                <input type="number" id="adultsHotel" value="2" min="1" max="10" readonly>
                                <button type="button" class="passenger-plus" data-type="adultsHotel">+</button>
                            </div>
                        </div>
                        <div class="passenger-type">
                            <span class="passenger-label">Children</span>
                            <div class="passenger-controls">
                                <button type="button" class="passenger-minus" data-type="childrenHotel" disabled>âˆ’</button>
                                <input type="number" id="childrenHotel" value="0" min="0" max="10" readonly>
                                <button type="button" class="passenger-plus" data-type="childrenHotel">+</button>
                            </div>
                        </div>
                        <div class="passenger-summary" id="roomsSummary">
                            Total: 1 Room, 2 Guests
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn-search">
                    <i class="fas fa-search"></i>
                    <span>SEARCH HOTELS</span>
                </button>
            </div>
        </form>
    </div>
    
    <!-- Hotel Results Section -->
    <div class="results-container hidden" id="hotelResults">
        <div class="results-header">
            <div>
                <h2 id="hotelSearchLocation">Search Results</h2>
                <p id="hotelSearchDates">Check-in: Jan 15 â€¢ Check-out: Jan 22 â€¢ 1 Room, 2 Guests</p>
            </div>
            <button class="btn btn-secondary" id="backToHotelSearch">
                <i class="fas fa-arrow-left"></i> Modify Search
            </button>
        </div>
        
        <!-- Hotel Filters -->
        <div class="hotel-filters">
            <div class="filter-group">
                <label for="sortHotels">Sort by:</label>
                <select id="sortHotels" onchange="sortHotels()">
                    <option value="price_low">Price (Low to High)</option>
                    <option value="price_high">Price (High to Low)</option>
                    <option value="rating">Rating (High to Low)</option>
                    <option value="stars">Stars (High to Low)</option>
                    <option value="name">Name (A-Z)</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filterStars">Star Rating:</label>
                <select id="filterStars" onchange="filterHotels()">
                    <option value="all">All Stars</option>
                    <option value="5">5 Stars</option>
                    <option value="4">4+ Stars</option>
                    <option value="3">3+ Stars</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filterPrice">Price Range:</label>
                <select id="filterPrice" onchange="filterHotels()">
                    <option value="all">All Prices</option>
                    <option value="budget">Budget</option>
                    <option value="mid">Mid-range</option>
                    <option value="luxury">Luxury</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="filterAmenities">Amenities:</label>
                <select id="filterAmenities" onchange="filterHotels()">
                    <option value="all">All Amenities</option>
                    <option value="pool">With Pool</option>
                    <option value="spa">With Spa</option>
                    <option value="wifi">Free WiFi</option>
                </select>
            </div>
        </div>
        
        <!-- Hotel Listings -->
        <div class="hotel-listings">
            <!-- Hotel cards will be inserted here by JavaScript -->
        </div>
    </div>
</section>
        <section id="packages-page" class="page-section">
            <div class="hero">
                <h1>Travel Packages</h1>
                <p>Flight + Hotel packages for the perfect vacation</p>
            </div>
            <div class="search-container">
                <h2 class="text-center mb-4">Packages Coming Soon!</h2>
                <p class="text-center">Our travel packages feature is currently under development.</p>
                <div class="text-center mt-4">
                    <a href="#flights" class="btn btn-primary" data-page="flights">
                        <i class="fas fa-arrow-left"></i> Back to Flights
                    </a>
                </div>
            </div>
        </section>

        <section id="deals-page" class="page-section">
            <div class="hero">
                <h1>Special Deals & Offers</h1>
                <p>Exclusive discounts and limited-time offers</p>
            </div>
            <div class="search-container">
                <h2 class="text-center mb-4">Deals Coming Soon!</h2>
                <p class="text-center">Our special deals feature is currently under development.</p>
                <div class="text-center mt-4">
                    <a href="#flights" class="btn btn-primary" data-page="flights">
                        <i class="fas fa-arrow-left"></i> Back to Flights
                    </a>
                </div>
            </div>
        </section>

    


        <section id="saved-page" class="page-section">
            <div class="hero">
                <h1>Saved Flights</h1>
                <p>Your saved flights and favorite destinations</p>
            </div>
            <div class="search-container">
                <h2 class="text-center mb-4">Saved Flights Coming Soon!</h2>
                <p class="text-center">You need to be logged in to view saved flights.</p>
                <div class="text-center mt-4">
                    <a href="#auth" class="btn btn-primary" data-page="auth">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </a>
                </div>
            </div>
        </section>

        <section id="alerts-page" class="page-section">
            <div class="hero">
                <h1>Price Alerts</h1>
                <p>Get notified when flight prices drop</p>
            </div>
            <div class="search-container">
                <h2 class="text-center mb-4">Price Alerts Coming Soon!</h2>
                <p class="text-center">You need to be logged in to set price alerts.</p>
                <div class="text-center mt-4">
                    <a href="#auth" class="btn btn-primary" data-page="auth">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </a>
                </div>
            </div>
        </section>
    </main>
</main>


<!-- Footer -->
<footer class="footer">
    <div class="footer-content">

        <!-- ðŸ”¹ TAB 1: BRAND / ABOUT -->
        <div class="footer-section">
            <h4>EthioFly âœˆ</h4>
            <p>
            </p>
            <div class="mt-3">
                <i class="fas fa-phone"></i> +251 919 012 120<br>
                <i class="fas fa-envelope"></i> info@ethiofly.com
            </div>
        </div>

        <!-- ðŸ”¹ TAB 3: COMPANY -->
        <div class="footer-section">
            <h4 class="footer-title">
                <i class="fas fa-building"></i> Company
            </h4>

            <a href="https://company.ethiofly.com/#about-page" class="footer-link">
                <i class="fas fa-info-circle"></i> About Us
            </a>

            <a href="https://company.ethiofly.com/#contact-page" class="footer-link">
                <i class="fas fa-phone-alt"></i> Contact Us
            </a>

            <a href="https://company.ethiofly.com/#faq-page" class="footer-link">
                <i class="fas fa-question-circle"></i> FAQ
            </a>
        </div>

        <!-- ðŸ”¹ TAB 4: LEGAL -->
        <div class="footer-section">
            <h4 class="footer-title">
                <i class="fas fa-balance-scale"></i> Legal
            </h4>

            <a href="https://company.ethiofly.com/#privacy-page" class="footer-link">
                <i class="fas fa-shield-alt"></i> Privacy Policy
            </a>

            <a href="https://company.ethiofly.com/#tos-page" class="footer-link">
                <i class="fas fa-file-contract"></i> Terms of Service
            </a>
    
           <!-- âœ… REFUND POLICY (NEW) -->
    <a href="https://company.ethiofly.com/#refund-policy" class="footer-link">
        <i class="fas fa-undo-alt"></i> Refund Policy
    </a>
</div>

        <!-- ðŸ”¹ TAB 5: SOCIAL -->
        <div class="footer-section">
            <h4>Connect With Us</h4>
            <div class="social-links">
                <a href="https://www.facebook.com/profile.php?id=61586029067420" target="_blank" rel="noopener">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="https://wa.me/251919012120" target="_blank" rel="noopener">
                    <i class="fab fa-whatsapp"></i>
                </a>
                <a href="#" title="Instagram">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="#" title="LinkedIn">
                    <i class="fab fa-linkedin"></i>
                </a>
                <a href="#" title="Telegram">
                    <i class="fab fa-telegram"></i>
                </a>
            </div>
        </div>

    </div>

    <!-- ðŸ”¹ FOOTER BOTTOM -->
    <div class="footer-bottom">
        <p>&copy; 2026 EthioFly. All rights reserved | Version 1.0</p>
    </div>
</footer>


    <script>
    // ============================================
    // Ethiofly Frontend Application - Complete JavaScript
    // ============================================

    // Configuration
   const API_BASE_URL = window.location.hostname === 'localhost' 
      ? 'http://localhost:3000' 
       : 'https://api.ethiofly.com';
            const SUPPORTED_CURRENCIES = [
                                { code: 'USD', symbol: '$', name: 'US Dollar', rate: 1 },
                              { code: 'ETB', symbol: 'Br', name: 'Ethiopian Birr', rate: 150.5 },
                               { code: 'EUR', symbol: 'â‚¬', name: 'Euro', rate: 0.85 },
            { code: 'GBP', symbol: 'Â£', name: 'British Pound', country: 'UK', rate: 0.74 },
            { code: 'AED', symbol: 'Ø¯.Ø¥', name: 'UAE Dirham', country: 'UAE', rate: 3.67 },
            { code: 'SAR', symbol: 'Ø±.Ø³', name: 'Saudi Riyal', country: 'Saudi Arabia', rate: 3.75 },
            { code: 'QAR', symbol: 'Ø±.Ù‚', name: 'Qatari Riyal', country: 'Qatar', rate: 3.63 },
            { code: 'TRY', symbol: 'â‚º', name: 'Turkish Lira', country: 'Turkey', rate: 43.70 },
            { code: 'KES', symbol: 'KSh', name: 'Kenyan Shilling', country: 'Kenya', rate: 129 },
            { code: 'CNY', symbol: 'Â¥', name: 'Chinese Yuan', country: 'China', rate: 6.95 }
        ];

        
        // State Management
        let currentFlights = [];
        let currentUser = JSON.parse(localStorage.getItem('ethiofly_user')) || null;
        let authToken = localStorage.getItem('ethiofly_token') || null;
        let currentPage = 'flights';
        let searchHistory = JSON.parse(localStorage.getItem('ethiofly_search_history')) || [];
        let currentCurrency = localStorage.getItem('ethiofly_currency') || DEFAULT_CURRENCY;
        let currencyRates = JSON.parse(localStorage.getItem('ethiofly_currency_rates')) || {};
        let lastRateUpdate = localStorage.getItem('ethiofly_last_rate_update');

        // DOM Elements
        let searchForm, fromInput, toInput, swapBtn, fromSuggestions, toSuggestions;

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Ethiofly Frontend Initializing...');
            
            // Initialize DOM Elements
            initializeDOMElements();
            
            // Initialize Currency System
            initializeCurrencySystem();
            
            // Setup Event Listeners
            setupEventListeners();
            
            // Initialize Page
            initializePage();
            
            console.log('âœ… Ethiofly Frontend Ready');
            
            // Set default dates
            setDefaultDates();
        });


        // Initialize DOM Elements
        function initializeDOMElements() {
            searchForm = document.getElementById('flightSearchForm');
            fromInput = document.getElementById('from');
            toInput = document.getElementById('to');
            swapBtn = document.getElementById('swapLocations');
            fromSuggestions = document.getElementById('fromSuggestions');
            toSuggestions = document.getElementById('toSuggestions');
        }

        // Initialize Currency System
        function initializeCurrencySystem() {
            if (!lastRateUpdate || Date.now() - parseInt(lastRateUpdate) > 24 * 60 * 60 * 1000) {
                fetchCurrencyRates();
            } else {
                updateAllCurrencyDisplays();
            }
            
            initializeCurrencyDropdown();
        }
// Passenger Management Functions
let passengerTrigger = null;

// Initialize Passenger System
function initializePassengerSystem() {
    passengerTrigger = document.getElementById('passengerTrigger');
    const passengersSelector = document.getElementById('passengersSelector');
    
    if (passengerTrigger && passengersSelector) {
        // Toggle dropdown on pointerup/click for reliable touch support
        const passengerToggleHandler = function(e) {
            e.stopPropagation();
            const isOpen = passengersSelector.classList.contains('show');
            passengersSelector.classList.toggle('show');
            passengerTrigger.classList.toggle('active', !isOpen);
            // Update accessibility attributes
            passengerTrigger.setAttribute('aria-expanded', String(!isOpen));
            passengersSelector.setAttribute('aria-hidden', String(isOpen));
            console.log('Passenger dropdown toggled:', !isOpen);
        };
        if (window.PointerEvent) passengerTrigger.addEventListener('pointerup', passengerToggleHandler);
        else passengerTrigger.addEventListener('click', passengerToggleHandler);
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!passengerTrigger.contains(e.target) && !passengersSelector.contains(e.target)) {
                passengersSelector.classList.remove('show');
                passengerTrigger.classList.remove('active');
                passengerTrigger.setAttribute('aria-expanded', 'false');
                passengersSelector.setAttribute('aria-hidden', 'true');
            }
        });
        
        // Initialize passenger controls
        initializePassengerControls();
        
        // Update initial display
        updatePassengerDisplay();
        updateSearchButtonState();
    }
}

// Initialize Passenger Controls
function initializePassengerControls() {
    const passengersSelector = document.getElementById('passengersSelector');
    if (!passengersSelector) return;

    // Delegate clicks to ensure handlers always work
    passengersSelector.addEventListener('click', function(e) {
        const btn = e.target.closest('.passenger-plus, .passenger-minus');
        if (!btn) return;
        e.stopPropagation();

        handlePassengerBtnClick(btn);
    });

    // Add direct listeners and mobile fallbacks on the buttons
    document.querySelectorAll('.passenger-plus, .passenger-minus').forEach(btn => {
        const handler = function(e) {
            if (e && typeof e.preventDefault === 'function') e.preventDefault();
            if (e && typeof e.stopPropagation === 'function') e.stopPropagation();
            handlePassengerBtnClick(btn);
        };

        // Prefer pointer events where available (covers mouse & touch). Fallback to click for older browsers.
        if (window.PointerEvent) {
            btn.addEventListener('pointerup', handler);
        } else {
            btn.addEventListener('click', handler);
            btn.addEventListener('touchend', handler, { passive: false });
        }

        // Accessibility: allow keyboard activation
        btn.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                handler(e);
            }
        });
    });

    // Shared handler used by both delegated and direct listeners
    function handlePassengerBtnClick(btn) {
        // Debounce duplicate events (touch + pointer + click) â€” ignore rapid repeats
        const now = Date.now();
        const last = parseInt(btn.dataset.lastClick || '0');
        if (now - last < 400) {
            console.log('Ignored duplicate passenger click for', btn.dataset.type);
            return;
        }
        btn.dataset.lastClick = now;

        const type = btn.dataset.type;
        const input = document.getElementById(`${type}Count`);
        if (!input) return;

        let value = parseInt(input.value) || 0;
        if (btn.classList.contains('passenger-plus')) {
            value = Math.min(value + 1, 8);
        } else {
            if (type === 'adults') value = Math.max(1, value - 1);
            else value = Math.max(0, value - 1);
        }

        input.value = value;
        console.log('Passenger control clicked (handler):', type, value);

        updatePassengerButtonStates();
        if (type === 'adults' || type === 'infants') validateInfantsCount();
        updateAllPassengerDisplays();
    }

    // Prevent manual input in passenger count fields
    document.querySelectorAll('.passenger-controls input').forEach(input => {
        input.addEventListener('keydown', function(e) {
            e.preventDefault();
        });

        input.addEventListener('focus', function() {
            this.blur();
        });
    });
}

// Update passenger button states (enable/disable)
function updatePassengerButtonStates() {
    const adults = parseInt(document.getElementById('adultsCount').value) || 1;
    const children = parseInt(document.getElementById('childrenCount').value) || 0;
    const infants = parseInt(document.getElementById('infantsCount').value) || 0;
    
    // Adult buttons
    const adultMinus = document.querySelector('.passenger-minus[data-type="adults"]');
    const adultPlus = document.querySelector('.passenger-plus[data-type="adults"]');
    if (adultMinus) adultMinus.disabled = adults <= 1;
    if (adultPlus) adultPlus.disabled = adults >= 9;
    
    // Children buttons
    const childMinus = document.querySelector('.passenger-minus[data-type="children"]');
    const childPlus = document.querySelector('.passenger-plus[data-type="children"]');
    if (childMinus) childMinus.disabled = children <= 0;
    if (childPlus) childPlus.disabled = children >= 8;
    
    // Infants buttons
    const infantMinus = document.querySelector('.passenger-minus[data-type="infants"]');
    const infantPlus = document.querySelector('.passenger-plus[data-type="infants"]');
    if (infantMinus) infantMinus.disabled = infants <= 0;
    if (infantPlus) infantPlus.disabled = infants >= adults || infants >= 8;
}

// Update all passenger-related displays
function updateAllPassengerDisplays() {
    updatePassengerDisplay();
    updatePassengerSummary();
    updatePassengerClassDisplay();
    updateSearchButtonState();
}

// Update Passenger Display (header text)
function updatePassengerDisplay() {
    const passengerCount = document.getElementById('passengerCount');
    if (!passengerCount) return;
    
    const passengersData = getPassengersData();
    
    // Format display text
    let displayText = '';
    if (passengersData.adults > 0) {
        displayText += `${passengersData.adults} Adult${passengersData.adults > 1 ? 's' : ''}`;
    }
    if (passengersData.children > 0) {
        displayText += `${displayText ? ', ' : ''}${passengersData.children} Child${passengersData.children > 1 ? 'ren' : ''}`;
    }
    if (passengersData.infants > 0) {
        displayText += `${displayText ? ', ' : ''}${passengersData.infants} Infant${passengersData.infants > 1 ? 's' : ''}`;
    }
    
    passengerCount.textContent = displayText || 'Add passengers';
}

// Update passenger summary in dropdown
function updatePassengerSummary() {
    const adults = parseInt(document.getElementById('adultsCount').value) || 1;
    const children = parseInt(document.getElementById('childrenCount').value) || 0;
    const infants = parseInt(document.getElementById('infantsCount').value) || 0;
    const total = adults + children + infants;
    
    const summary = document.getElementById('passengerSummary');
    if (summary) {
        let breakdown = [];
        if (adults > 0) breakdown.push(`${adults} Adult${adults !== 1 ? 's' : ''}`);
        if (children > 0) breakdown.push(`${children} Child${children !== 1 ? 'ren' : ''}`);
        if (infants > 0) breakdown.push(`${infants} Infant${infants !== 1 ? 's' : ''}`);
        
        summary.innerHTML = `
            <strong>Total: ${total} Passenger${total !== 1 ? 's' : ''}</strong>
            ${breakdown.length > 0 ? `<br><small>${breakdown.join(', ')}</small>` : ''}
        `;
    }
    
    return { adults, children, infants, total };
}

// Update passenger + class combined display (mobile)
function updatePassengerClassDisplay() {
    const display = document.getElementById('passengerClassDisplay');
    if (!display) return;
    const p = getPassengersData();
    const cls = document.getElementById('class')?.selectedOptions[0]?.text || 'Economy';
    const text = `${p.total} Passenger${p.total !== 1 ? 's' : ''}, ${cls}`;
    const pcText = display.querySelector('.pc-text');
    if (pcText) pcText.textContent = text;
}

// Validate infants don't exceed adults
function validateInfantsCount() {
    const adults = parseInt(document.getElementById('adultsCount').value) || 1;
    const infants = parseInt(document.getElementById('infantsCount').value) || 0;
    
    if (infants > adults) {
        document.getElementById('infantsCount').value = adults;
        // Update displays after correction
        updateAllPassengerDisplays();
        showNotification(`Maximum ${adults} infant${adults !== 1 ? 's' : ''} allowed (1 per adult)`, 'warning');
        return false;
    }
    return true;
}

// Get passengers data for search
function getPassengersData() {
    const adults = parseInt(document.getElementById('adultsCount').value) || 1;
    const children = parseInt(document.getElementById('childrenCount').value) || 0;
    const infants = parseInt(document.getElementById('infantsCount').value) || 0;
    const total = adults + children + infants;
    
    return {
        adults,
        children,
        infants,
        total,
        displayText: `${adults} Adult${adults !== 1 ? 's' : ''}` + 
                    (children > 0 ? `, ${children} Child${children !== 1 ? 'ren' : ''}` : '') + 
                    (infants > 0 ? `, ${infants} Infant${infants !== 1 ? 's' : ''}` : '')
    };
}

// Update search button text based on passenger count
function updateSearchButtonState() {
    const searchButton = document.querySelector('.btn-search');
    if (!searchButton) return;
    
    const passengersData = getPassengersData();
    const span = searchButton.querySelector('span') || document.createElement('span');
    
    if (passengersData.total > 1) {
        span.textContent = ` SEARCH (${passengersData.total} PERSONS)`;
    } else {
        span.textContent = ' SEARCH ';
    }
    
    // Ensure icon exists
    if (!searchButton.querySelector('i')) {
        const icon = document.createElement('i');
        icon.className = 'fas fa-search';
        searchButton.prepend(icon);
    }
    
    // Add span if it doesn't exist
    if (!searchButton.querySelector('span')) {
        searchButton.appendChild(span);
    }
}

// Validate passenger selection before search
function validatePassengerSelection() {
    const passengersData = getPassengersData();
    
    if (passengersData.total === 0) {
        showNotification('Please select at least 1 passenger', 'warning');
        // Open dropdown
        if (passengerTrigger) {
            passengerTrigger.click();
        }
        return false;
    }
    
    if (passengersData.total > 9) {
        showNotification('Maximum 9 passengers allowed per booking', 'warning');
        return false;
    }
    
    return validateInfantsCount();
}

// Close passenger dropdown
function closePassengerDropdown() {
    const passengersSelector = document.getElementById('passengersSelector');
    if (passengersSelector) {
        passengersSelector.classList.remove('show');
    }
    if (passengerTrigger) {
        passengerTrigger.classList.remove('active');
    }
}

// Initialize the passenger system on DOM ready
document.addEventListener('DOMContentLoaded', function() {
    console.log('ðŸš€ Ethiofly Frontend Initializing...');
    
    // Initialize DOM Elements
    initializeDOMElements();
    
    // Initialize Currency System
    initializeCurrencySystem();
    
    // Initialize Passenger System
    initializePassengerSystem();
    
    // Setup Event Listeners
    setupEventListeners();
    
    // Initialize Page
    initializePage();
    
    console.log('âœ… Ethiofly Frontend Ready');
});

       async function fetchCurrencyRates() {
            try {
                console.log('ðŸ”„ Fetching currency rates...');
                
                const mockRates = SUPPORTED_CURRENCIES.reduce((acc, curr) => {
                    const variation = 1 + (Math.random() * 0.1 - 0.05);
                    acc[curr.code] = curr.rate * variation;
                    return acc;
                }, {});
                
                currencyRates = mockRates;
                lastRateUpdate = Date.now();
                
                localStorage.setItem('ethiofly_currency_rates', JSON.stringify(currencyRates));
                localStorage.setItem('ethiofly_last_rate_update', lastRateUpdate);
                
                updateAllCurrencyDisplays();
                console.log('âœ… Currency rates updated');
                
            } catch (error) {
                console.error('âŒ Failed to fetch currency rates:', error);
                currencyRates = SUPPORTED_CURRENCIES.reduce((acc, curr) => {
                    acc[curr.code] = curr.rate;
                    return acc;
                }, {});
                updateAllCurrencyDisplays();
            }
        }
 function initializeCurrencyDropdown() {
            const currencyDropdown = document.getElementById('currencyDropdown');
            if (!currencyDropdown) return;
            
            currencyDropdown.innerHTML = '';
            
            SUPPORTED_CURRENCIES.forEach(currency => {
                const option = document.createElement('div');
                option.className = `currency-option ${currency.code === currentCurrency ? 'active' : ''}`;
                option.innerHTML = `
                    <div class="currency-symbol">${currency.symbol}</div>
                    <div>
                        <div class="currency-code">${currency.code}</div>
                        <div class="currency-name">${currency.name}</div>
                    </div>
                `;
                
                option.addEventListener('click', () => setCurrency(currency.code));
                currencyDropdown.appendChild(option);
            });
        }

        function setCurrency(currencyCode) {
            if (SUPPORTED_CURRENCIES.some(c => c.code === currencyCode)) {
                currentCurrency = currencyCode;
                localStorage.setItem('ethiofly_currency', currencyCode);
                
                updateCurrencyDisplay();
                updateAllCurrencyDisplays();
                
                const currency = SUPPORTED_CURRENCIES.find(c => c.code === currencyCode);
                showNotification(`Currency changed to ${currency.name} (${currency.code})`, 'success');
                
                if (currentFlights.length > 0) {
                    updateFlightCardsCurrency();
                }
                
                updatePopularDestinationsPrices();
            }
        }

       
        function updateCurrencyDisplay() {
            const currentCurrencyElement = document.getElementById('currentCurrency');
            if (currentCurrencyElement) {
                currentCurrencyElement.textContent = currentCurrency;
            }
            
            document.querySelectorAll('.currency-option').forEach(option => {
                option.classList.remove('active');
                if (option.querySelector('.currency-code').textContent === currentCurrency) {
                    option.classList.add('active');
                }
            });
        }

        function updateAllCurrencyDisplays() {
            updateCurrencyDisplay();
            
            if (currentFlights.length > 0) {
                updateFlightCardsCurrency();
            }
            
            updatePopularDestinationsPrices();
            updateSearchHeaderCurrency();
        }

        function updateFlightCardsCurrency() {
            currentFlights.forEach(flight => {
                updateFlightCardPrice(flight.id, flight.price, flight.currency);
                updatePriceBreakdown(flight.id, flight.price, flight.currency);
            });
        }

       function updateFlightCardPrice(flightId, originalPrice, originalCurrency) {
            const priceElement = document.getElementById(`priceDisplay-${flightId}`);
            const noteElement = document.getElementById(`conversionNote-${flightId}`);
            
            if (!priceElement || !noteElement) return;
            
            const passengersData = getPassengersData();
            const pricePerPerson = convertCurrency(originalPrice, originalCurrency, currentCurrency);
            const totalPrice = pricePerPerson * passengersData.total;
            
            const currencyInfo = SUPPORTED_CURRENCIES.find(c => c.code === currentCurrency);
            
            priceElement.innerHTML = `
                <div class="price-with-currency">
                    <div class="currency-symbol-large">${currencyInfo.symbol}</div>
                    <div class="price-amount-large">${formatNumber(totalPrice)}</div>
                    ${passengersData.total > 1 ? 
                        `<div class="per-person">(${currencyInfo.symbol}${formatNumber(pricePerPerson)} per person)</div>` : 
                        ''
                    }
                    ${currentCurrency !== originalCurrency ? 
                        `<div class="price-original">${originalCurrency} ${formatNumber(originalPrice * passengersData.total)}</div>` : 
                        ''
                    }
                </div>
            `;
        }

        function convertCurrency(amount, fromCurrency, toCurrency) {
            if (fromCurrency === toCurrency) return amount;
            
            const fromRate = currencyRates[fromCurrency] || 1;
            const toRate = currencyRates[toCurrency] || 1;
            
            const baseAmount = amount / fromRate;
            return baseAmount * toRate;
        }

        function formatNumber(num) {
            return Math.round(num).toLocaleString('en-US');
        }

        function updatePopularDestinationsPrices() {
            const destinations = [
                { city: 'Dubai', code: 'DXB', basePrice: 45000 },
                { city: 'Istanbul', code: 'IST', basePrice: 58200 },
                { city: 'Nairobi', code: 'NBO', basePrice: 28750 },
                { city: 'London', code: 'LHR', basePrice: 75300 }
            ];
            
            const destinationCards = document.querySelectorAll('.destination-card');
            destinationCards.forEach((card, index) => {
                const dest = destinations[index];
                if (dest) {
                    const priceElement = card.querySelector('.destination-price');
                    if (priceElement) {
                        const convertedPrice = convertCurrency(dest.basePrice, 'ETB', currentCurrency);
                        const currencyInfo = SUPPORTED_CURRENCIES.find(c => c.code === currentCurrency);
                        if (currencyInfo) {
                            priceElement.textContent = `${currencyInfo.symbol}${formatNumber(convertedPrice)}`;
                        }
                    }
                }
            });
        }
  function updateSearchHeaderCurrency() {
            const resultsHeader = document.querySelector('.results-header');
            if (resultsHeader) {
                let currencyDisplay = resultsHeader.querySelector('.currency-display');
                if (!currencyDisplay) {
                    currencyDisplay = document.createElement('div');
                    currencyDisplay.className = 'currency-display';
                    resultsHeader.querySelector('div:first-child').appendChild(currencyDisplay);
                }
                
                const currencyInfo = SUPPORTED_CURRENCIES.find(c => c.code === currentCurrency);
                currencyDisplay.innerHTML = `
                    <i class="fas fa-money-bill-wave"></i>
                    <span class="currency-symbol">${currencyInfo.symbol}</span>
                    <span>${currentCurrency}</span>
                `;
            }
        }
        // Setup Event Listeners
        function setupEventListeners() {
            // Search form submission
            if (searchForm) {
                searchForm.addEventListener('submit', handleFlightSearch);
            }
            
            // Airport input suggestions
            if (fromInput) {
                fromInput.addEventListener('input', () => showAirportSuggestions(fromInput, fromSuggestions));
                fromInput.addEventListener('focus', () => showAirportSuggestions(fromInput, fromSuggestions));
            }
            
            if (toInput) {
                toInput.addEventListener('input', () => showAirportSuggestions(toInput, toSuggestions));
                toInput.addEventListener('focus', () => showAirportSuggestions(toInput, toSuggestions));
            }
            
            // Swap locations - support pointerup and click with debounce
            if (swapBtn) {
                const swapHandler = function(e) {
                    if (e && typeof e.preventDefault === 'function') e.preventDefault();
                    const now = Date.now();
                    const last = parseInt(swapBtn.dataset.lastClick || '0');
                    if (now - last < 350) { console.log('Ignored duplicate swap click'); return; }
                    swapBtn.dataset.lastClick = now;
                    swapLocations();
                };
                if (window.PointerEvent) swapBtn.addEventListener('pointerup', swapHandler);
                else swapBtn.addEventListener('click', swapHandler);
            }
             
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const page = this.getAttribute('onclick')?.match(/showPage\('(.*?)'\)/)?.[1];
                if (page) showPage(page);
            });
            });


            
            // Navigation
            document.querySelectorAll('.nav-link[data-page]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    navigateToPage(this.dataset.page);
                });
            });
            
// Search tabs â€” container delegation for reliable touch/mutation support
            const searchTabsContainer = document.querySelector('.search-tabs');
            if (searchTabsContainer) {
                const tabHandler = function(e) {
                    const tab = e.target.closest('.search-tab');
                    if (!tab) return;
                    if (e && typeof e.preventDefault === 'function') e.preventDefault();
                    if (e && typeof e.stopPropagation === 'function') e.stopPropagation();
                    const now = Date.now();
                    const last = parseInt(tab.dataset.lastClick || '0');
                    if (now - last < 350) { console.log('Ignored duplicate tab activation', tab.dataset.type); return; }
                    tab.dataset.lastClick = now;
                    handleSearchTabClick(tab);
                };

                if (window.PointerEvent) searchTabsContainer.addEventListener('pointerup', tabHandler);
                else searchTabsContainer.addEventListener('click', tabHandler);

                // keyboard support inside the container
                searchTabsContainer.addEventListener('keydown', function(e) {
                    const tab = e.target.closest('.search-tab');
                    if (!tab) return;
                    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); tabHandler(e); }
                });
            } else {
                // Fallback to per-tab handlers (older browsers)
                document.querySelectorAll('.search-tab').forEach(tab => {
                    const handler = function(e) {
                        if (e && typeof e.preventDefault === 'function') e.preventDefault();
                        if (e && typeof e.stopPropagation === 'function') e.stopPropagation();
                        const now = Date.now();
                        const last = parseInt(tab.dataset.lastClick || '0');
                        if (now - last < 350) { console.log('Ignored duplicate tab activation', tab.dataset.type); return; }
                        tab.dataset.lastClick = now;
                        handleSearchTabClick(tab);
                    };

                    if (window.PointerEvent) {
                        tab.addEventListener('pointerup', handler);
                    } else {
                        tab.addEventListener('click', handler);
                        tab.addEventListener('touchend', handler, { passive: false });
                    }

                    tab.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handler(e); }
                    });
                });
            }



           
        // Profile Tabs
        document.querySelectorAll('.profile-nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                switchProfileTab(this.dataset.tab);
            });
        });

            // Login Form
        document.getElementById('loginFormActual')?.addEventListener('submit', handleLogin);
        
        // Signup Form
        document.getElementById('signupFormActual')?.addEventListener('submit', handleSignup);
        
        // Profile Form
        document.getElementById('personalForm')?.addEventListener('submit', handleProfileUpdate);
        
        // Password Form
        document.getElementById('passwordForm')?.addEventListener('submit', handlePasswordChange);
        
        // Logout
        document.getElementById('logoutBtn')?.addEventListener('click', handleLogout);
        
        // Delete Account
        document.getElementById('deleteAccountBtn')?.addEventListener('click', handleDeleteAccount);
        
        // Cancel Changes
        document.getElementById('cancelChanges')?.addEventListener('click', resetProfileForm);
        
        // User Menu
        document.getElementById('userMenuBtn')?.addEventListener('click', toggleUserDropdown);
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.user-menu')) {
                document.getElementById('userDropdown').style.display = 'none';
            }
        });

       const backToSearch = document.getElementById("backToSearch");

if (backToSearch) {
    backToSearch.addEventListener("click", () => {

        // âœ… Clear stored flights so refresh won't restore results
        localStorage.removeItem("ethiofly_flights");
        localStorage.removeItem("ethiofly_search_data");

        // âœ… IMPORTANT: Clear session state
        sessionStorage.removeItem("onResultsPage");

        // âœ… Clear hash
        window.location.hash = "";

        // âœ… Show full search form correctly
        showSearchForm();
    });
}
            
            // Profile nav buttons
            document.querySelectorAll('.profile-nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    handleProfileTabClick(this);
                });
            });
            
            // Close suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.matches('#from, #to, .suggestion-item')) {
                    hideSuggestions();
                }
            });

            // Update passenger/class combined display when class changes
            document.getElementById('class')?.addEventListener('change', updatePassengerClassDisplay);

            // Make passengerClassDisplay open the passenger dropdown on click/keyboard
            const pcDisplay = document.getElementById('passengerClassDisplay');
            if (pcDisplay) {
                pcDisplay.addEventListener('click', function() {
                    document.getElementById('passengerTrigger')?.click();
                });
                pcDisplay.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        document.getElementById('passengerTrigger')?.click();
                    }
                });
            }

            // Mobile header quick nav buttons
            document.querySelectorAll('.mobile-header-nav .mh-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const page = this.dataset.page;
                    if (page) showPage(page);

                    // Update active state
                    document.querySelectorAll('.mobile-header-nav .mh-btn').forEach(b => {
                        b.classList.remove('active');
                        b.removeAttribute('aria-current');
                    });
                    this.classList.add('active');
                    this.setAttribute('aria-current', 'page');
                });
            });
        }

        // Initialize Page
        function initializePage() {
            setDefaultDates();
            updateUserUI();
            loadSavedSearch();
            checkUrlHash();
            initializeCurrencyDropdown();
            updatePopularDestinationsPrices();
        }

     // Set default dates for search form
        function setDefaultDates() {
            const today = new Date();
            const nextWeek = new Date(today);
            nextWeek.setDate(today.getDate() + 7);
            
            const departureInput = document.getElementById('departure');
            const returnInput = document.getElementById('return');
            
            if (departureInput) {
                departureInput.min = formatDate(today);
                departureInput.value = formatDate(nextWeek);
            }
            
            if (returnInput) {
                returnInput.min = formatDate(nextWeek);
                const twoWeeksLater = new Date(nextWeek);
                twoWeeksLater.setDate(nextWeek.getDate() + 7);
                returnInput.value = formatDate(twoWeeksLater);
            }
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

            // ============================================
        // AUTHENTICATION FUNCTIONS
        // ============================================
    // Switch Auth Tab
    function switchAuthTab(tabName) {
        // Update tabs
        document.querySelectorAll('.auth-tab').forEach(tab => {
            tab.classList.remove('active');
            if (tab.dataset.auth === tabName) {
                tab.classList.add('active');
            }
        });
        
        // Update forms
        document.querySelectorAll('.auth-form').forEach(form => {
            form.classList.remove('active');
        });
        document.getElementById(tabName + 'Form').classList.add('active');
    }

          // Handle Login
async function handleLogin(e) {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    const remember = document.getElementById('remember').checked;
    
    // Clear errors
    clearErrors('login');
    
    // Validate
    if (!email || !password) {
        showError('loginEmailError', 'Please enter email and password');
        return;
    }
    
    // Show loading
    const button = e.target.querySelector('button[type="submit"]');
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
    button.disabled = true;
    
    try {
        // Get existing users
        const users = JSON.parse(localStorage.getItem('ethiofly_users')) || [];
        
        // Find user by email
        const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());
        
        if (!user) {
            // User not found
            showError('loginEmailError', 'No account found with this email. <a href="#" onclick="switchAuthTab(\'signup\')">Sign up instead?</a>');
            button.innerHTML = originalText;
            button.disabled = false;
            return;
        }
        
        // Check password
        if (user.password !== password) {
            showError('loginPasswordError', 'Incorrect password. Please try again.');
            
            // Add shake animation to password field
            const passwordInput = document.getElementById('loginPassword');
            passwordInput.classList.add('shake');
            setTimeout(() => {
                passwordInput.classList.remove('shake');
            }, 500);
            
            // Clear password field
            passwordInput.value = '';
            passwordInput.focus();
            
            button.innerHTML = originalText;
            button.disabled = false;
            return;
        }
        
        // Password is correct - proceed with login
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Update last login
        user.lastLogin = new Date().toISOString();
        
        // Update user in storage
        const userIndex = users.findIndex(u => u.id === user.id);
        if (userIndex !== -1) {
            users[userIndex] = user;
            localStorage.setItem('ethiofly_users', JSON.stringify(users));
        }
        
        // Save user to localStorage
        localStorage.setItem('ethiofly_user', JSON.stringify(user));
        if (remember) {
            localStorage.setItem('ethiofly_token', 'demo_token_' + Date.now());
        }
        
        // Update global state
        currentUser = user;
        authToken = localStorage.getItem('ethiofly_token');
        isLoggedIn = true;
        
        // Update UI
        showUserMenu();
        loadUserProfile();
        
        // Clear form
        document.getElementById('loginFormActual').reset();
        
        // Show success message
        showNotification('âœ… Login successful! Welcome back ' + user.firstName, 'success');
        
        // Redirect to profile page
        setTimeout(() => {
            showPage('profile');
        }, 1000);
        
    } catch (error) {
        console.error('Login error:', error);
        showError('loginEmailError', 'Login failed. Please try again.');
        showNotification('âŒ Login failed. Please check your connection.', 'error');
    } finally {
        // Reset button
        button.innerHTML = originalText;
        button.disabled = false;
    }
}
        // Handle Signup
  async function handleSignup(e) {
    e.preventDefault();
    
    const fullName = document.getElementById('signupFullName').value;
    const email = document.getElementById('signupEmail').value;
    const phone = document.getElementById('signupPhone').value;
    const password = document.getElementById('signupPassword').value;
    const confirmPassword = document.getElementById('signupConfirmPassword').value;
    const terms = document.getElementById('signupTerms').checked;
    
    // Clear all errors
    clearErrors('signup');
    
    // Validation flags
    let isValid = true;
    
    // Validate full name
    if (!fullName || fullName.trim().split(' ').length < 2) {
        showError('signupNameError', 'Please enter your full name (first and last name)');
        isValid = false;
    }
    
    // Validate email
    if (!email) {
        showError('signupEmailError', 'Email address is required');
        isValid = false;
    } else if (!validateEmailFormat(email)) {
        showError('signupEmailError', 'Please enter a valid email address');
        isValid = false;
    } else if (checkEmailExists(email)) {
        showError('signupEmailError', 'This email is already registered. <a href="#" onclick="switchToLogin(\'' + email + '\')" style="color: #2563eb;">Login instead?</a>');
        isValid = false;
    }
    
    // Validate phone
    if (!phone) {
        showError('signupPhoneError', 'Phone number is required');
        isValid = false;
    } else if (!validatePhone(phone)) {
        showError('signupPhoneError', 'Please enter a valid phone number (e.g., +251 911 123 456)');
        isValid = false;
    }
    
    // Validate password
    if (!password) {
        showError('signupPasswordError', 'Password is required');
        isValid = false;
    } else if (password.length < 8) {
        showError('signupPasswordError', 'Password must be at least 8 characters long');
        isValid = false;
    } else if (!/(?=.*[a-zA-Z])(?=.*\d)/.test(password)) {
        showError('signupPasswordError', 'Password must contain both letters and numbers');
        isValid = false;
    }
    
    // Validate confirm password
    if (!confirmPassword) {
        showError('signupConfirmPasswordError', 'Please confirm your password');
        isValid = false;
    } else if (password !== confirmPassword) {
        showError('signupConfirmPasswordError', 'Passwords do not match');
        isValid = false;
    }
    
    // Validate terms
    if (!terms) {
        showError('signupConfirmPasswordError', 'Please accept the Terms of Service and Privacy Policy');
        isValid = false;
    }
    
    if (!isValid) {
        // Show notification for validation errors
        showNotification('Please fix the errors in the form', 'warning');
        return;
    }
    
    // Show loading
    const button = e.target.querySelector('button[type="submit"]');
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating account...';
    button.disabled = true;
    
    try {
        // Simulate API call delay
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Double-check email doesn't exist (in case of race condition)
        if (checkEmailExists(email)) {
            showError('signupEmailError', 'This email was just registered. Please try logging in.');
            button.innerHTML = originalText;
            button.disabled = false;
            return;
        }
        
        // Create new user
        const nameParts = fullName.trim().split(' ');
        const firstName = nameParts[0];
        const lastName = nameParts.slice(1).join(' ');
        
        const newUser = {
            id: 'user_' + Date.now(),
            firstName: firstName,
            lastName: lastName,
            email: email,
            phone: phone,
            password: password,
            bookings: 0,
            saved: 0,
            alerts: 0,
            memberSince: new Date().getFullYear(),
            createdAt: new Date().toISOString(),
            lastLogin: new Date().toISOString()
        };
        
          // Save user to users list
        const users = JSON.parse(localStorage.getItem('ethiofly_users')) || [];
        users.push(newUser);
        localStorage.setItem('ethiofly_users', JSON.stringify(users));
        
        // Save as current user
        localStorage.setItem('ethiofly_user', JSON.stringify(newUser));
        localStorage.setItem('ethiofly_token', 'demo_token_' + Date.now());
        
        // Update global state
        currentUser = newUser;
        authToken = localStorage.getItem('ethiofly_token');
        isLoggedIn = true;
        
        // Update UI
        showUserMenu();
        loadUserProfile();
        
        // Clear form
        document.getElementById('signupFormActual').reset();
        
        // Show success message
        showNotification('ðŸŽ‰ Account created successfully! Welcome to Ethiofly', 'success');
              // Auto-login and redirect to profile
        setTimeout(() => {
            showPage('profile');
        }, 1000);
        
    } catch (error) {
        console.error('Signup error:', error);
        showNotification('âŒ Failed to create account. Please try again.', 'error');
        showError('signupEmailError', 'Signup failed. Please try again.');
    } finally {
        // Reset button
        button.innerHTML = originalText;
        button.disabled = false;
    }
}

    function handleLogout() {
    if (confirm('Are you sure you want to logout?')) {

        // Clear current user & token
        currentUser = null;
        authToken = null;
        isLoggedIn = false;
        localStorage.removeItem('ethiofly_user');
        localStorage.removeItem('ethiofly_token');

        // Update UI: show login/register buttons, hide user menu
        showAuthButtons(); // Make sure this function shows #authButtons and hides #userMenu
        document.getElementById('userMenu').classList.add('hidden'); 
        document.getElementById('authButtons').classList.remove('hidden');

        // Redirect to flights page
        showPage('flights');

        // Show notification
        showNotification('Logged out successfully', 'success');
    }
}

    // Handle Delete Account
    function handleDeleteAccount() {
        if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
            // Remove user from users list
            const users = JSON.parse(localStorage.getItem('ethiofly_users')) || [];
            const updatedUsers = users.filter(u => u.email !== currentUser.email);
            localStorage.setItem('ethiofly_users', JSON.stringify(updatedUsers));
            
            // Clear user data
            localStorage.removeItem('ethiofly_user');
            localStorage.removeItem('ethiofly_token');
            
            currentUser = null;
            authToken = null;
            
            // Update UI
            showAuthButtons();
            
            // Show notification
            showNotification('Account deleted successfully', 'success');
            
            // Redirect to flights page
            showPage('flights');
        }
    }


   // ============================================
    // PROFILE FUNCTIONS
    // ============================================

    // Load User Profile
    function loadUserProfile() {
        if (!currentUser) return;
        
        // Update profile header
        document.getElementById('profileFullName').textContent = currentUser.firstName + ' ' + currentUser.lastName;
        document.getElementById('profileEmail').textContent = currentUser.email;
        document.getElementById('avatarInitials').textContent = 
            (currentUser.firstName[0] + currentUser.lastName[0]).toUpperCase();
        
        // Update stats
        document.getElementById('bookingsCount').textContent = currentUser.bookings || 0;
        document.getElementById('savedCount').textContent = currentUser.saved || 0;
        document.getElementById('alertsCount').textContent = currentUser.alerts || 0;
        document.getElementById('memberSince').textContent = currentUser.memberSince || 2026;
        
        // Update user menu
        document.getElementById('userName').textContent = currentUser.firstName;
        
        // Update profile form
        document.getElementById('firstName').value = currentUser.firstName;
        document.getElementById('lastName').value = currentUser.lastName;
        document.getElementById('email').value = currentUser.email;
        document.getElementById('phone').value = currentUser.phone;
        
        // Load additional profile data if available
        if (currentUser.birthDate) {
            document.getElementById('birthDate').value = currentUser.birthDate;
        }
        
        if (currentUser.nationality) {
            document.getElementById('nationality').value = currentUser.nationality;
        }
    }

    // Handle Profile Update
    async function handleProfileUpdate(e) {
        e.preventDefault();
        
        if (!currentUser) return;
        
        const firstName = document.getElementById('firstName').value;
        const lastName = document.getElementById('lastName').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;
        const birthDate = document.getElementById('birthDate').value;
        const nationality = document.getElementById('nationality').value;
        
        // Validate
        if (!firstName || !lastName || !email || !phone) {
            showNotification('Please fill in all required fields', 'error');
            return;
        }
        
        if (!validateEmail(email)) {
            showNotification('Please enter a valid email address', 'error');
            return;
        }
        
        if (!validatePhone(phone)) {
            showNotification('Please enter a valid phone number', 'error');
            return;
        }
        
        // Show loading
        const button = e.target.querySelector('button[type="submit"]');
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        button.disabled = true;
        
        try {
            // Update user data
            currentUser.firstName = firstName;
            currentUser.lastName = lastName;
            currentUser.email = email;
            currentUser.phone = phone;
            currentUser.birthDate = birthDate;
            currentUser.nationality = nationality;
            
            // Update in localStorage
            localStorage.setItem('ethiofly_user', JSON.stringify(currentUser));
            
            // Update users list
            const users = JSON.parse(localStorage.getItem('ethiofly_users')) || [];
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('ethiofly_users', JSON.stringify(users));
            }
            
            // Update UI
            loadUserProfile();
            
            // Show success message
            showNotification('Profile updated successfully', 'success');
            
        } catch (error) {
            console.error('Profile update error:', error);
            showNotification('Failed to update profile', 'error');
        } finally {
            // Reset button
            button.innerHTML = originalText;
            button.disabled = false;
        }
    }

    // Handle Password Change
    async function handlePasswordChange(e) {
        e.preventDefault();
        
        if (!currentUser) return;
        
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmNewPassword = document.getElementById('confirmNewPassword').value;
        
        // Clear errors
        clearErrors('password');
        
        // Validate
        if (!currentPassword) {
            showError('currentPasswordError', 'Please enter current password');
            return;
        }
        
        if (!newPassword || newPassword.length < 8) {
            showError('newPasswordError', 'Password must be at least 8 characters');
            return;
        }
        
        if (newPassword !== confirmNewPassword) {
            showError('confirmNewPasswordError', 'Passwords do not match');
            return;
        }
        
        // Check current password
        if (currentPassword !== currentUser.password) {
            showError('currentPasswordError', 'Current password is incorrect');
            return;
        }
        
        // Show loading
        const button = e.target.querySelector('button[type="submit"]');
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Changing...';
        button.disabled = true;
        
        try {
            // Update password
            currentUser.password = newPassword;
            
            // Update in localStorage
            localStorage.setItem('ethiofly_user', JSON.stringify(currentUser));
            
            // Update users list
            const users = JSON.parse(localStorage.getItem('ethiofly_users')) || [];
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].password = newPassword;
                localStorage.setItem('ethiofly_users', JSON.stringify(users));
            }
            
            // Clear form
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmNewPassword').value = '';
            
            // Show success message
            showNotification('Password changed successfully', 'success');
            
        } catch (error) {
            console.error('Password change error:', error);
            showNotification('Failed to change password', 'error');
        } finally {
            // Reset button
            button.innerHTML = originalText;
            button.disabled = false;
        }
    }

    // Reset Profile Form
    function resetProfileForm() {
        if (currentUser) {
            loadUserProfile();
        }
    }

    // Switch Profile Tab
    function switchProfileTab(tabName) {
        // Update tabs
        document.querySelectorAll('.profile-nav-btn').forEach(tab => {
            tab.classList.remove('active');
            if (tab.dataset.tab === tabName) {
                tab.classList.add('active');
            }
        });
        
        // Update content
        document.querySelectorAll('.profile-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        document.getElementById(tabName + 'Tab').classList.add('active');
    }

    // Show User Menu
    function showUserMenu() {
        document.getElementById('authButtons').style.display = 'none';
        document.getElementById('userMenu').style.display = 'block';
    }
 // Show Auth Buttons
    function showAuthButtons() {
        document.getElementById('authButtons').style.display = 'flex';
        document.getElementById('userMenu').style.display = 'none';
    }

    // Toggle User Dropdown
    function toggleUserDropdown() {
        const dropdown = document.getElementById('userDropdown');
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    }


        // Load saved flights
        async function loadSavedFlights() {
            if (!currentUser) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/saved-flights`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    displaySavedFlights(data.data);
                }
            } catch (error) {
                console.error('Load saved flights error:', error);
            }
        }

        // Display saved flights
        function displaySavedFlights(flights) {
            const savedFlightsList = document.getElementById('savedFlightsList');
            if (!savedFlightsList) return;
            
            if (!flights || flights.length === 0) {
                savedFlightsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bookmark fa-3x mb-3"></i>
                        <h4>No saved flights</h4>
                        <p>You haven't saved any flights yet.</p>
                    </div>
                `;
                return;
            }
            
            savedFlightsList.innerHTML = '';
            flights.forEach(flight => {
                const flightCard = createFlightCard(flight);
                savedFlightsList.appendChild(flightCard);
            });
        }

         // ============================================
    // PAGE NAVIGATION FUNCTIONS
    // ============================================

    // Show Page
    function showPage(pageName) {
        // Hide all pages
        document.querySelectorAll('.page-section').forEach(page => {
            page.classList.remove('active');
        });
        
        // Show selected page
        const pageElement = document.getElementById(pageName + '-page');
        if (pageElement) {
            pageElement.classList.add('active');
            currentPage = pageName;
            
            // Update URL hash
            window.location.hash = pageName;
            
            // Update navigation
            updateNavigation();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }

     // Update Navigation
    function updateNavigation() {
        // Update nav links (desktop)
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
            const page = link.getAttribute('onclick')?.match(/showPage\('(.*?)'\)/)?.[1];
            if (page === currentPage) {
                link.classList.add('active');
            }
        });

        // Update mobile header quick nav
        document.querySelectorAll('.mobile-header-nav .mh-btn').forEach(b => {
            b.classList.remove('active');
            b.removeAttribute('aria-current');
            if (b.dataset.page === currentPage) {
                b.classList.add('active');
                b.setAttribute('aria-current', 'page');
            }
        });
        
        // Close mobile menu
        document.getElementById('navLinks').classList.remove('show');
    }

    // Toggle Mobile Menu
    function toggleMobileMenu() {
        document.getElementById('navLinks').classList.toggle('show');
    }

        // Handle profile tab click
        function handleProfileTabClick(tab) {
            document.querySelectorAll('.profile-nav-btn').forEach(t => {
                t.classList.remove('active');
            });
            document.querySelectorAll('.profile-tab').forEach(t => {
                t.classList.remove('active');
            });
            
            tab.classList.add('active');
            const tabId = tab.dataset.tab;
            const tabElement = document.getElementById(`${tabId}Tab`);
            if (tabElement) {
                tabElement.classList.add('active');
            }
        }

        // Check URL hash for page navigation
        function checkUrlHash() {
            const hash = window.location.hash.substring(1);
            if (hash && document.getElementById(`${hash}-page`)) {
                navigateToPage(hash);
            }
        }



         // Handle search tab clicks
        function handleSearchTabClick(tab) {
            document.querySelectorAll('.search-tab').forEach(t => {
                t.classList.remove('active');
            });
            tab.classList.add('active');
            
            const type = tab.dataset.type;
            const returnInput = document.getElementById('return');
            
            if (type === 'oneway') {
                if (returnInput) {
                    returnInput.disabled = true;
                    returnInput.value = '';
                }
            } else if (type === 'round') {
                if (returnInput) {
                    returnInput.disabled = false;
                    if (!returnInput.value) {
                        const departureInput = document.getElementById('departure');
                        if (departureInput && departureInput.value) {
                            const departureDate = new Date(departureInput.value);
                            const returnDate = new Date(departureDate);
                            returnDate.setDate(departureDate.getDate() + 7);
                            returnInput.value = formatDate(returnDate);
                        }
                    }
                }
            }
        }
   // Auth Tabs
        document.querySelectorAll('.auth-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                switchAuthTab(this.dataset.auth);
            });
        });
        
        
   
// ============================================
// SEARCH FUNCTIONS
// ============================================
  // ============================================
        // SEARCH FUNCTIONS
        // ============================================

        // Handle flight search form submission
        async function handleFlightSearch(e) {
            e.preventDefault();
            
            const searchButton = document.querySelector('.btn-search');
            const originalText = searchButton.innerHTML;
            const originalState = searchButton.disabled;
            
            try {
                searchButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> SEARCHING...';
                searchButton.disabled = true;
                
                const passengersData = getPassengersData();
                
                const searchData = {
                    from: fromInput.value,
                    to: toInput.value,
                    departure: document.getElementById('departure').value,
                    returnDate: document.getElementById('return').value || null,
                    passengers: passengersData.total,
                    adults: passengersData.adults,
                    children: passengersData.children,
                    infants: passengersData.infants,
                    travelClass: document.getElementById('class').value || 'economy',
                    directOnly: document.getElementById('directOnly')?.checked || false,
                    currency: currentCurrency
                };
                
                console.log('ðŸ” Searching flights:', searchData);
                
                if (!searchData.from || !searchData.to || !searchData.departure) {
                    throw new Error('Please fill in all required fields');
                }
                
                saveSearchToHistory(searchData);
                // Save current search parameters for use when rendering flight cards (e.g., return date, passengers)
                try { localStorage.setItem('ethiofly_search_data', JSON.stringify(searchData)); } catch(e) { console.warn('Could not persist search data', e); }
                
                const response = await fetch(`${API_BASE_URL}/api/search-flights`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(searchData)
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Search failed');
                }
                
currentFlights = data.data;

// Save flights
localStorage.setItem("ethiofly_flights", JSON.stringify(currentFlights));
localStorage.setItem("ethiofly_search_data", JSON.stringify(searchData));

// âœ… NEW: Mark results page active only for this session
sessionStorage.setItem("onResultsPage", "yes");

// Optional: hash (if you want)
window.location.hash = "#results";

// âœ… Show results only (DON'T hide search bar)
document.getElementById("searchResults").classList.remove("hidden");

// Display flights
displayFlightResults(currentFlights, searchData);

                
            } catch (error) {
                console.error('âŒ Search error:', error);
                showNotification(error.message || 'Search failed. Please try again.', 'error');
                
                showSearchForm();
            } finally {
                searchButton.innerHTML = originalText;
                searchButton.disabled = originalState;
            }
        }
    
// ===== FUNCTION TO CREATE FLIGHT CARD =====
function createFlightCard(flight) {
    if (!flight) return null;
    // Ensure we always have an id so the UI can render a lightweight card
    if (!flight.id) {
        try {
            flight.id = 'tmp_' + (flight.flightNumber || Math.random().toString(36).slice(2,9));
        } catch (e) {
            flight.id = 'tmp_' + Math.random().toString(36).slice(2,9);
        }
    }

    // ================= SAFE EXTRACTION OF STOPS =================
    const outboundStops = flight.stops !== undefined 
        ? flight.stops 
        : (flight.outboundStops !== undefined 
            ? flight.outboundStops 
            : (flight.stopDetails?.stops?.length || 0));

    const inboundStops = flight.return 
        ? (flight.return.stops !== undefined 
            ? flight.return.stops 
            : (flight.inboundStops !== undefined 
                ? flight.inboundStops 
                : (flight.return?.stopDetails?.stops?.length || outboundStops))) 
        : 0;

    const stops = outboundStops; // legacy variable used elsewhere (outbound by default)

    // ================= CREATE CARD ELEMENT =================
    const card = document.createElement('div');
    card.className = 'flight-card';
    if (flight.featured) card.classList.add('featured');
    if (flight.isBestDeal) card.classList.add('best-deal');
    if (flight.return) card.classList.add('roundtrip');

    // ================= DATASET =================
    card.dataset.flightId = flight.id;
    card.dataset.outboundStops = outboundStops; // GO leg stops
    card.dataset.inboundStops = inboundStops;   // RETURN leg stops
    card.dataset.stops = stops;
    card.dataset.duration = parseDuration(flight.duration || '4h 00m');
    card.dataset.originalPrice = flight.price || 0;
    card.dataset.currency = flight.currency || 'USD';

    try {
        // Safely extract all flight properties with defaults
        const departureTime = flight.departure?.time || flight.departureTime || flight.departure_time || '00:00';
        const arrivalTime = flight.arrival?.time || flight.arrivalTime || flight.arrival_time || '00:00';
        const departureCode = flight.departure?.code || flight.origin || flight.from || 'ADD';
        const arrivalCode = flight.arrival?.code || flight.destination || flight.to || 'DXB';
        const departureCity = flight.departure?.city || flight.originCity || flight.fromCity || 'Addis Ababa';
        const arrivalCity = flight.arrival?.city || flight.destinationCity || flight.toCity || 'Dubai';
        const departureTerminal = flight.departure?.terminal || flight.departureTerminal || 'T1';
        const arrivalTerminal = flight.arrival?.terminal || flight.arrivalTerminal || 'T3';
        const departureGate = flight.departure?.gate || flight.departureGate || 'Gate A1';
        const arrivalGate = flight.arrival?.gate || flight.arrivalGate || 'Gate B1';
        const departureDate = flight.departure?.date || flight.date || 'Today';
        const arrivalDate = flight.arrival?.date || flight.date || 'Today';
        const airline = flight.airlineName || flight.airline || flight.operatingCarrier?.name || 'Unknown Airline';
        const airlineCode = (flight.airlineCode || flight.operatingCarrier?.iata_code || flight.carrierCode || '').toString().toUpperCase().trim();
        const airlineLogo = flight.airlineLogo || '';
        // Outbound stops (from flight data) and inbound stops (if return leg exists or provided)
        const outboundStops = flight.stops !== undefined ? flight.stops : (flight.outboundStops !== undefined ? flight.outboundStops : (flight.stopDetails?.stops?.length || 0));
        const inboundStops = flight.return ? (flight.return.stops !== undefined ? flight.return.stops : (flight.inboundStops !== undefined ? flight.inboundStops : (flight.return?.stopDetails?.stops?.length || outboundStops))) : 0;
        const stops = outboundStops; // legacy variable used elsewhere (outbound by default)
        const duration = flight.duration || '4h 00m';
        const price = flight.price || 150;
        const currency = flight.currency || 'USD';
        const fareType = flight.fareType || 'STANDARD';
        const aircraft = flight.aircraft || 'Boeing 737-800';
        const cabinClass = flight.cabinClass || '';
        const wifiAvailable = flight.wifiAvailable || false;
        const meals = flight.meals || '';
        const entertainment = flight.entertainment || 'Personal screen';
        const seatPitch = flight.seatPitch || '30 inches';
        const stopInfo = flight.stopInfo || (stops > 0 ? 'Stop en route' : 'Non-stop');
        const refundable = flight.refundable || false;
        const changePenalty = flight.changePenalty || 'Change fee applies';
        const operatedBy = flight.operatedBy || airline;
        const flightNumber = flight.flightNumber || `${airlineCode}${Math.floor(Math.random() * 900) + 100}`;
        const returnDuration = flight.return?.duration || '4h 00m';
        // Get stop details from server.js response
        const stopDetails = flight.stopDetails || {};
        const stopSegments = flight.segments || [];
        const routeSummary = flight.routeSummary || '';
        const stopoverAirports = flight.stopoverAirports || '';
       
        // Format price
        const searchData = JSON.parse(localStorage.getItem('ethiofly_search_data') || '{}');
        const passengers = parseInt(searchData.passengers) || 1;
        // Convert and display prices using the currently selected currency only
        const convertedPrice = convertCurrency(price, currency, currentCurrency);
        const convertedPerPerson = convertedPrice / Math.max(1, passengers);
        
        // Get symbol for currently selected currency
        const currencyInfo = SUPPORTED_CURRENCIES.find(c => c.code === currentCurrency) || { symbol: '' };
        const currencySymbol = currencyInfo.symbol || '';
        // Create stop info text (handle roundtrip summary)
                   
        // Generate stop details HTML from server.js data
        let stopDetailsHTML = '';
        let stopTimelineHTML = '';
        
        // Preferred: use server-provided stopDetails if available
        if (stops > 0 && stopDetails.stops && stopDetails.stops.length > 0) {
            // Create detailed stop information from server.js data
            stopDetailsHTML = `
                <div class="real-stop-details">
                    <div class="stop-details-header">
                        <i class="fas fa-map-marker-alt"></i>
                        <span class="stop-title">${stops} Stop${stops > 1 ? 's' : ''} Details</span>
                        <span class="total-layover">Total layover: ${stopDetails.totalLayoverFormatted || '0h 00m'}</span>
                    </div>
                    
                    <div class="stops-list">
                        ${stopDetails.stops.map((stop, index) => `
                            <div class="stop-item">
                                <div class="stop-number">${index + 1}</div>
                                <div class="stop-content">
                                    <div class="stop-location">
                                        <div class="stop-city-country">
                                            <strong class="stop-city">${stop.city || ''}</strong>
                                            <span class="stop-country">${stop.country || ''}</span>
                                        </div>
                                        <div class="stop-airport">
                                            <span class="stop-code">${stop.airportCode || ''}</span>
                                            <span class="stop-name">${stop.airportName || ''}</span>
                                        </div>
                                        <div class="stop-terminal">Terminal ${stop.terminal || 'T1'}</div>
                                    </div>
                                    <div class="stop-timing">
                                        <div class="stop-arrival">
                                            <span class="time-label">Arrives</span>
                                            <span class="time-value">${stop.arrivalTime || ''}</span>
                                            <span class="flight-number">${stop.arrivalFlight || ''}</span>
                                        </div>
                                        <div class="stop-layover">
                                            <i class="fas fa-clock"></i>
                                            <span class="layover-duration">${stop.layoverFormatted || ''} layover</span>
                                            <span class="layover-note">${stop.note || 'Standard connection'}</span>
                                        </div>
                                        <div class="stop-departure">
                                            <span class="time-label">Departs</span>
                                            <span class="time-value">${stop.departureTime || ''}</span>
                                            <span class="flight-number">${stop.departureFlight || ''}</span>
                                        </div>
                                    </div>
                                    ${stop.facilities && stop.facilities.length > 0 ? `
                                        <div class="stop-facilities">
                                            <div class="facilities-title">Facilities:</div>
                                            <div class="facilities-list">
                                                ${stop.facilities.slice(0, 3).map(facility => 
                                                    `<span class="facility-badge">${facility}</span>`
                                                ).join('')}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Create stop timeline for visual representation
            stopTimelineHTML = `
                <div class="stop-timeline">
                    <div class="timeline-start">
                        <div class="timeline-dot"></div>
                        <div class="timeline-time">${departureTime}</div>
                        <div class="timeline-location">${departureCity} (${departureCode})</div>
                    </div>
                    
                    ${stopDetails.stops.map((stop, index) => `
                        <div class="timeline-stop">
                            <div class="timeline-line"></div>
                            <div class="stop-dot-container">
                                <div class="stop-dot"></div>
                                <div class="stop-info">
                                    <div class="stop-city-timeline">${stop.city || ''}</div>
                                    <div class="stop-layover-timeline">${stop.layoverFormatted || ''}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                    
                    <div class="timeline-end">
                        <div class="timeline-dot"></div>
                        <div class="timeline-time">${arrivalTime}</div>
                        <div class="timeline-location">${arrivalCity} (${arrivalCode})</div>
                    </div>
                </div>
            `;
        }
        // Fallback: build a concise stop list from segments or stopoverAirports when stopDetails not present
        else if (stops > 0 && stopSegments && stopSegments.length > 1) {
            // collect intermediate stop codes/cities from segments between first and last
            const intermediates = stopSegments.slice(1, -1).map(s => s.departure?.city || s.departure?.airport || s.arrival?.city || s.arrival?.airport).filter(Boolean);
            const viaText = intermediates.length ? intermediates.join(', ') : (stopoverAirports || '');

            stopDetailsHTML = `
                <div class="real-stop-details simple">
                    <div class="stop-details-header">
                        <i class="fas fa-route"></i>
                        <span class="stop-title">${stops} Stop${stops > 1 ? 's' : ''}</span>
                        ${viaText ? `<span class="stop-via">Via: ${viaText}</span>` : ''}
                    </div>
                </div>
            `;

            // simple timeline: show departure - dot - arrival and list intermediates below
            stopTimelineHTML = `
                <div class="stop-timeline simple">
                    <div class="timeline-start">
                        <div class="timeline-dot"></div>
                        <div class="timeline-time">${departureTime}</div>
                        <div class="timeline-location">${departureCity} (${departureCode})</div>
                    </div>
                    <div class="timeline-middle">
                        <div class="timeline-line"></div>
                        ${intermediates.map(city => `
                            <div class="timeline-stop-item">${city}</div>
                        `).join('')}
                    </div>
                    <div class="timeline-end">
                        <div class="timeline-dot"></div>
                        <div class="timeline-time">${arrivalTime}</div>
                        <div class="timeline-location">${arrivalCity} (${arrivalCode})</div>
                    </div>
                </div>
            `;
        }
        
        // Generate segments information if available
        let segmentsHTML = '';
        if (stopSegments && stopSegments.length > 1) {
            segmentsHTML = `
                <div class="flight-segments">
                    <div class="segments-header">
                        <i class="fas fa-plane-departure"></i>
                        <span>Flight Segments</span>
                    </div>
                    <div class="segments-list">
                        ${stopSegments.map((segment, index) => `
                            <div class="segment-item">
                                <div class="segment-number">Segment ${index + 1}</div>
                                <div class="segment-details">
                                    <div class="segment-route">
                                        <span class="segment-from">
                                            <strong>${segment.departure?.code || ''}</strong>
                                            <span class="airport-name">${segment.departure?.airport || ''}</span>
                                        </span>
                                        <i class="fas fa-long-arrow-alt-right"></i>
                                        <span class="segment-to">
                                            <strong>${segment.arrival?.code || ''}</strong>
                                            <span class="airport-name">${segment.arrival?.airport || ''}</span>
                                        </span>
                                    </div>
                                    <div class="segment-info">
                                        <span class="segment-flight"><i class="fas fa-plane"></i> ${segment.airline || ''} ${segment.flightNumber || ''}</span>
                                        <span class="segment-duration"><i class="fas fa-clock"></i> ${segment.duration || ''}</span>
                                        <span class="segment-aircraft"><i class="fas fa-fighter-jet"></i> ${segment.aircraft || ''}</span>
                                    </div>
                                    <div class="segment-times">
                                        <div class="segment-time departure">
                                            <span class="time">${segment.departure?.time || ''}</span>
                                            <span class="terminal">${segment.departure?.terminal || 'T1'}</span>
                                        </div>
                                        <div class="segment-time arrival">
                                            <span class="time">${segment.arrival?.time || ''}</span>
                                            <span class="terminal">${segment.arrival?.terminal || 'T1'}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
    
 // ===== CLEAN STOP TEXT (TEXT ONLY â€“ FROM server.js) =====
const formatStopText = (stops, cities = []) => {
    if (!stops || stops === 0) {
        return 'Non-stop';
    }

    const stopLabel = stops === 1 ? '1 stop' : `${stops} stops`;

    if (cities && cities.length > 0) {
        return `${stopLabel} via ${cities.join(', ')}`;
    }

    return stopLabel;
};

// GO (Outbound)
const goStopText= formatStopText(
    outboundStops,
    stopDetails?.stops?.map(s => s.city).filter(Boolean)
);

// RETURN (Inbound)
const returnStopText = flight.return
    ? formatStopText(
        inboundStops,
        flight.return.stopDetails?.stops?.map(s => s.city).filter(Boolean)
      ): null
   
        
                // Create the flight card HTML with left details and right price box
                card.innerHTML = `
                        ${flight.isBestDeal ? '<div class="best-deal-banner"><i class="fas fa-crown"></i> BEST DEAL</div>' : ''}
                        <div class="card-body-grid">
                                <div class="card-left">
                                        <!-- ================= FLIGHT HEADER ================= -->
                                        <div class="flight-header">
                                                <div class="airline">
                                                        <div class="airline-logo-container">
                                                            <img data-airline-code="${airlineCode}" alt="${airline}" class="airline-logo-img" style="display:none;" onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                            <div class="airline-logo airline-${airlineCode}" style="display:flex;">${airlineCode}</div>
                                                        </div>
                                                        <div class="airline-info">
                                                                <div class="airline-name">${airline}</div>
                                                                <div class="airline-alliance">${operatedBy !== airline ? `Operated by ${operatedBy}` : `Flight ${flightNumber}`}</div>
                                                        </div>
                                                </div>

                                                <div class="flight-summary">
                                                        <div class="flight-duration-badge">${duration}</div>
                                                        ${routeSummary ? `<div class="route-summary">${routeSummary}</div>` : ''}
                                                </div>

                                                <div class="header-price">${flight.isBestDeal ? '<div class="header-badge">Best Value</div>' : ''}</div>
                                        </div>

                                        <!-- GO FLIGHT DETAILS -->
                                        <div class="flight-line go-flight clean compact-line">
                                                <div class="departure-block">
                                                        <div class="time-large">${departureTime}</div>
                                                        <div class="airport-info"><span class="airport-code">${departureCode}</span> â€¢ <span class="airport-name">${departureCity}</span></div>
                                                        <div class="terminal-gate small">${departureTerminal} â€¢ ${departureGate}</div>
                                                        <div class="flight-date small">${departureDate}</div>
                                                </div>

                                                <div class="flight-stop-center">
                                                        <div class="duration-text">Total Duration</div>
                                                        <div class="duration-value">${duration}</div>
                                                        <div class="stop-text small">${goStopText}</div>
                                                </div>

                                                <div class="arrival-block">
                                                        <div class="time-large">${arrivalTime}</div>
                                                        <div class="airport-info"><span class="airport-code">${arrivalCode}</span> â€¢ <span class="airport-name">${arrivalCity}</span></div>
                                                        <div class="terminal-gate small">${arrivalTerminal} â€¢ ${arrivalGate}</div>
                                                        <div class="flight-date small">${arrivalDate}</div>
                                                </div>
                                        </div>

                                        ${flight.return ? `
                                                <div class="flight-line return-flight clean compact-line">
                                                        <div class="departure-block">
                                                                <div class="time-large">${flight.return.departure?.time || ''}</div>
                                                                <div class="airport-info"><span class="airport-code">${flight.return.departure?.code || ''}</span> â€¢ <span class="airport-name">${flight.return.departure?.city || ''}</span></div>
                                                                <div class="flight-date small">${flight.return.departure?.date || ''}</div>
                                                        </div>
                                                        <div class="flight-stop-center">
                                                                <div class="duration-text">Return Duration</div>
                                                                <div class="duration-value">${returnDuration}</div>
                                                                <div class="stop-text small">${returnStopText}</div>
                                                        </div>
                                                        <div class="arrival-block">
                                                                <div class="time-large">${flight.return.arrival?.time || ''}</div>
                                                                <div class="airport-info"><span class="airport-code">${flight.return.arrival?.code || ''}</span> â€¢ <span class="airport-name">${flight.return.arrival?.city || ''}</span></div>
                                                                <div class="flight-date small">${flight.return.arrival?.date || ''}</div>
                                                        </div>
                                                </div>
                                        ` : ''}

                                        <div class="flight-meta"></div>

                                        <div class="action-buttons">
                                                <button class="btn btn-secondary btn-small" onclick="showPriceBreakdown(this, '${flight.id}')"><i class="fas fa-receipt"></i> </button>
                                                <button class="btn btn-primary btn-small" onclick="showComparisonModal('${flight.id}')"><i class="fas fa-balance-scale"></i> Compare</button>
                                                <button class="btn btn-small" onclick="saveFlight('${flight.id}')"><i class="far fa-bookmark"></i> Save</button>
                                        </div>
                                </div>

                                <aside class="card-right">
                                        <div class="price-box">
                                                <div class="price-with-currency" id="priceDisplay-${flight.id}">
                                                        <div class="currency-symbol-large">${currencySymbol}</div>
                                                        <div class="price-amount-large">${formatNumber(Math.round(convertedPrice))}</div>
                                                        ${passengers > 1 ? `<div class="per-person">${currencySymbol}${formatNumber(Math.round(convertedPerPerson))} per person</div>` : ''}
                                                </div>

                                                <div class="conversion-note" id="conversionNote-${flight.id}">Prices include all taxes</div>

                                                <button class="btn-select-flight" onclick="bookFlightNow('${flight.id}', '${airline}', ${price}, '${currency}')">Book now</button>
                                        </div>

                                       
                                </aside>
                        </div>

                        <div class="price-breakdown" id="breakdown-${flight.id}"></div>
                `;
           
        
        // Store flight data for booking
        if (!window.flightDataMap) window.flightDataMap = {};
        window.flightDataMap[flight.id] = {
            id: flight.id,
            airline: airline,
            departureCode: departureCode,
            arrivalCode: arrivalCode,
            departureCity: departureCity,
            arrivalCity: arrivalCity,
            departureTime: departureTime,
            arrivalTime: arrivalTime,
            departureDate: departureDate,
            arrivalDate: arrivalDate,
            duration: duration,
            price: price,
            currency: currency,
            stops: stops,
            flightNumber: flightNumber
        };
        
        // Kick off logo population and update price display with current currency
        try {
            populateAirlineLogo(card, airlineCode, airline).catch && populateAirlineLogo(card, airlineCode, airline);
        } catch (e) {
            // ignore
        }

        setTimeout(() => {
            updateFlightCardPrice(flight.id, price, currency);
            updatePriceBreakdown(flight.id, price, currency);
        }, 100);
        
        return card;
        
    } catch (error) {
        console.error('Error generating flight card:', error, flight);
        // Return a simple error card
        const errorCard = document.createElement('div');
        errorCard.className = 'flight-card';
        errorCard.innerHTML = `
            <div class="text-center p-3">
                <i class="fas fa-exclamation-triangle text-warning"></i>
                <p>Unable to display flight information</p>
            </div>
       `;
        return null;
    }
}

// ============================================
// HOTEL SEARCH FUNCTIONS
// ============================================

// Initialize hotel search system
function initializeHotelSearch() {
    const hotelSearchForm = document.getElementById('hotelSearchForm');
    const backToHotelSearchBtn = document.getElementById('backToHotelSearch');
    
    if (hotelSearchForm) {
        hotelSearchForm.addEventListener('submit', handleHotelSearch);
    }
    
    if (backToHotelSearchBtn) {
        backToHotelSearchBtn.addEventListener('click', function() {
            document.getElementById('hotelResults').classList.add('hidden');
            document.querySelector('.hotel-listings').innerHTML = '';
        });
    }
    
    // Initialize room selector
    initializeRoomSelector();
}

// Initialize room selector functionality
function initializeRoomSelector() {
    const roomTrigger = document.getElementById('roomTrigger');
    const roomsSelector = document.getElementById('roomsSelector');
    
    if (roomTrigger && roomsSelector) {
        roomTrigger.addEventListener('click', function(e) {
            e.stopPropagation();
            roomsSelector.classList.toggle('show');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!roomTrigger.contains(e.target) && !roomsSelector.contains(e.target)) {
                roomsSelector.classList.remove('show');
            }
        });
        
        // Initialize room controls
        initializeRoomControls();
        updateRoomDisplay();
    }
}

// Initialize room controls
function initializeRoomControls() {
    document.querySelectorAll('.passenger-controls button').forEach(button => {
        button.addEventListener('click', function(e) {
            e.stopPropagation();
            const type = this.dataset.type;
            const inputId = type === 'rooms' ? 'roomsCount' : 
                           type === 'adultsHotel' ? 'adultsHotel' : 
                           'childrenHotel';
            
            const input = document.getElementById(inputId);
            let value = parseInt(input.value) || 0;
            
            if (this.classList.contains('passenger-plus')) {
                const max = type === 'rooms' ? 5 : 10;
                value = Math.min(value + 1, max);
            } else {
                const min = type === 'rooms' ? 1 : 0;
                value = Math.max(min, value - 1);
            }
            
            input.value = value;
            updateRoomDisplay();
            updateRoomsSummary();
        });
    });
}

// Update room display
function updateRoomDisplay() {
    const roomCount = document.getElementById('roomCount');
    if (!roomCount) return;
    
    const rooms = parseInt(document.getElementById('roomsCount').value) || 1;
    const adults = parseInt(document.getElementById('adultsHotel').value) || 2;
    const children = parseInt(document.getElementById('childrenHotel').value) || 0;
    const totalGuests = adults + children;
    
    roomCount.textContent = `${rooms} Room${rooms > 1 ? 's' : ''}, ${totalGuests} Guest${totalGuests > 1 ? 's' : ''}`;
}

// Update rooms summary
function updateRoomsSummary() {
    const summary = document.getElementById('roomsSummary');
    if (!summary) return;
    
    const rooms = parseInt(document.getElementById('roomsCount').value) || 1;
    const adults = parseInt(document.getElementById('adultsHotel').value) || 2;
    const children = parseInt(document.getElementById('childrenHotel').value) || 0;
    const totalGuests = adults + children;
    
    summary.textContent = `Total: ${rooms} Room${rooms > 1 ? 's' : ''}, ${totalGuests} Guest${totalGuests > 1 ? 's' : ''}`;
}

// Handle hotel search
async function handleHotelSearch(e) {
    e.preventDefault();
    
    try {
        // Get search parameters
        const location = document.getElementById('hotelLocation').value;
        const checkIn = document.getElementById('checkIn').value;
        const checkOut = document.getElementById('checkOut').value;
        const rooms = parseInt(document.getElementById('roomsCount').value) || 1;
        const adults = parseInt(document.getElementById('adultsHotel').value) || 2;
        const children = parseInt(document.getElementById('childrenHotel').value) || 0;
        
        // Validate inputs
        if (!location || !checkIn || !checkOut) {
            showNotification('Please fill in all required fields', 'error');
            return;
        }
        
        if (new Date(checkIn) >= new Date(checkOut)) {
            showNotification('Check-out date must be after check-in date', 'error');
            return;
        }
        
        // Show loading
const searchButton = e.target.querySelector('.btn-search');
const originalText = searchButton.innerHTML;
searchButton.disabled = true;


        // Save search info
        document.getElementById('hotelSearchLocation').textContent = location + ' Hotels';
        document.getElementById('hotelSearchDates').textContent = 
            `Check-in: ${formatDateDisplay(checkIn)} â€¢ Check-out: ${formatDateDisplay(checkOut)} â€¢ ${rooms} Room${rooms > 1 ? 's' : ''}, ${adults + children} Guest${(adults + children) > 1 ? 's' : ''}`;
        
        // Simulate API call (replace with real API call)
        const hotels = await searchHotels({
            location,
            checkIn,
            checkOut,
            rooms,
            adults,
            children,
            currency: currentCurrency
        });
        
        // Display results
        displayHotelResults(hotels);
        
        // Show results section
        document.getElementById('hotelResults').classList.remove('hidden');
        
        // Scroll to results
        document.getElementById('hotelResults').scrollIntoView({ behavior: 'smooth' });
        
        showNotification(`Found ${hotels.length} hotels`, 'success');
        
    } catch (error) {
        console.error('Hotel search error:', error);
        showNotification('Hotel search failed. Please try again.', 'error');
    } finally {
        // Reset button
        const searchButton = e.target.querySelector('.btn-search');
        if (searchButton) {
            searchButton.innerHTML = originalText;
            searchButton.disabled = false;
        }
    }
}

// Search hotels (mock data - replace with real API)
async function searchHotels(params) {
    // Simulate API delay
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // Filter by location if specified
    const locationLower = params.location.toLowerCase();
    
    // Mock hotel data - replace with real API call
    let mockHotels = [
        {
            id: 'hotel-1',
            name: 'Sheraton Addis',
            location: 'Addis Ababa, Ethiopia',
            rating: 4.5,
            reviews: 1287,
            price: 50,
            currency: 'USD',
            image: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Luxury hotel with swimming pool, spa, and multiple restaurants.',
            amenities: ['Free WiFi', 'Swimming Pool', 'Spa', 'Fitness Center', 'Restaurant'],
            starRating: 5,
            isPremium: true,
            city: 'Addis Ababa',
            country: 'Ethiopia'
        },
        {
            id: 'hotel-2',
            name: 'Hilton Addis Ababa',
            location: 'Addis Ababa, Ethiopia',
            rating: 4.7,
            reviews: 2156,
            price: 100,
            currency: 'USD',
            image: 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Business hotel with conference facilities and city views.',
            amenities: ['Free WiFi', 'Business Center', 'Gym', 'Bar', 'Room Service'],
            starRating: 5,
            isPremium: true,
            city: 'Addis Ababa',
            country: 'Ethiopia'
        },
        {
            id: 'hotel-3',
            name: 'Radisson Blu Hotel',
            location: 'Addis Ababa, Ethiopia',
            rating: 4.3,
            reviews: 987,
            price: 60,
            currency: 'USD',
            image: 'https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Modern hotel with comfortable rooms and excellent service.',
            amenities: ['Free WiFi', 'Restaurant', 'Bar', 'Airport Shuttle', 'Fitness Center'],
            starRating: 4,
            isPremium: false,
            city: 'Addis Ababa',
            country: 'Ethiopia'
        },
        {
            id: 'hotel-5',
            name: 'Fairmont The Norfolk',
            location: 'Nairobi, Kenya',
            rating: 4.8,
            reviews: 2345,
            price: 18500,
            currency: 'KES',
            image: 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Historic luxury hotel in the heart of Nairobi with lush gardens.',
            amenities: ['Historic Property', 'Garden', 'Pool', 'Spa', 'Fine Dining'],
            starRating: 5,
            isPremium: true,
            city: 'Nairobi',
            country: 'Kenya'
        },
        {
            id: 'hotel-6',
            name: 'Sarova Stanley',
            location: 'Nairobi, Kenya',
            rating: 4.4,
            reviews: 1678,
            price: 12500,
            currency: 'KES',
            image: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Iconic hotel with rich history and colonial architecture.',
            amenities: ['Historic', 'Central Location', 'Business Center', 'Bar', 'Restaurant'],
            starRating: 5,
            isPremium: true,
            city: 'Nairobi',
            country: 'Kenya'
        },
        {
            id: 'hotel-7',
            name: 'The Table Bay Hotel',
            location: 'Cape Town, South Africa',
            rating: 4.9,
            reviews: 3123,
            price: 32500,
            currency: 'ZAR',
            image: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Luxury waterfront hotel at the V&A Waterfront with Table Mountain views.',
            amenities: ['Waterfront', 'Luxury Spa', 'Pool', 'Fine Dining', 'Ocean Views'],
            starRating: 5,
            isPremium: true,
            city: 'Cape Town',
            country: 'South Africa'
        },
        {
            id: 'hotel-8',
            name: 'Saxon Hotel, Villas & Spa',
            location: 'Johannesburg, South Africa',
            rating: 4.9,
            reviews: 2789,
            price: 45000,
            currency: 'ZAR',
            image: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Ultra-luxury hotel with presidential history and world-class spa.',
            amenities: ['Ultra Luxury', 'Spa', 'Private Villas', 'Gourmet Dining', 'Wine Cellar'],
            starRating: 5,
            isPremium: true,
            city: 'Johannesburg',
            country: 'South Africa'
        },
        {
            id: 'hotel-9',
            name: 'Four Seasons Hotel Cairo at Nile Plaza',
            location: 'Cairo, Egypt',
            rating: 4.8,
            reviews: 2890,
            price: 28500,
            currency: 'EGP',
            image: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Luxury hotel overlooking the Nile River with panoramic city views.',
            amenities: ['Nile Views', 'Multiple Pools', 'Spa', 'Fine Dining', 'Business Center'],
            starRating: 5,
            isPremium: true,
            city: 'Cairo',
            country: 'Egypt'
        },
        {
            id: 'hotel-10',
            name: 'Mena House Hotel',
            location: 'Giza, Egypt',
            rating: 4.7,
            reviews: 2456,
            price: 22000,
            currency: 'EGP',
            image: 'https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Historic palace hotel with views of the Great Pyramids of Giza.',
            amenities: ['Pyramid Views', 'Historic Palace', 'Golf Course', 'Pool', 'Spa'],
            starRating: 5,
            isPremium: true,
            city: 'Giza',
            country: 'Egypt'
        },
        {
            id: 'hotel-11',
            name: 'La Mamounia',
            location: 'Marrakech, Morocco',
            rating: 4.9,
            reviews: 3456,
            price: 45000,
            currency: 'MAD',
            image: 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Legendary palace hotel with stunning gardens and Moroccan architecture.',
            amenities: ['Historic Palace', 'Gardens', 'Multiple Pools', 'Spa', 'Fine Dining'],
            starRating: 5,
            isPremium: true,
            city: 'Marrakech',
            country: 'Morocco'
        },
        {
            id: 'hotel-12',
            name: 'Royal Mansour Marrakech',
            location: 'Marrakech, Morocco',
            rating: 5.0,
            reviews: 1987,
            price: 85000,
            currency: 'MAD',
            image: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Ultra-luxury hotel with private riads and royal treatment.',
            amenities: ['Private Riads', 'Butler Service', 'Spa', 'Fine Dining', 'Gardens'],
            starRating: 5,
            isPremium: true,
            city: 'Marrakech',
            country: 'Morocco'
        },
        {
            id: 'hotel-13',
            name: 'Burj Al Arab Jumeirah',
            location: 'Dubai, UAE',
            rating: 4.9,
            reviews: 7890,
            price: 5500,
            currency: 'AED',
            image: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Iconic sail-shaped hotel, often described as the world\'s only 7-star hotel.',
            amenities: ['Private Beach', 'Helipad', 'Luxury Suites', 'Multiple Pools', 'Fine Dining'],
            starRating: 7,
            isPremium: true,
            city: 'Dubai',
            country: 'UAE'
        },
        {
            id: 'hotel-14',
            name: 'Atlantis The Palm',
            location: 'Dubai, UAE',
            rating: 4.8,
            reviews: 12345,
            price: 2200,
            currency: 'AED',
            image: 'https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Aquatic-themed resort with water park and marine habitat.',
            amenities: ['Water Park', 'Aquarium', 'Private Beach', 'Multiple Pools', 'Kids Club'],
            starRating: 5,
            isPremium: true,
            city: 'Dubai',
            country: 'UAE'
        },
        {
            id: 'hotel-15',
            name: 'Burj Qatar',
            location: 'Doha, Qatar',
            rating: 4.8,
            reviews: 4567,
            price: 1800,
            currency: 'QAR',
            image: 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Iconic hotel known for its unique cylindrical design and luxury amenities.',
            amenities: ['Architectural Icon', 'Spa', 'Pool', 'Business Center', 'Fine Dining'],
            starRating: 5,
            isPremium: true,
            city: 'Doha',
            country: 'Qatar'
        },
        {
            id: 'hotel-16',
            name: 'The Savoy',
            location: 'London, UK',
            rating: 4.9,
            reviews: 5678,
            price: 650,
            currency: 'GBP',
            image: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Iconic luxury hotel on the Strand with Art Deco interiors.',
            amenities: ['Historic', 'River Views', 'Afternoon Tea', 'Spa', 'Fine Dining'],
            starRating: 5,
            isPremium: true,
            city: 'London',
            country: 'UK'
        },
        {
            id: 'hotel-17',
            name: 'Claridge\'s',
            location: 'London, UK',
            rating: 4.9,
            reviews: 4321,
            price: 750,
            currency: 'GBP',
            image: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Art Deco masterpiece and favorite of royalty and celebrities.',
            amenities: ['Art Deco', 'Michelin Restaurant', 'Spa', 'Afternoon Tea', 'Central Location'],
            starRating: 5,
            isPremium: true,
            city: 'London',
            country: 'UK'
        },
        {
            id: 'hotel-18',
            name: 'HÃ´tel Ritz Paris',
            location: 'Paris, France',
            rating: 4.9,
            reviews: 6789,
            price: 1200,
            currency: 'EUR',
            image: 'https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Legendary palace hotel in Place VendÃ´me, a symbol of Parisian luxury.',
            amenities: ['Historic Palace', 'Chanel Spa', 'Fine Dining', 'Bar', 'Central Location'],
            starRating: 5,
            isPremium: true,
            city: 'Paris',
            country: 'France'
        },
        {
            id: 'hotel-19',
            name: 'Four Seasons Hotel George V',
            location: 'Paris, France',
            rating: 4.9,
            reviews: 7654,
            price: 1100,
            currency: 'EUR',
            image: 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Art Deco palace hotel with three Michelin-starred restaurants.',
            amenities: ['Michelin Dining', 'Spa', 'Indoor Pool', 'Floral Displays', 'Luxury Suites'],
            starRating: 5,
            isPremium: true,
            city: 'Paris',
            country: 'France'
        },
        {
            id: 'hotel-20',
            name: 'Hotel Hassler Roma',
            location: 'Rome, Italy',
            rating: 4.9,
            reviews: 5432,
            price: 850,
            currency: 'EUR',
            image: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Luxury hotel at the top of the Spanish Steps with panoramic views.',
            amenities: ['Panoramic Views', 'Roof Terrace', 'Spa', 'Fine Dining', 'Central Location'],
            starRating: 5,
            isPremium: true,
            city: 'Rome',
            country: 'Italy'
        },
        {
            id: 'hotel-21',
            name: 'The Peninsula Bangkok',
            location: 'Bangkok, Thailand',
            rating: 4.9,
            reviews: 6543,
            price: 32000,
            currency: 'THB',
            image: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Riverside luxury hotel with iconic architecture and Chao Phraya River views.',
            amenities: ['River Views', 'Pool', 'Spa', 'Helicopter Pad', 'Fine Dining'],
            starRating: 5,
            isPremium: true,
            city: 'Bangkok',
            country: 'Thailand'
        },
        {
            id: 'hotel-22',
            name: 'Marina Bay Sands',
            location: 'Singapore',
            rating: 4.8,
            reviews: 23456,
            price: 550,
            currency: 'SGD',
            image: 'https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Iconic integrated resort with the world\'s largest rooftop infinity pool.',
            amenities: ['Infinity Pool', 'Casino', 'Shopping Mall', 'Museum', 'Multiple Restaurants'],
            starRating: 5,
            isPremium: true,
            city: 'Singapore',
            country: 'Singapore'
        },
        {
            id: 'hotel-23',
            name: 'The Plaza Hotel',
            location: 'New York, USA',
            rating: 4.8,
            reviews: 8765,
            price: 950,
            currency: 'USD',
            image: 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Historic luxury hotel facing Central Park, a New York City landmark.',
            amenities: ['Central Park Views', 'Historic', 'Afternoon Tea', 'Spa', 'Fine Dining'],
            starRating: 5,
            isPremium: true,
            city: 'New York',
            country: 'USA'
        },
        {
            id: 'hotel-24',
            name: 'The Beverly Hills Hotel',
            location: 'Los Angeles, USA',
            rating: 4.8,
            reviews: 7654,
            price: 850,
            currency: 'USD',
            image: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Iconic "Pink Palace" favored by Hollywood celebrities since 1912.',
            amenities: ['Historic', 'Pool Cabana', 'Spa', 'Fine Dining', 'Celebrity Favorite'],
            starRating: 5,
            isPremium: true,
            city: 'Los Angeles',
            country: 'USA'
        },
        {
            id: 'hotel-25',
            name: 'Best Western Plus',
            location: 'Addis Ababa, Ethiopia',
            rating: 4.0,
            reviews: 654,
            price: 30,
            currency: 'USD',
            image: 'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Comfortable stay with great value for money.',
            amenities: ['Free WiFi', 'Breakfast Included', 'Parking', '24-hour Front Desk'],
            starRating: 3,
            isPremium: false,
            city: 'Addis Ababa',
            country: 'Ethiopia'
        },
        {
            id: 'hotel-26',
            name: 'Holiday Inn Express',
            location: 'Dubai, UAE',
            rating: 4.2,
            reviews: 2345,
            price: 450,
            currency: 'AED',
            image: 'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
            description: 'Comfortable and convenient hotel with complimentary breakfast.',
            amenities: ['Free Breakfast', 'Pool', 'Fitness Center', 'Business Center', 'Free WiFi'],
            starRating: 3,
            isPremium: false,
            city: 'Dubai',
            country: 'UAE'
        }
    ];
    
    // Filter hotels by location if search term provided
    if (params.location && params.location.trim() !== '') {
        mockHotels = mockHotels.filter(hotel => 
            (hotel.city && hotel.city.toLowerCase().includes(locationLower)) ||
            (hotel.country && hotel.country.toLowerCase().includes(locationLower)) ||
            (hotel.name && hotel.name.toLowerCase().includes(locationLower)) ||
            (hotel.location && hotel.location.toLowerCase().includes(locationLower))
        );
        
        // If no matches, show some popular hotels
        if (mockHotels.length === 0) {
            mockHotels = [
                {
                    id: 'hotel-popular-1',
                    name: 'Sheraton Addis',
                    location: 'Addis Ababa, Ethiopia',
                    rating: 4.5,
                    reviews: 1287,
                    price: 40,
                    currency: 'USD',
                    image: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                    description: 'Luxury hotel with swimming pool, spa, and multiple restaurants.',
                    amenities: ['Free WiFi', 'Swimming Pool', 'Spa', 'Fitness Center', 'Restaurant'],
                    starRating: 5,
                    isPremium: true,
                    city: 'Addis Ababa',
                    country: 'Ethiopia'
                },
                {
                    id: 'hotel-popular-2',
                    name: 'Burj Al Arab Jumeirah',
                    location: 'Dubai, UAE',
                    rating: 4.9,
                    reviews: 7890,
                    price: 5500,
                    currency: 'AED',
                    image: 'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                    description: 'Iconic sail-shaped hotel, often described as the world\'s only 7-star hotel.',
                    amenities: ['Private Beach', 'Helipad', 'Luxury Suites', 'Multiple Pools', 'Fine Dining'],
                    starRating: 7,
                    isPremium: true,
                    city: 'Dubai',
                    country: 'UAE'
                },
                {
                    id: 'hotel-popular-3',
                    name: 'The Savoy',
                    location: 'London, UK',
                    rating: 4.9,
                    reviews: 5678,
                    price: 650,
                    currency: 'GBP',
                    image: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                    description: 'Iconic luxury hotel on the Strand with Art Deco interiors.',
                    amenities: ['Historic', 'River Views', 'Afternoon Tea', 'Spa', 'Fine Dining'],
                    starRating: 5,
                    isPremium: true,
                    city: 'London',
                    country: 'UK'
                }
            ];
        }
    }
    
    // Limit results to 12 hotels for better performance
    mockHotels = mockHotels.slice(0, 12);
    
    // Convert prices based on currency
    return mockHotels.map(hotel => ({
        ...hotel,
        displayPrice: convertCurrency(hotel.price, hotel.currency, currentCurrency)
    }));
}
// Display hotel results
function displayHotelResults(hotels) {
    const listingsContainer = document.querySelector('.hotel-listings');
    if (!listingsContainer) return;
    
    if (!hotels || hotels.length === 0) {
        listingsContainer.innerHTML = `
            <div class="no-flights">
                <i class="fas fa-building"></i>
                <h3>No hotels found</h3>
                <p>Try adjusting your search criteria</p>
            </div>
        `;
        return;
    }
    
    listingsContainer.innerHTML = '';
    
    hotels.forEach(hotel => {
        const hotelCard = createHotelCard(hotel);
        listingsContainer.appendChild(hotelCard);
    });
}

// Create hotel card
function createHotelCard(hotel) {
    const card = document.createElement('div');
    card.className = 'hotel-card';
    if (hotel.isPremium) card.classList.add('premium');
    
    const currencyInfo = SUPPORTED_CURRENCIES.find(c => c.code === currentCurrency);
    const price = hotel.displayPrice || hotel.price;
    
    card.innerHTML = `
        ${hotel.isPremium ? '<div class="premium-badge"><i class="fas fa-crown"></i> PREMIUM</div>' : ''}
        
        <img src="${hotel.image}" alt="${hotel.name}" onerror="this.src='https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'">
        
        <div class="hotel-info">
            <h3>${hotel.name}</h3>
            
            <div class="hotel-location">
                <i class="fas fa-map-marker-alt"></i> ${hotel.location}
            </div>
            
            <div class="hotel-rating">
                <span class="stars">${'â˜…'.repeat(Math.floor(hotel.starRating))}${'â˜†'.repeat(5 - Math.floor(hotel.starRating))}</span>
                <span class="rating">${hotel.rating}</span>
                <span class="reviews">(${hotel.reviews} reviews)</span>
            </div>
            
            <p class="hotel-description">${hotel.description}</p>
            
            <div class="hotel-amenities">
                ${hotel.amenities.slice(0, 3).map(amenity => 
                    `<span class="amenity-badge">${amenity}</span>`
                ).join('')}
                ${hotel.amenities.length > 3 ? 
                    `<span class="amenity-more">+${hotel.amenities.length - 3} more</span>` : 
                    ''
                }
            </div>
            
            <div class="hotel-price">
                <div class="price-main">
                    <span class="price-currency">${currencyInfo?.symbol || currentCurrency}</span>
                    <span class="price-amount">${formatNumber(Math.round(price))}</span>
                    <span class="price-period">/night</span>
                </div>
                <div class="price-taxes">Includes taxes & fees</div>
                
                <button class="btn-book" onclick="bookHotel('${hotel.id}')">
                    <i class="fas fa-calendar-check"></i> Book Now
                </button>
            </div>
        </div>
    `;
    
    return card;
}

// Book hotel function
function bookHotel(hotelId) {
    showNotification('Booking feature coming soon!', 'info');
    // Implement booking logic here
}

// Format date for display
function formatDateDisplay(dateString) {
    const date = new Date(dateString);
    const options = { weekday: 'short', month: 'short', day: 'numeric' };
    return date.toLocaleDateString('en-US', options);
}

// Initialize hotel search on DOM ready
document.addEventListener('DOMContentLoaded', function() {
    // Add this to your initialization section
    initializeHotelSearch();
    
    // Set default dates for hotel search
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate() + 1);
    const nextWeek = new Date(today);
    nextWeek.setDate(today.getDate() + 7);
    
    const checkInInput = document.getElementById('checkIn');
    const checkOutInput = document.getElementById('checkOut');
    
    if (checkInInput) {
        checkInInput.min = formatDate(today);
        checkInInput.value = formatDate(tomorrow);
    }
    
    if (checkOutInput) {
        checkOutInput.min = formatDate(tomorrow);
        checkOutInput.value = formatDate(nextWeek);
    }
});


// ============================================
// BOOKING FUNCTIONS
// ============================================

// Direct booking function
function bookFlightNow(flightId, providerName, price, currency) {
    console.log('Direct booking called:', { flightId, providerName, price, currency });
    
    try {
        // Get flight data
        const flight = window.flightDataMap?.[flightId] || currentFlights?.find(f => f.id === flightId);
        
        // Get passenger data safely
        const passengersData = getPassengersDataSafe();
        const totalPassengers = passengersData.total || 1;
        const adults = passengersData.adults || 1;
        const children = passengersData.children || 0;
        const infants = passengersData.infants || 0;
        
        // Get travel class
        const travelClass = document.getElementById('class')?.value || 'economy';
        
        // Calculate total price based on passengers
        const basePrice = parseFloat(price) || 100;
        const totalPrice = (basePrice * adults + (basePrice * 0.75 * children) + (basePrice * 0.1 * infants)).toFixed(2);
        
        // Prepare comprehensive booking data
        const bookingData = {
            flight: {
                id: flightId,
                offerId: `off_${Date.now()}_${flightId}`, // Generate unique offer ID for Duffel
                origin: flight?.departureCode || 'ADD',
                destination: flight?.arrivalCode || 'DXB',
                originCity: flight?.departureCity || 'Addis Ababa',
                destinationCity: flight?.arrivalCity || 'Dubai',
                departureDate: flight?.departureDate || new Date().toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                }),
                arrivalDate: flight?.arrivalDate || new Date().toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                }),
                departureTime: flight?.departureTime || '08:00',
                arrivalTime: flight?.arrivalTime || '22:30',
                duration: flight?.duration || '14h 30m',
                airline: providerName || 'Ethiopian Airlines',
                airlineCode: flight?.airlineCode || 'ET',
                flightNumber: flight?.flightNumber || 'ET701',
                class: travelClass.charAt(0).toUpperCase() + travelClass.slice(1),
                price: totalPrice, // Use calculated total price
                basePrice: basePrice, // Store base price per adult
                currency: currency || 'USD',
                stops: flight?.stops || 0,
                baggage: flight?.baggage || '1 Ã— 23kg',
                meals: flight?.meals || 'Meal included',
                aircraft: flight?.aircraft || 'Boeing 777',
                emissions: flight?.emissions || '450kg COâ‚‚',
                // Include all flight data for reference
                ...flight
            },
            passengers: {
                total: totalPassengers,
                adults: adults,
                children: children,
                infants: infants,
                breakdown: passengersData
            },
            search: {
                from: document.getElementById('from')?.value || 'Addis Ababa (ADD)',
                to: document.getElementById('to')?.value || 'Dubai (DXB)',
                departure: document.getElementById('departure')?.value,
                returnDate: document.getElementById('return')?.value,
                class: travelClass
            },
            price: totalPrice,
            currency: currency || 'USD',
            provider: 'EthioFly',
            travelClass: travelClass,
            timestamp: Date.now(),
            bookingReference: `ETH-${Date.now().toString().slice(-6)}`
        };
        
        // Store booking data in localStorage for the booking page
        localStorage.setItem('ethiofly_booking', JSON.stringify(bookingData));
        localStorage.setItem('ethiofly_passengers', JSON.stringify(passengersData));
        
        // Store flight data if available
        if (currentFlights && currentFlights.length > 0) {
            localStorage.setItem('ethiofly_flights', JSON.stringify(currentFlights));
        }
        
        // Store search data for reference
        localStorage.setItem('ethiofly_search_data', JSON.stringify({
            from: document.getElementById('from')?.value || 'Addis Ababa (ADD)',
            to: document.getElementById('to')?.value || 'Dubai (DXB)',
            departure: document.getElementById('departure')?.value,
            returnDate: document.getElementById('return')?.value,
            passengers: passengersData,
            class: travelClass
        }));
        
        // Show loading on button
        const bookButton = event?.target || document.querySelector(`[data-flight-id="${flightId}"] .btn-select-flight`);
        if (bookButton) {
            const originalText = bookButton.innerHTML;
            bookButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            bookButton.disabled = true;
            
            // Reset button after 2 seconds
            setTimeout(() => {
                bookButton.innerHTML = originalText;
                bookButton.disabled = false;
            }, 2000);
        }
        
        // Add flight parameters to URL for direct access
        const urlParams = new URLSearchParams({
            flight: 'true',
            flightId: flightId,
            provider: encodeURIComponent(providerName || 'Ethiopian Airlines'),
            price: totalPrice,
            basePrice: basePrice,
            currency: currency || 'USD',
            passengers: totalPassengers,
            adults: adults,
            children: children,
            infants: infants,
            origin: flight?.departureCode || 'ADD',
            destination: flight?.arrivalCode || 'DXB',
            airline: encodeURIComponent(providerName || 'Ethiopian Airlines'),
            flightNumber: flight?.flightNumber || 'ET701',
            departureDate: flight?.departureDate || new Date().toISOString().split('T')[0],
            departureTime: flight?.departureTime || '08:00',
            arrivalDate: flight?.arrivalDate || new Date().toISOString().split('T')[0],
            arrivalTime: flight?.arrivalTime || '22:30',
            duration: flight?.duration || '14h 30m',
            class: travelClass,
            baggage: flight?.baggage || '1 Ã— 23kg'
        });
        
        const bookingPageUrl = 'booking.html';
        const fullUrl = `${bookingPageUrl}?${urlParams.toString()}`;
        
        console.log('Opening booking page with data:', {
            totalPassengers,
            adults,
            children,
            infants,
            totalPrice,
            basePrice
        });
        
        // Open booking page in a new tab
        const newWindow = window.open(fullUrl, '_blank', 'noopener,noreferrer,width=1200,height=800');
        
        if (newWindow) {
            // Send booking data to new window
            setTimeout(() => {
                newWindow.postMessage({
                    type: 'ETHIOFLY_BOOKING_DATA',
                    data: bookingData
                }, '*');
            }, 500);
        }
        
        console.log('Opened booking page:', fullUrl);
        
        // Track booking click
        trackBookingClick(flightId, providerName, price, 'direct');
        
    } catch (error) {
        console.log('Booking error:', error.message);
        
        // Fallback: show error and offer alternative
        showNotification('Failed to open booking page. Please try again.', 'error');
        
        // Alternative: open in same window
        setTimeout(() => {
            const fallbackUrl = 'booking.html?flightId=' + encodeURIComponent(flightId);
            window.open(fallbackUrl, '_blank');
        }, 1000);
    }
}

// Helper function to get passengers data
function getPassengersDataSafe() {
    try {
        const passengerSelect = document.getElementById('passengers');
        if (passengerSelect) {
            const value = passengerSelect.value;
            const [adults, children, infants] = value.split('-').map(Number);
            return {
                total: adults + children + infants,
                adults: adults || 1,
                children: children || 0,
                infants: infants || 0,
                display: `${adults} Adult${adults > 1 ? 's' : ''}${children > 0 ? `, ${children} Child${children > 1 ? 'ren' : ''}` : ''}${infants > 0 ? `, ${infants} Infant${infants > 1 ? 's' : ''}` : ''}`
            };
        }
    } catch (e) {
        console.log('Error getting passengers data:', e);
    }
    
    // Default fallback
    return {
        total: 1,
        adults: 1,
        children: 0,
        infants: 0,
        display: '1 Adult'
    };
}
// Handle provider booking (for comparison modal)
async function handleProviderBooking(flightId, providerName, price, linkType, linkUrl) {
    console.log('handleProviderBooking called:', { flightId, providerName, price, linkType, linkUrl });
    
    try {
        // Find the flight
        const flight = currentFlights.find(f => f.id === flightId);
        
        // Get passenger data safely
        const passengersData = getPassengersDataSafe();
        
        // Prepare booking data
        const bookingData = {
            flight: flight || {
                id: flightId,
                origin: flightId.includes('ADD') ? 'ADD' : 'Origin',
                destination: flightId.includes('DXB') ? 'DXB' : 'Destination',
                originCity: flightId.includes('ADD') ? 'Addis Ababa' : 'Origin City',
                destinationCity: flightId.includes('DXB') ? 'Dubai' : 'Destination City',
                date: new Date().toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                }),
                duration: '14h 30m',
                airline: providerName,
                class: 'Economy',
                price: price || 10000
            },
            passengers: passengersData,
            price: price || 10000,
            provider: providerName,
            timestamp: Date.now()
        };
        
        // Store booking data in localStorage for the booking page
        localStorage.setItem('ethiofly_booking', JSON.stringify(bookingData));
        localStorage.setItem('ethiofly_passengers', JSON.stringify(passengersData));
        
        // If there are flights in memory, store them too
        if (currentFlights && currentFlights.length > 0) {
            localStorage.setItem('ethiofly_flights', JSON.stringify(currentFlights));
        }
        
        // Show loading on button
        const bookButton = event?.target;
        if (bookButton) {
            const originalText = bookButton.innerHTML;
            bookButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            bookButton.disabled = true;
            
            // Reset button after 2 seconds
            setTimeout(() => {
                bookButton.innerHTML = originalText;
                bookButton.disabled = false;
            }, 2000);
        }
        
        // If it's EthioFly (internal) or external with no link, use our booking page
        if (linkType === 'internal' || providerName === 'EthioFly' || !linkUrl || linkUrl === '#') {
            // Use EthioFly booking page
            const urlParams = new URLSearchParams({
                flightId: flightId,
                provider: providerName,
                price: price || 10000,
                booking: encodeURIComponent(JSON.stringify(bookingData))
            });
            
            const bookingPageUrl = 'booking.html';
            const fullUrl = `${bookingPageUrl}?${urlParams.toString()}`;
            
            // Open booking page in a new tab
            window.open(fullUrl, '_blank', 'noopener,noreferrer,width=1200,height=800');
            console.log('Opened EthioFly booking page:', fullUrl);
        } 
        // If it's an external provider with a valid link
        else if (linkUrl && linkUrl !== '#' && linkUrl !== '') {
            // Open external provider link
            const decodedUrl = decodeURIComponent(linkUrl);
            window.open(decodedUrl, '_blank', 'noopener,noreferrer');
            
            // Track the external booking click
            trackExternalBooking(flightId, providerName, price, decodedUrl);
            
            // Show confirmation message
            setTimeout(() => {
                showExternalRedirectConfirmation(flight, providerName, price);
            }, 500);
        }
        
    } catch (error) {
        console.log('handleProviderBooking error:', error.message);
        
        // Fallback: open booking page without data
        const fallbackUrl = 'booking.html?flightId=' + encodeURIComponent(flightId);
        window.open(fallbackUrl, '_blank', 'noopener,noreferrer');
    }
}

// ============================================
// COMPARISON MODAL
// ============================================

const PROVIDER_CONFIGS = {
    'EthioFly': {
        logo: 'https://i.postimg.cc/L6sR9Bvr/20260110-010256.png',
        badge: 'BEST PRICE',
        badgeColor: '#10b981',
        features: ['Direct booking', '24/7 Support', 'No hidden fees'],
        rating: 4.8,
        reviews: '1,240+ reviews',
        getDeepLink: (flight, passengers, travelClass) => ({
            type: 'internal',
            url: '#',
            action: 'bookDirect'
        })
    },
    'Expedia': {
        logo: 'https://i.postimg.cc/HL0F5fBf/20260129-004105.png',
        badge: 'INSTANT CONFIRMATION',
        badgeColor: '#ef4444',
        features: ['Bundle deals', 'Member discounts', 'Price guarantee', '24/7 customer service'],
        rating: 4.7,
        reviews: '5,800+ reviews',
        getDeepLink: (flight, passengers, travelClass) => ({
            type: 'external',
            url: generateExpediaDeepLinkNew(
                flight.departure?.code || flight.departureCode || flight.origin || 'ADD',
                flight.arrival?.code || flight.arrivalCode || flight.destination || 'DXB',
                formatDateForURL(flight.departure?.date || flight.departureDate),
                flight.returnDate ? formatDateForURL(flight.returnDate) : null,
                passengers,
                travelClass
            )
        })
    },
    'Aviasales': {
        logo: 'https://i.postimg.cc/3NNqsWY0/20260129-004007.png',
        badge: 'LOWEST PRICE',
        badgeColor: '#3b82f6',
        features: ['Price alerts', 'Search history', 'Mobile friendly', 'Best deals'],
        rating: 4.5,
        reviews: '890+ reviews',
        getDeepLink: (flight, passengers, travelClass) => ({
            type: 'external',
            url: generateAviasalesDeepLinkNew(
                flight.departure?.code || flight.departureCode || flight.origin || 'ADD',
                flight.arrival?.code || flight.arrivalCode || flight.destination || 'DXB',
                formatDateForURL(flight.departure?.date || flight.departureDate),
                flight.returnDate ? formatDateForURL(flight.returnDate) : null,
                passengers,
                travelClass
            )
        })
    }
};

// Show comparison modal
function showComparisonModal(flightId) {
    const flight = currentFlights.find(f => f.id === flightId) || window.flightDataMap?.[flightId];
    if (!flight) {
        showNotification('Flight not found', 'error');
        return;
    }
    
    // Get passenger data
    const passengersData = getPassengersDataSafe();
    const totalPassengers = passengersData.total || 1;
    const travelClass = document.getElementById('class')?.value || 'economy';
    
    // Get price in current currency
    const originalPrice = flight.price || 0;
    const originalCurrency = flight.currency || 'USD';
    const basePrice = convertCurrency(originalPrice, originalCurrency, currentCurrency);
    
    // Generate providers
    const providers = Object.keys(PROVIDER_CONFIGS).map(providerName => {
        const config = PROVIDER_CONFIGS[providerName];
        const deepLink = config.getDeepLink(flight, totalPassengers, travelClass);
        const priceMultiplier = getPriceMultiplier(providerName);
        const providerPrice = Math.round(basePrice * priceMultiplier);
        
        return {
            name: providerName,
            logo: config.logo,
            priceMultiplier: priceMultiplier,
            badge: config.badge,
            badgeColor: config.badgeColor,
            features: config.features,
            rating: config.rating,
            reviews: config.reviews,
            deepLink: deepLink,
            price: providerPrice
        };
    });
    
    // Sort by price
    providers.sort((a, b) => a.price - b.price);
    
    // Generate modal HTML
    const modalHTML = createComparisonModalHTML(flight, providers, totalPassengers, travelClass);
    
    // Create and show modal
    const modalContainer = document.createElement('div');
    modalContainer.id = 'comparison-modal-container';
    modalContainer.innerHTML = modalHTML;
    document.body.appendChild(modalContainer);
    
    // Add styles if needed
    addComparisonModalStyles();
    
    // Setup event listeners
    setupComparisonModalEvents(modalContainer);
    
    // Prevent body scroll
    document.body.style.overflow = 'hidden';
}

// Close comparison modal
function closeComparisonModal() {
    const modalContainer = document.getElementById('comparison-modal-container');
    if (modalContainer) {
        // Remove escape handler
        if (modalContainer._escapeHandler) {
            document.removeEventListener('keydown', modalContainer._escapeHandler);
        }
        
        // Remove modal from DOM
        modalContainer.remove();
        
        // Restore body scroll
        document.body.style.overflow = '';
    }
}


  
// ============================================
// UTILITY FUNCTIONS
// ============================================

// Get passengers data safely
function getPassengersDataSafe() {
    try {
        // Try to get from passenger counters
        const adults = document.getElementById('adultsCount')?.value || 
                      localStorage.getItem('search_adults') || '1';
        const children = document.getElementById('childrenCount')?.value || 
                        localStorage.getItem('search_children') || '0';
        const infants = document.getElementById('infantsCount')?.value || 
                       localStorage.getItem('search_infants') || '0';
        
        const adultsNum = parseInt(adults) || 1;
        const childrenNum = parseInt(children) || 0;
        const infantsNum = parseInt(infants) || 0;
        const total = adultsNum + childrenNum + infantsNum;
        
        return {
            adults: adultsNum,
            children: childrenNum,
            infants: infantsNum,
            total: total
        };
    } catch (error) {
        return { adults: 1, children: 0, infants: 0, total: 1 };
    }
}

// Convert currency
function convertCurrency(amount, fromCurrency, toCurrency) {
    if (fromCurrency === toCurrency) return amount;
    
    const fromRate = currencyRates[fromCurrency] || 1;
    const toRate = currencyRates[toCurrency] || 1;
    
    const baseAmount = amount / fromRate;
    return baseAmount * toRate;
}
// Get currency symbol
// Get currency symbol
function getCurrencySymbol(currencyCode) {
    const currency = SUPPORTED_CURRENCIES.find(c => c.code === currencyCode);
    return currency ? currency.symbol : '$';
}
// Format price for display
function formatPrice(amount, currencyCode = currentCurrency) {
    const symbol = getCurrencySymbol(currencyCode);
    const formattedAmount = amount.toLocaleString(undefined, { 
        minimumFractionDigits: 2, 
        maximumFractionDigits: 2 
    });
    return `${symbol}${formattedAmount}`;
}
// Get price multiplier for provider
function getPriceMultiplier(providerName) {
    const multipliers = {
        'EthioFly': 1.00,
        'Aviasales': 1.03,
        'Expedia': 1.05
    };
    return multipliers[providerName] || 1.00;
}
// Generate Expedia deep link (NEW with 6 parameters)
function generateExpediaDeepLinkNew(departureCode, arrivalCode, departureDate, returnDate, passengers, travelClass) {
    const formattedDepartureDate = departureDate;
    
    let url = `https://www.expedia.com/Flights-Search?flight-type=on&starDate=${formattedDepartureDate}&mode=search`;
    
    if (returnDate) {
        url += `&trip=roundtrip&leg1=from:${departureCode},to:${arrivalCode},departure:${formattedDepartureDate}TANYT&leg2=from:${arrivalCode},to:${departureCode},departure:${returnDate}TANYT`;
    } else {
        url += `&trip=oneway&leg1=from:${departureCode},to:${arrivalCode},departure:${formattedDepartureDate}TANYT`;
    }
    
    url += `&passengers=adults:${passengers},children:0,infantsinlap:0&options=cabinclass:${travelClass}&from=SRP&aid=304142`;
    
    return url;
}

// Generate Aviasales deep link (NEW with 6 parameters)
function generateAviasalesDeepLinkNew(departureCode, arrivalCode, departureDate, returnDate, passengers, travelClass) {
    const klassMap = {
        'economy': '1',
        'business': '2',
        'first': '3'
    };
    
    let url = `https://aviasales.com/search?origin=${departureCode}&destination=${arrivalCode}&depart_date=${departureDate}&adults=${passengers}&children=0&infants=0&klass=${klassMap[travelClass] || '1'}&marker=ethiofly`;
    
    if (returnDate) {
        url += `&return_date=${returnDate}`;
    }
    
    return url;
}
// Helper function for date formatting (waxaad leedahay tan hore)
function formatDateForURL(date) {
    if (!date) return '';
    const d = new Date(date);
    return d.toISOString().split('T')[0]; // Returns YYYY-MM-DD
}

// Track booking click
function trackBookingClick(flightId, provider, price, type) {
    console.log('Booking tracked:', {
        flight_id: flightId,
        provider: provider,
        price: price,
        type: type,
        timestamp: new Date().toISOString()
    });
}

// Track external booking
function trackExternalBooking(flightId, providerName, price, url) {
    console.log('External booking tracked:', {
        flight_id: flightId,
        provider: providerName,
        price: price,
        url: url,
        timestamp: new Date().toISOString()
    });
}

// Show notification
function showNotification(message, type = 'info') {
    // Remove existing notifications
    const existing = document.querySelector('.notification');
    if (existing) existing.remove();
    
    // Create notification
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            <span>${message}</span>
            <button class="notification-close">&times;</button>
        </div>
    `;
    
    // Add to page
    document.body.appendChild(notification);
    
    // Add close event
    notification.querySelector('.notification-close').addEventListener('click', () => {
        notification.remove();
    });
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 5000);
}
// Show price breakdown
function showPriceBreakdown(button, flightId) {
    const breakdown = document.getElementById(`breakdown-${flightId}`);
    if (!breakdown) return;
    
    const isShowing = breakdown.classList.contains('show');
    
    if (isShowing) {
        breakdown.classList.remove('show');
        button.innerHTML = '<i class="fas fa-receipt"></i> Price Details';
    } else {
        breakdown.classList.add('show');
        button.innerHTML = '<i class="fas fa-times"></i> Hide Details';
    }
}


// Save flight
function saveFlight(flightId) {
    if (!currentUser) {
        showNotification('Please login to save flights', 'warning');
        showPage('auth');
        return;
    }
    
    const flight = currentFlights.find(f => f.id === flightId) || window.flightDataMap?.[flightId];
    if (!flight) return;
    
    // Get saved flights from localStorage
    const savedFlights = JSON.parse(localStorage.getItem('ethiofly_saved_flights') || '[]');
    
    // Check if already saved
    if (savedFlights.some(f => f.id === flightId)) {
        showNotification('Flight already saved', 'info');
        return;
    }
    
    // Save flight
    savedFlights.push(flight);
    localStorage.setItem('ethiofly_saved_flights', JSON.stringify(savedFlights));
    
    showNotification('Flight saved to favorites', 'success');
}


// ============================================
// INITIALIZATION
// ============================================

// Make functions globally available
window.bookFlightNow = bookFlightNow;
window.handleProviderBooking = handleProviderBooking;
window.showComparisonModal = showComparisonModal;
window.closeComparisonModal = closeComparisonModal;
window.showPriceBreakdown = showPriceBreakdown;
window.saveFlight = saveFlight;
window.createFlightCard = createFlightCard;

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    console.log('Flight booking system initialized');
    
    // Set current currency from localStorage or default
    currentCurrency = localStorage.getItem('ethiofly_currency') || 'USD';
    
    // Load sample flights for testing (remove in production)
    if (window.location.href.includes('localhost') || window.location.href.includes('127.0.0.1')) {
        loadSampleFlights();
    }
});

// Load sample flights for testing
function loadSampleFlights() {
    const sampleFlights = [
        {
            id: 'SV-001-ADD-JED-RT',
            airline: 'Saudia',
            airlineCode: 'SV',
            departure: { time: '03:25', code: 'ADD', city: 'Addis Ababa', terminal: '' , date: new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }) },
            arrival: { time: '05:50', code: 'JED', city: 'Jeddah', terminal: '', date: new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }) },
            return: {
                departure: { time: '01:45', code: 'JED', city: 'Jeddah', terminal: '', date: new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }) },
                arrival: { time: '04:10', code: 'ADD', city: 'Addis Ababa', terminal: '', date: new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }) },
                stopDetails: null
            },
            duration: '2h 25m',
            price: 150,
            currency: 'USD',
            stops: 0,
            class: 'ECONOMY',
            flightNumber: 'SV001',
            date: new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),
            featured: true
        },
        {
            id: 'ET-701-ADD-DXB',
            airline: 'Ethiopian Airlines',
            airlineCode: 'ET',
            origin: 'ADD',
            destination: 'DXB',
            originCity: 'Addis Ababa',
            destinationCity: 'Dubai',
            departureTime: '08:00',
            arrivalTime: '22:30',
            duration: '14h 30m',
            price: 100,
            currency: 'USD',
            stops: 0,
            class: 'ECONOMY',
            flightNumber: 'ET701',
            date: new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),
            featured: true
        },
        {
            id: 'EK-723-ADD-DXB',
            airline: 'Emirates',
            airlineCode: 'EK',
            origin: 'ADD',
            destination: 'DXB',
            originCity: 'Addis Ababa',
            destinationCity: 'Dubai',
            departureTime: '10:30',
            arrivalTime: '00:15',
            duration: '13h 45m',
            price: 70,
            currency: 'USD',
            stops: 0,
            class: 'ECONOMY',
            flightNumber: 'EK723',
            date: new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),
            isBestDeal: true
        },
        {
            id: 'QR-667-ADD-DOH-DXB',
            airline: 'Qatar Airways',
            airlineCode: 'QR',
            origin: 'ADD',
            destination: 'DXB',
            originCity: 'Addis Ababa',
            destinationCity: 'Dubai',
            departureTime: '14:15',
            arrivalTime: '04:30',
            duration: '16h 15m',
            price: 100,
            currency: 'USD',
            stops: 1,
            class: 'ECONOMY',
            flightNumber: 'QR667',
            date: new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })
        }
    ];
    
    currentFlights = sampleFlights;
    
    // Display sample flights
    const resultsList = document.getElementById('resultsList');
    if (resultsList) {
        resultsList.innerHTML = '';
        sampleFlights.forEach(flight => {
            const flightCard = createFlightCard(flight);
            if (flightCard) {
                resultsList.appendChild(flightCard);
            }
        });
    }
}

function addBookingSystemStyles() {
    if (document.getElementById('booking-system-styles')) return;
    
    const styles = document.createElement('style');
    styles.id = 'booking-system-styles';
    
    styles.textContent = `
/* ============================
   BACK BUTTON SMALL FIX
   ============================ */
#backToSearch {
    padding: 6px 12px !important;
    font-size: 13px !important;
    border-radius: 8px !important;
    font-weight: 500 !important;
}

#backToSearch i {
    font-size: 12px !important;
}

        /* Book Now Button */
        .btn-select-flight {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .btn-select-flight:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }
        
        .btn-select-flight:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* Price Display */
        .price-with-currency {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .currency-symbol-large {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin-right: 4px;
        }
        
        .price-amount-large {
            font-size: 22px;
            font-weight: 700;
            color: var(--dark);
            line-height: 1;
        }
        
        .per-person {
            font-size: 12px;
            color: var(--gray);
            margin-top: 4px;
        }
        
        .price-original {
            font-size: 11px;
            color: var(--gray);
            text-decoration: line-through;
            margin-top: 2px;
        }
        
        /* Price Breakdown */
        .price-breakdown {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            border: 1px solid #e5e7eb;
            display: none;
        }
        
        .price-breakdown.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        .breakdown-header {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .breakdown-item:last-child {
            border-bottom: none;
        }
        
        .breakdown-item.subtotal {
            border-top: 1px solid #e5e7eb;
            margin-top: 0.5rem;
            padding-top: 0.75rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .breakdown-item.total {
            border-top: 2px solid #e5e7eb;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            font-weight: 700;
            color: var(--primary);
            font-size: 1rem;
        }
        
        .conversion-note {
            font-size: 0.75rem;
            color: var(--gray);
            margin-top: 0.75rem;
            padding: 0.5rem;
            background: rgba(59, 130, 246, 0.05);
            border-radius: 4px;
            border-left: 3px solid var(--info);
        }
        
        .conversion-note i {
            margin-right: 0.5rem;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .btn {
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.475rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--info));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.2);
        }
        
        .btn-secondary {
            background: var(--light);
            color: var(--gray);
            border: 1px solid var(--gray-light);
        }
        
        .btn-secondary:hover {
            background: var(--gray-light);
        }
        
        .btn-small {
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
        }
             /* Flight Meta */
        .flight-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            margin: 1rem 0;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        .meta-item i {
            color: var(--primary);
        }


/* ================================
   FLIGHT CARD GRID FULL FIX
   RIGHT PANEL FILLS SPACE
   ================================ */
.flight-card {
    background: white;
    border-radius: 10px;
    margin-bottom: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    overflow: hidden;

    display: block; /* âœ… not flex column */
}

.card-body-grid {
    display: grid;
    grid-template-columns: 1fr 240px;
    align-items: stretch; /* â­ important */
}
.card-right {
    display: flex;
    height: 100%;
}

.price-box {
    flex: 1;
    height: 100%;
}


/* Price display */
.price-with-currency {
    text-align: center;
}

.currency-symbol-large {
    font-size: 20px;
    font-weight: 700;
    color: var(--primary);
}

.price-amount-large {
    font-size: 30px;
    font-weight: 800;
    color: var(--dark);
    line-height: 1.1;
}

.per-person {
    font-size: 13px;
    color: var(--gray);
    margin-top: 6px;
}

/* Note under price */
.conversion-note {
    font-size: 0.8rem;
    color: var(--gray);
    padding: 8px;
    background: rgba(59, 130, 246, 0.06);
    border-radius: 6px;
    border-left: 4px solid var(--info);
}

/* Book button */
.btn-select-flight {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    border: none;
    padding: 6px 8px;
    border-radius: 10px;
    font-weight: 1400;
    cursor: pointer;
    transition: 0.25s;
    width: 100%;
    font-size: 15px;
}

.btn-select-flight:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 24px rgba(5, 150, 105, 0.25);
}

/* Small actions below */
.small-actions {
    display: flex;
    justify-content: space-between;
    gap: 5px;
    margin-top: 5px;
}

/* Responsive collapse */
@media (max-width: 450px) {
    .card-body-grid {
        grid-template-columns: 1fr;
    }

    .card-right {
        margin-top: 12px;
    }

    .price-box {
        height: auto;
    }
}


              /* Compact line tweaks */
        .compact-line { margin-bottom: 0.4rem; }
        .small { font-size: 0.65rem; color: var(--gray); }

        /* Ensure responsive collapse */
        @media (max-width: 450px) {
            .card-body-grid { grid-template-columns: 1fr; }
            .card-right { order: 2; }
        }

        .flight-card.roundtrip .flight-price-section {
            grid-column: 3 / 4;
            align-self: center;
            justify-self: center;
            width: 100%;
            padding-left: 6px;
            border-left: o.5px solid rgba(0,0,0,0.04);
        }

        .flight-card.roundtrip .return-block {
            border-top: 0.5px dashed rgba(0,0,0,0.06);
            padding-top: 6px;
            margin-top: 4px;
        }

        @media (max-width: 450px) {
            .flight-card.roundtrip .flight-details-grid {
                grid-template-columns: 1fr;
            }
            .flight-card.roundtrip .flight-price-section {
                grid-column: 1 / -1;
                border-left: none;
                padding-left: 0;
            }
            .flight-card.roundtrip .return-block {
                border-top: 1px dashed rgba(0,0,0,0.06);
            }
        }
    `;
    
    document.head.appendChild(styles);
}


// Add CSS when page loads
document.addEventListener('DOMContentLoaded', addBookingSystemStyles);
// Get currency symbol
function getCurrencySymbol(currencyCode) {
    const currency = SUPPORTED_CURRENCIES.find(c => c.code === currencyCode);
    return currency ? currency.symbol : currencyCode;
}

// Parse duration to minutes
function parseDuration(duration) {
    if (!duration) return 0;
    const hoursMatch = duration.match(/(\d+)h/);
    const minutesMatch = duration.match(/(\d+)m/);
    
    const hours = hoursMatch ? parseInt(hoursMatch[1]) : 0;
    const minutes = minutesMatch ? parseInt(minutesMatch[1]) : 0;
    
    return hours * 60 + minutes;
}      
     
// Update price breakdown
function updatePriceBreakdown(flightId, price, originalCurrency) {
    const breakdownElement = document.getElementById(`breakdown-${flightId}`);
    if (!breakdownElement) return;

    const passengersData = getPassengersDataSafe() || { adults: 1, children: 0, infants: 0, total: 1 };
    
    // Convert to current currency
    const totalConverted = convertCurrency(price, originalCurrency, currentCurrency);
    const pricePerPerson = totalConverted / passengersData.total;
    
    // Calculate breakdown percentages
    const baseFarePerPerson = pricePerPerson * 0.7;
    const taxesFeesPerPerson = pricePerPerson * 0.25;
    const fuelSurchargePerPerson = pricePerPerson * 0.05;
    
    const currencySymbol = getCurrencySymbol(currentCurrency);

    breakdownElement.innerHTML = `
        <div class="breakdown-header">
            <strong>Price Breakdown (per person)</strong>
        </div>
        <div class="breakdown-item">
            <span>Base Fare</span>
            <span>${currencySymbol}${baseFarePerPerson.toFixed(2)}</span>
        </div>
        <div class="breakdown-item">
            <span>Taxes & Fees</span>
            <span>${currencySymbol}${taxesFeesPerPerson.toFixed(2)}</span>
        </div>
        <div class="breakdown-item">
            <span>Fuel Surcharge</span>
            <span>${currencySymbol}${fuelSurchargePerPerson.toFixed(2)}</span>
        </div>
        <div class="breakdown-item subtotal">
            <span>Per Person Total</span>
            <span>${currencySymbol}${pricePerPerson.toFixed(2)}</span>
        </div>

        ${passengersData.total > 1 ? `
            <div class="breakdown-header mt-2">
                <strong>Total for ${passengersData.total} Passenger${passengersData.total > 1 ? 's' : ''}</strong>
            </div>
            <div class="breakdown-item">
                <span>Base Fare (Ã—${passengersData.total})</span>
                <span>${currencySymbol}${(baseFarePerPerson * passengersData.total).toFixed(2)}</span>
            </div>
            <div class="breakdown-item">
                <span>Taxes & Fees (Ã—${passengersData.total})</span>
                <span>${currencySymbol}${(taxesFeesPerPerson * passengersData.total).toFixed(2)}</span>
            </div>
            <div class="breakdown-item">
                <span>Fuel Surcharge (Ã—${passengersData.total})</span>
                <span>${currencySymbol}${(fuelSurchargePerPerson * passengersData.total).toFixed(2)}</span>
            </div>
        ` : ''}

        <div class="breakdown-item total">
            <span>Grand Total</span>
            <span>${currencySymbol}${totalConverted.toFixed(2)}</span>
        </div>

        ${currentCurrency !== originalCurrency ? `
            <div class="conversion-note">
                <i class="fas fa-exchange-alt"></i>
                Converted from ${originalCurrency} ${formatPrice(price, originalCurrency)}
                (Rate: 1 ${originalCurrency} = ${convertCurrency(1, originalCurrency, currentCurrency).toFixed(2)} ${currentCurrency})
            </div>
        ` : ''}
    `;
}

// Update flight card price display
function updateFlightCardPrice(flightId, originalPrice, originalCurrency) {
    const priceDisplay = document.getElementById(`priceDisplay-${flightId}`);
    const conversionNote = document.getElementById(`conversionNote-${flightId}`);
    
    if (!priceDisplay) return;
    
    const convertedPrice = convertCurrency(originalPrice, originalCurrency, currentCurrency);
    const currencySymbol = getCurrencySymbol(currentCurrency);
    const passengersData = getPassengersDataSafe() || { total: 1 };
    
    priceDisplay.innerHTML = `
        <div class="currency-symbol-large">${currencySymbol}</div>
        <div class="price-amount-large">${convertedPrice.toFixed(2)}</div>
        ${passengersData.total > 1 ? 
            `<div class="per-person">${currencySymbol}${(convertedPrice / passengersData.total).toFixed(2)} per person</div>` : 
            ''
        }
    `;
    
    if (conversionNote && currentCurrency !== originalCurrency) {
        conversionNote.innerHTML = `
            <i class="fas fa-exchange-alt"></i>
            Converted from ${originalCurrency}
        `;
    }
}


       // Enhanced displayFlightResults with null check
function displayFlightResults(flights, searchData) {
    const searchContainer = document.querySelector('.search-container');
    const resultsContainer = document.getElementById('searchResults');
    
    if (searchContainer) searchContainer.style.display = 'none';
    if (resultsContainer) {
        resultsContainer.classList.remove('hidden');
        
        updateSearchInfo(searchData);
        updateSearchHeaderCurrency();
        addQuickFilters();
        
        const resultsList = document.getElementById('resultsList');
        if (resultsList) {
            resultsList.innerHTML = '';
            
            if (!flights || flights.length === 0) {
                resultsList.innerHTML = createNoResultsHTML();
                return;
            }
            
            
            if (searchData && searchData.returnDate) {
                flights = flights.map(f => {
                    if (f.return) return f;
                    const ret = {
                        departure: {
                            time: f.arrival?.time || '00:00',
                            code: f.arrival?.code || f.destination || '',
                            city: f.arrival?.city || f.destinationCity || '' ,
                            terminal: f.arrival?.terminal || '',
                            gate: f.arrival?.gate || ''
                        },
                        arrival: {
                            time: f.departure?.time || '00:00',
                            code: f.departure?.code || f.origin || '',
                            city: f.departure?.city || f.originCity || '',
                            terminal: f.departure?.terminal || '',
                            gate: f.departure?.gate || ''
                        },
                        date: searchData.returnDate,
                        stopDetails: f.returnStopDetails || null,
                        // if inbound stops provided use that, otherwise mirror outbound
                        stops: (f.inboundStops !== undefined ? f.inboundStops : (f.return?.stops !== undefined ? f.return.stops : (f.stops !== undefined ? f.stops : 0)))
                    };
                    return { ...f, return: ret };
                });
            }

            currentFlights = flights;
            
            // Update results stats
            updateResultsStats(flights);
            
            // Display each flight with null check
            flights.forEach(flight => {
                const flightCard = createFlightCard(flight);
                if (flightCard) {
                    resultsList.appendChild(flightCard);
                    // populate logo asynchronously
                    try { populateAirlineLogo(flightCard, (flight.airlineCode || flight.airline || flight.providerCode || '').toUpperCase(), flight.airlineName || flight.airline || flight.provider); } catch(e){console.warn('logo populate err',e);} 
                }
            });
            
            // Add currency disclaimer
            resultsList.appendChild(createCurrencyDisclaimer());

            // Populate airline filters based on the results
            try { updateAirlineFilters(); } catch (e) { console.warn('Failed to update airline filters', e); }

            // Setup sort tab behavior (mobile segmented control)
            document.querySelectorAll('.sort-tab').forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.sort-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    sortFlightsAndRender(this.dataset.sort);
                });
            });

            // Sort function â€” operates on currentFlights and re-renders
            function sortFlightsAndRender(type) {
                if (!Array.isArray(currentFlights)) return;
                let sorted = [...currentFlights];
                if (type === 'cheapest') {
                    sorted.sort((a,b) => (a.price || 0) - (b.price || 0));
                } else if (type === 'fastest') {
                    sorted.sort((a,b) => parseDuration(a.duration) - parseDuration(b.duration));
                } else if (type === 'recommended') {
                    // Best deals first, then cheapest
                    sorted.sort((a,b) => (b.isBestDeal ? 1 : 0) - (a.isBestDeal ? 1 : 0) || (a.price || 0) - (b.price || 0));
                }
                // Clear and re-render
                resultsList.innerHTML = '';
                sorted.forEach(f => {
                    const card = createFlightCard(f);
                    if (card) resultsList.appendChild(card);
                });
                resultsList.appendChild(createCurrencyDisclaimer());
            }

            // Auto-apply currently active sort tab (cheapest by default)
            const activeSort = document.querySelector('.sort-tab.active');
            if (activeSort) sortFlightsAndRender(activeSort.dataset.sort || 'cheapest');
        }
    }
}

        // Update results statistics
        function updateResultsStats(flights) {
            const flightsCount = document.getElementById('flightsCount');
            const priceRange = document.getElementById('priceRange');
            
            if (flightsCount && flights.length > 0) {
                flightsCount.textContent = `${flights.length} flight${flights.length > 1 ? 's' : ''}`;
            }

            // Update the compact results counter (e.g., "Showing 48 of 48 flight options")
            const resultsCountEl = document.getElementById('resultsCount');
            if (resultsCountEl) {
                resultsCountEl.textContent = `Showing ${flights.length} of ${flights.length} flight option${flights.length !== 1 ? 's' : ''}`;
            }
            
            if (priceRange && flights.length > 0) {
                const prices = flights.map(f => f.price);
                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);
                const currencyInfo = SUPPORTED_CURRENCIES.find(c => c.code === currentCurrency);
                
                if (minPrice === maxPrice) {
                    priceRange.textContent = `${currencyInfo.symbol}${formatNumber(minPrice)}`;
                } else {
                    priceRange.textContent = `${currencyInfo.symbol}${formatNumber(minPrice)} - ${currencyInfo.symbol}${formatNumber(maxPrice)}`;
                }
            }
        }

        // Build airline filter checkboxes based on current search results
        function updateAirlineFilters() {
            const container = document.getElementById('airlineFilters') || document.querySelector('.airline-filters');
            if (!container) return;

            container.innerHTML = '';
            if (!Array.isArray(currentFlights) || currentFlights.length === 0) return;

            const map = new Map();
            currentFlights.forEach(f => {
                const code = (f.airlineCode || f.airline || f.providerCode || f.carrierCode || f.operatingCarrier?.iata_code || '').toString().toUpperCase().trim();
                const name = f.airlineName || f.airline || f.provider || f.operatingCarrier?.name || code || 'Unknown';
                if (!code) return;
                if (!map.has(code)) map.set(code, name);
            });

            // If no airlines found, don't render
            if (map.size === 0) return;

            // Add an "All" toggle
            const allLabel = document.createElement('label');
            allLabel.style.display = 'block';
            allLabel.innerHTML = `<input type="checkbox" id="airline_all" checked> All`;
            container.appendChild(allLabel);
            document.getElementById('airline_all').addEventListener('change', function() {
                const checked = this.checked;
                container.querySelectorAll('input[name="airline"]').forEach(cb => cb.checked = checked);
                filterAndRenderFlights();
            });

            // Render each airline
            map.forEach((name, code) => {
                const label = document.createElement('label');
                label.style.display = 'flex';
                label.style.alignItems = 'center';
                label.style.gap = '8px';

                // Build logo placeholder
                const logoWrap = document.createElement('div');
                logoWrap.className = 'airline-filter-logo';
                logoWrap.style.display = 'flex';
                logoWrap.style.alignItems = 'center';
                logoWrap.style.width = '36px';
                logoWrap.style.height = '24px';

                logoWrap.innerHTML = `<img class="airline-logo-img" style="display:none; width:36px; height:24px; object-fit:contain;"/><div class="airline-logo" style="display:flex;align-items:center;justify-content:center;width:36px;height:24px;border-radius:4px;background:#eef2ff;color:#0f172a;font-weight:700;">${code}</div>`;

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = 'airline';
                checkbox.value = code;
                checkbox.checked = true;

                const text = document.createElement('span');
                text.textContent = `${escapeHtml(name)} (${code})`;

                label.appendChild(logoWrap);
                label.appendChild(checkbox);
                label.appendChild(text);

                container.appendChild(label);

                // populate logo for this small widget
                (async () => {
                    try {
                        await populateAirlineLogo(logoWrap, code, name);
                    } catch (err) {
                        // ignore
                    }
                })();
            });

            // Attach change listeners
            container.querySelectorAll('input[name="airline"]').forEach(cb => cb.addEventListener('change', function() {
                // Uncheck 'All' if any unchecked
                const all = document.getElementById('airline_all');
                if (all) all.checked = Array.from(container.querySelectorAll('input[name="airline"]')).every(i => i.checked);
                filterAndRenderFlights();
            }));
        }

        // Filter currentFlights by selected airlines and re-render results
        function filterAndRenderFlights() {
            const container = document.getElementById('airlineFilters') || document.querySelector('.airline-filters');
            const resultsList = document.getElementById('resultsList');
            if (!resultsList) return;

            const checked = container ? Array.from(container.querySelectorAll('input[name="airline"]:checked')).map(i => i.value.toUpperCase()) : [];

            const filtered = (!checked || checked.length === 0) ? currentFlights : currentFlights.filter(f => {
                const code = (f.airlineCode || f.airline || f.providerCode || f.carrierCode || f.operatingCarrier?.iata_code || '').toString().toUpperCase().trim();
                const name = (f.airlineName || f.airline || f.provider || '').toString().toUpperCase();
                return checked.includes(code) || checked.includes(name);
            });

            // Clear and re-render
            resultsList.innerHTML = '';
            if (!filtered || filtered.length === 0) {
                resultsList.innerHTML = createNoResultsHTML();
                return;
            }
            // Render each filtered flight with defensive error handling so one bad item
            // doesn't prevent the rest from rendering.
            let appended = 0;
            filtered.forEach(f => {
                try {
                    const card = createFlightCard(f);
                    if (card) {
                        resultsList.appendChild(card);
                        appended++;
                        // Ensure logo is populated for re-rendered/filtered cards
                        try {
                            populateAirlineLogo(card, (f.airlineCode || f.airline || '').toString().toUpperCase().trim(), f.airlineName || f.airline || '');
                        } catch (e) {
                            console.warn('populateAirlineLogo after filter failed', e);
                        }
                    }
                } catch (err) {
                    console.error('Error rendering flight card for', f, err);
                    // Insert a lightweight fallback card so UI isn't left empty
                    const fallback = document.createElement('div');
                    fallback.className = 'flight-card flight-card-error';
                    fallback.innerHTML = `<div style="padding:12px;color:#cc0000;">Failed to render a flight option for ${escapeHtml(f.airlineName || f.airline || 'Unknown')}. Check console for details.</div>`;
                    resultsList.appendChild(fallback);
                    appended++;
                }
            });

            // If nothing rendered (all items failed), show no-results message
            if (appended === 0) {
                resultsList.innerHTML = createNoResultsHTML();
                return;
            }

            resultsList.appendChild(createCurrencyDisclaimer());
        }

        // Basic HTML escaping
        function escapeHtml(str) {
            return String(str || '').replace(/[&<>\"']/g, function (c) {
                return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[c];
            });
        }

        // --- Airline logo helper: try built-in map then several CDN patterns ---
        const AIRLINE_LOGO_MAP = {
            'ET': 'https://i.postimg.cc/7LKNYngj/20260102-005814.png',
            'EK': 'https://i.postimg.cc/15xRjxkm/images-(2).png',
            'QR': 'https://i.postimg.cc/VvpC3SBZ/20260102-005947.png',
            'TK': 'https://i.postimg.cc/5ySjqbx6/images-(5).png',
            'MS': 'https://i.postimg.cc/sXkGh0jq/images.png',
            'WY': 'https://i.postimg.cc/WbSLk2QP/download-(4).jpg'
        };

        // Try a list of URL templates where {code} will be replaced with IATA carrier code
        const AIRLINE_LOGO_URL_PATTERNS = [
            'https://images.kiwi.com/airlines/64/{code}.png',
            'https://content.airhex.com/content/logos/airlines_64/{code}.png',
            'https://logos.skyscnr.com/images/airlines/64/{code}.png',
            'https://www.gstatic.com/flights/airline_logos/72px/{code}.png'
        ];

        function tryImageUrl(url) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(url);
                img.onerror = () => resolve(null);
                img.src = url;
            });
        }

        async function getLogoForAirline(code, name) {
            if (!code && !name) return null;
            const upper = (code || '').toString().toUpperCase().trim();

            // 1) Built-in map
            if (upper && AIRLINE_LOGO_MAP[upper]) return AIRLINE_LOGO_MAP[upper];

            // 2) Try code-based patterns
            if (upper) {
                for (const tpl of AIRLINE_LOGO_URL_PATTERNS) {
                    const url = tpl.replace('{code}', upper);
                    const ok = await tryImageUrl(url);
                    if (ok) return ok;
                }
            }

            // 3) Try name-based lookup by normalizing known substrings
            const n = (name || '').toString().toLowerCase();
            for (const k in AIRLINE_LOGO_MAP) {
                const v = AIRLINE_LOGO_MAP[k];
                if (n.includes(k.toLowerCase()) || (k.toLowerCase().includes(' ') && n.includes(k.split(' ')[0]))) return v;
            }

            return null;
        }

        // Populate the logo for a card element (async)
        async function populateAirlineLogo(card, airlineCode, airlineName) {
            try {
                const img = card.querySelector('.airline-logo-img');
                const badge = card.querySelector('.airline-logo');
                if (!img || !badge) return;

                // If the flight already had an inline logo set (data attribute), skip
                const existingSrc = img.getAttribute('src');
                if (existingSrc) {
                    img.style.display = 'block';
                    badge.style.display = 'none';
                    return;
                }

                const url = await getLogoForAirline(airlineCode, airlineName);
                if (url) {
                    img.src = url;
                    img.style.display = 'block';
                    badge.style.display = 'none';
                } else {
                    img.style.display = 'none';
                    badge.style.display = 'flex';
                }
            } catch (e) {
                console.warn('populateAirlineLogo failed', e);
            }
        }

        // Create no results HTML
        function createNoResultsHTML() {
            return `
                <div class="no-results-enhanced">
                    <i class="fas fa-plane-slash no-results-icon"></i>
                    <h3>No flights found</h3>
                    <p>Try adjusting your search criteria or dates.</p>
                    <div class="suggestions mt-3">
                        <p class="text-sm text-gray-600 mb-2">Suggestions:</p>
                        <ul class="list-disc list-inside text-sm text-gray-600">
                            <li>Try different travel dates</li>
                            <li>Check nearby airports</li>
                            <li>Be more flexible with your travel times</li>
                            <li>Consider one-way flights</li>
                        </ul>
                    </div>
                    <button class="btn btn-primary mt-4" onclick="showSearchForm()">
                        <i class="fas fa-search"></i> back
                    </button>
                </div>
            `;
        }

        // Create currency disclaimer
        function createCurrencyDisclaimer() {
            const disclaimer = document.createElement('div');
            disclaimer.className = 'currency-disclaimer';
            disclaimer.innerHTML = `
                <div class="text-center text-sm text-gray-500 p-3">
                   
                    </button>
                </div>
            `;
            return disclaimer;
        }

        // Refresh currency rates
        window.refreshCurrencyRates = async function() {
            const button = document.querySelector('button[onclick="refreshCurrencyRates()"]');
            if (button) {
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
                button.disabled = true;
            }
            
            await fetchCurrencyRates();
            
            if (button) {
                button.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh Exchange Rates';
                button.disabled = false;
            }
            
            showNotification('Exchange rates refreshed', 'success');
        };

        // Show search form (hide results)
        function showSearchForm() {
            const searchContainer = document.querySelector('.search-container');
            const resultsContainer = document.getElementById('searchResults');
            
            if (searchContainer) searchContainer.style.display = 'block';
            if (resultsContainer) resultsContainer.classList.add('hidden');
        }

     // Update search information display (including price)
function updateSearchInfo(searchData) {
    const routeElement = document.getElementById('searchRoute');
    const datesElement = document.getElementById('searchDates');
    const priceElement = document.getElementById('searchPrice'); // new element for price display
    
   // Route info
if (routeElement && searchData) {
    const fromCity = extractCityName(searchData.from) || searchData.from;
    const toCity = extractCityName(searchData.to) || searchData.to;
    const fromCode = extractIATACode(searchData.from) || '';
    const toCode = extractIATACode(searchData.to) || '';

    // âœ… If Roundtrip (returnDate exists)
    if (searchData.returnDate) {
        routeElement.textContent =
            `${fromCity} (${fromCode}) â‡„ ${toCity} (${toCode})`;
    } else {
        // One Way
        routeElement.textContent =
            `${fromCity} (${fromCode}) â†’ ${toCity} (${toCode})`;
    }
}

    
    // Dates & passengers
    if (datesElement && searchData) {
        const departureDate = new Date(searchData.departure);
        const formattedDate = departureDate.toLocaleDateString('en-US', {
            weekday: 'short',
            month: 'short',
            day: 'numeric'
        });
        
        let passengersText = '';
        if (searchData.adults) passengersText += `${searchData.adults} Adult${searchData.adults > 1 ? 's' : ''}`;
        if (searchData.children) passengersText += `${passengersText ? ', ' : ''}${searchData.children} Child${searchData.children > 1 ? 'ren' : ''}`;
        if (searchData.infants) passengersText += `${passengersText ? ', ' : ''}${searchData.infants} Infant${searchData.infants > 1 ? 's' : ''}`;
        
        let dateText = `${formattedDate} â€¢ ${passengersText} â€¢ ${capitalizeFirstLetter(searchData.travelClass || 'economy')}`;
        
        if (searchData.returnDate) {
            const returnDate = new Date(searchData.returnDate);
            const formattedReturn = returnDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            dateText += ` â€¢ Return: ${formattedReturn}`;
        }
        
        datesElement.textContent = dateText;
    }
    
    // Price info
    if (priceElement && searchData?.flights?.length) {
        // Haddii aad rabto price-ka ugu horeeya:
        const firstFlightPrice = searchData.flights[0].totalPrice || searchData.flights[0].price;
        priceElement.textContent = `Price: ${firstFlightPrice.toLocaleString()} USD`; // ama USD
    }
}

        // ============================================
        // AIRPORT SUGGESTIONS
        // ============================================

        // Show airport suggestions
        async function showAirportSuggestions(input, suggestionsBox) {
            if (!input || !suggestionsBox) return;
            
            const query = input.value.trim();
            
            if (!query) {
                suggestionsBox.style.display = 'none';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/airport-suggestions/${query}`);
                const data = await response.json();
                
                if (response.ok && data.data && data.data.length > 0) {
                    suggestionsBox.innerHTML = '';
                    
                    data.data.forEach(airport => {
                        const item = document.createElement('div');
                        item.className = 'suggestion-item';
                        item.innerHTML = `
                            <div class="suggestion-code">${airport.code}</div>
                            <div class="suggestion-details">
                                <div class="suggestion-city">${airport.city}</div>
                                <div class="suggestion-name">${airport.name}</div>
                                <div class="suggestion-country">${airport.country}</div>
                            </div>
                        `;
                        
                        item.addEventListener('click', () => {
                            input.value = `${airport.city} (${airport.code})`;
                            suggestionsBox.style.display = 'none';
                        });
                        
                        suggestionsBox.appendChild(item);
                    });
                    
                    suggestionsBox.style.display = 'block';
                } else {
                    suggestionsBox.style.display = 'none';
                }
            } catch (error) {
                console.error('Airport suggestions error:', error);
                suggestionsBox.style.display = 'none';
            }
        }

        // Hide all suggestions
        function hideSuggestions() {
            if (fromSuggestions) fromSuggestions.style.display = 'none';
            if (toSuggestions) toSuggestions.style.display = 'none';
        }

        // Swap departure and arrival locations
        function swapLocations() {
            if (!fromInput || !toInput) return;
            
            const temp = fromInput.value;
            fromInput.value = toInput.value;
            toInput.value = temp;
        }

        // Set destination from popular destinations
        window.setDestination = function(destination) {
            toInput.value = destination;
            navigateToPage('flights');
            fromInput.focus();
        };

        // Add quick filters
        function addQuickFilters() {
            const container = document.getElementById('quickFiltersContainer');
            if (!container) return;
            
            container.innerHTML = `
                <div class="quick-filters">
                    <button class="quick-filter-btn active" data-filter="all">
                        <i class="fas fa-layer-group"></i> All Flights
                    </button>
                    <button class="quick-filter-btn" data-filter="nonstop">
                        <i class="fas fa-plane"></i> Non-stop
                    </button>
                    <button class="quick-filter-btn" data-filter="cheapest">
                        <i class="fas fa-money-bill-wave"></i> Cheapest
                    </button>
                    <button class="quick-filter-btn" data-filter="fastest">
                        <i class="fas fa-clock"></i> Fastest
                    </button>
                    <button class="quick-filter-btn" data-filter="morning">
                        <i class="fas fa-sun"></i> Morning
                    </button>
                    <button class="quick-filter-btn" data-filter="evening">
                        <i class="fas fa-moon"></i> Evening
                    </button>
                </div>
            `;
            
            // Add filter functionality
            document.querySelectorAll('.quick-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.quick-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    applyQuickFilter(this.dataset.filter);
                });
            });
        }

        function applyQuickFilter(filter) {
    const cards = document.querySelectorAll('.flight-card');
    
    cards.forEach(card => {
        const outboundStops = parseInt(card.dataset.outboundStops) || 0;
        const inboundStops = parseInt(card.dataset.inboundStops) || 0;
        const depTime = card.querySelector('.departure-block .time-large')?.textContent || '';
        const hour = depTime ? parseInt(depTime.split(':')[0]) : 0;

        switch(filter) {
            case 'nonstop':
                // Roundtrip: labadaba stops waa 0
                if (outboundStops === 0 && inboundStops === 0) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
                break;

            case 'cheapest':
                const sortedByPrice = Array.from(cards).sort((a, b) => {
                    const priceA = parseFloat(a.dataset.originalPrice) || 0;
                    const priceB = parseFloat(b.dataset.originalPrice) || 0;
                    return priceA - priceB;
                });
                sortedByPrice.forEach((c, i) => {
                    c.style.order = i;
                    c.style.display = '';
                });
                break;

            case 'fastest':
                const sortedByDuration = Array.from(cards).sort((a, b) => {
                    const durA = parseInt(a.dataset.duration) || 0;
                    const durB = parseInt(b.dataset.duration) || 0;
                    return durA - durB;
                });
                sortedByDuration.forEach((c, i) => {
                    c.style.order = i;
                    c.style.display = '';
                });
                break;

            case 'morning':
                card.style.display = (hour >= 5 && hour < 12) ? '' : 'none';
                break;

            case 'evening':
                card.style.display = (hour >= 16 && hour < 22) ? '' : 'none';
                break;

                default:
                    card.style.display = '';
                    card.style.order = '';
        }
    });
        // For 'all' filter, reset order for all cards
        if (filter === 'all') {
            cards.forEach(card => {
                card.style.order = '';
                card.style.display = '';
            });
        }
}

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        // Show notification
        function showNotification(message, type = 'info') {
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${getNotificationIcon(type)}"></i>
                    <span>${message}</span>
                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">&times;</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        function getNotificationIcon(type) {
            switch(type) {
                case 'success': return 'check-circle';
                case 'error': return 'exclamation-circle';
                case 'warning': return 'exclamation-triangle';
                default: return 'info-circle';
            }
        }

        // Extract city name from input
        function extractCityName(input) {
            if (!input) return '';
            return input.split('(')[0].trim();
        }

        // Extract IATA code from input
        function extractIATACode(input) {
            if (!input) return '';
            const match = input.match(/\(([A-Z]{3})\)/);
            return match ? match[1] : '';
        }

        // Capitalize first letter
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Format flight date
        function formatFlightDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                weekday: 'short', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        // Parse duration to minutes
        function parseDuration(duration) {
            const hoursMatch = duration.match(/(\d+)h/);
            const minutesMatch = duration.match(/(\d+)m/);
            
            const hours = hoursMatch ? parseInt(hoursMatch[1]) : 0;
            const minutes = minutesMatch ? parseInt(minutesMatch[1]) : 0;
            
            return hours * 60 + minutes;
        }

        // Save search to history
        function saveSearchToHistory(searchData) {
            searchHistory.unshift({
                ...searchData,
                timestamp: new Date().toISOString()
            });
            
            if (searchHistory.length > 10) {
                searchHistory = searchHistory.slice(0, 10);
            }
            
            localStorage.setItem('ethiofly_search_history', JSON.stringify(searchHistory));
        }

        // Load saved search from history
        function loadSavedSearch() {
            if (searchHistory.length > 0) {
                const lastSearch = searchHistory[0];
                
                if (fromInput && lastSearch.from) fromInput.value = lastSearch.from;
                if (toInput && lastSearch.to) toInput.value = lastSearch.to;
                
                const departureInput = document.getElementById('departure');
                if (departureInput && lastSearch.departure) {
                    departureInput.value = lastSearch.departure;
                }
                
                const returnInput = document.getElementById('return');
                if (returnInput && lastSearch.returnDate) {
                    returnInput.value = lastSearch.returnDate;
                }
            }
        }

        // Handle flight sorting
        function handleSortFlights(e) {
            const sortBy = e.target.value;
            
            if (!currentFlights.length) return;
            
            let sortedFlights = [...currentFlights];
            
            switch(sortBy) {
                case 'price':
                    sortedFlights.sort((a, b) => a.price - b.price);
                    break;
                case 'duration':
                    sortedFlights.sort((a, b) => {
                        const aDuration = parseDuration(a.duration);
                        const bDuration = parseDuration(b.duration);
                        return aDuration - bDuration;
                    });
                    break;
                case 'departure':
                    sortedFlights.sort((a, b) => {
                        const aTime = convertTimeToMinutes(a.departure.time);
                        const bTime = convertTimeToMinutes(b.departure.time);
                        return aTime - bTime;
                    });
                    break;
                case 'airline':
                    sortedFlights.sort((a, b) => a.airlineName.localeCompare(b.airlineName));
                    break;
            }
            
            currentFlights = sortedFlights;
            const resultsList = document.getElementById('resultsList');
            if (resultsList) {
                resultsList.innerHTML = '';
                currentFlights.forEach(flight => {
                    const flightCard = createFlightCard(flight);
                    resultsList.appendChild(flightCard);
                });
            }
        }

        function convertTimeToMinutes(time) {
            const [hours, minutes] = time.split(':').map(Number);
            return hours * 60 + minutes;
        }

        // ============================================
        // GLOBAL FUNCTIONS (accessible from HTML)
        // ============================================

        // Show/hide price breakdown
        window.showPriceBreakdown = function(button, flightId) {
            const breakdown = document.getElementById(`breakdown-${flightId}`);
            if (!breakdown) return;
            
            breakdown.classList.toggle('show');
            
            if (breakdown.classList.contains('show')) {
                button.innerHTML = '<i class="fas fa-times"></i> Close';
                button.classList.add('active');
            } else {
                button.innerHTML = '<i class="fas fa-receipt"></i> Details';
                button.classList.remove('active');
            }
        };

 // Book flight 
        window.bookFlight = function(flightId) {
            const flight = currentFlights.find(f => f.id === flightId);
            if (!flight) return;
            
            if (!currentUser) {
                showNotification('Redirecting to airline website...', 'info');
                window.open(flight.bookingUrl, '_blank');
                return;
            }
            
            const passengersData = getPassengersData();
            const confirmation = confirm(`Book ${flight.airlineName} flight from ${flight.departure.city} to ${flight.arrival.city} for ${passengersData.total} passenger${passengersData.total > 1 ? 's' : ''}?`);
            
            if (confirmation) {
                showNotification('Redirecting to airline website...', 'info');
                
                setTimeout(() => {
                    if (flight.bookingUrl) {
                        window.open(flight.bookingUrl, '_blank');
                    } else {
                        showNotification('Booking system not available', 'info');
                    }
                }, 1000);
            }
        };
       
        // Save flight to favorites
        window.saveFlight = async function(flightId) {
            const flight = currentFlights.find(f => f.id === flightId);
            if (!flight) return;
            
            if (!currentUser) {
                showNotification('Please login to save flights', 'warning');
                navigateToPage('auth');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/save-flight`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ flight })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to save flight');
                }
                
                showNotification(data.message || 'Flight saved to favorites', 'success');
                
            } catch (error) {
                console.error('Save flight error:', error);
                showNotification(error.message || 'Failed to save flight', 'error');
            }
        };

        // Share flight
        window.shareFlight = function(flightId) {
            const flight = currentFlights.find(f => f.id === flightId);
            if (!flight) return;
            
            const passengersData = getPassengersData();
            const shareText = `Check out this ${flight.airlineName} flight from ${flight.departure.city} to ${flight.arrival.city} for ${passengersData.total} passenger${passengersData.total > 1 ? 's' : ''} on Ethiofly!`;
            const shareUrl = window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Flight from Ethiofly',
                    text: shareText,
                    url: shareUrl
                });
            } else {
                navigator.clipboard.writeText(`${shareText}\n${shareUrl}`)
                    .then(() => showNotification('Flight details copied to clipboard', 'success'))
                    .catch(() => showNotification('Failed to copy to clipboard', 'error'));
            }
        };

        // Delete account
        window.deleteAccount = function() {
            if (confirm('Are you sure you want to delete your account? This cannot be undone.')) {
                currentUser = null;
                authToken = null;
                localStorage.removeItem('ethiofly_user');
                localStorage.removeItem('ethiofly_token');
                localStorage.removeItem('ethiofly_saved_flights');
                localStorage.removeItem('ethiofly_search_history');
                updateUserUI();
                showNotification('Account deleted successfully', 'success');
                navigateToPage('flights');
            }
        };



// ==============================
// Handle footer & header links
// ==============================
function handleLinkClick(event, sectionId) {
    const currentDomain = window.location.hostname;
    const targetDomain = "company.ethiofly.com"; // subdomain

    if(currentDomain !== targetDomain) {
        // User is on main site -> redirect to subdomain
        window.location.href = `https://${targetDomain}/#${sectionId}`;
    } else {
        // User is on subdomain -> show section
        event.preventDefault();
        showSection(sectionId);
    }
}

// ==============================
// Show Section + smooth scroll
// ==============================
function showSection(sectionId){
    document.querySelectorAll('.page-section').forEach(sec => sec.classList.remove('active'));
    const target = document.getElementById(sectionId);
    if(target){
        target.classList.add('active');
        target.scrollIntoView({behavior:'smooth', block:'start'});
    }
    document.getElementById('nav-links')?.classList.remove('show');
}

// ==============================
// Attach event to header links
// ==============================
document.querySelectorAll('nav ul li a').forEach(link => {
    link.addEventListener('click', e => {
        const sectionId = link.getAttribute('href').substring(1);
        handleLinkClick(e, sectionId);
    });
});

// ==============================
// Attach event to footer links
// ==============================
document.querySelectorAll('.footer-link').forEach(link => {
    link.addEventListener('click', e => {
        const sectionId = link.getAttribute('href').substring(1);
        handleLinkClick(e, sectionId);
    });
});

// ==============================
// Mobile menu toggle
// ==============================
function toggleMenu(){
    document.getElementById('nav-links').classList.toggle('show');
}

        // Handle hash changes
        window.addEventListener('hashchange', checkUrlHash);

console.log('DEBUG PRICE:', flight.id, flight.price, flight.currency, currentCurrency);
 // ============================================
    // UTILITY FUNCTIONS
    // ============================================

    // Show Notification
    function showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `
            <div class="notification-content">
                <i class="fas fa-${getNotificationIcon(type)}"></i>
                <span>${message}</span>
                <button class="notification-close">&times;</button>
            </div>
        `;
        
        // Add styles if not already added
        if (!document.getElementById('notification-styles')) {
            const styles = document.createElement('style');
            styles.id = 'notification-styles';
            styles.textContent = `
                .notification {
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: white;
                    border-radius: 8px;
                    padding: 1rem 1.25rem;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 9999;
                    animation: slideInRight 0.3s ease;
                    max-width: 350px;
                    border-left: 4px solid #3b82f6;
                }
                .notification.success {
                    border-left-color: #10b981;
                }
                .notification.error {
                    border-left-color: #ef4444;
                }
                .notification.warning {
                    border-left-color: #f59e0b;
                }
                .notification-content {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                }
                .notification-content i {
                    font-size: 1.2rem;
                }
                .notification.success .notification-content i {
                    color: #10b981;
                }
                .notification.error .notification-content i {
                    color: #ef4444;
                }
                .notification.warning .notification-content i {
                    color: #f59e0b;
                }
                .notification-content span {
                    flex: 1;
                    font-size: 0.9rem;
                }
                .notification-close {
                    background: none;
                    border: none;
                    font-size: 1.5rem;
                    cursor: pointer;
                    color: #6b7280;
                    line-height: 1;
                    padding: 0 0.3rem;
                }
                .notification-close:hover {
                    color: #1f2937;
                }
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(styles);
        }
        
        // Add to page
        document.body.appendChild(notification);
        
        // Add close event
        notification.querySelector('.notification-close').addEventListener('click', () => {
            notification.remove();
        });
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 5000);
    }

    // Get Notification Icon
    function getNotificationIcon(type) {
        switch(type) {
            case 'success': return 'check-circle';
            case 'error': return 'exclamation-circle';
            case 'warning': return 'exclamation-triangle';
            default: return 'info-circle';
        }
    }

    // Show Error
    function showError(elementId, message) {
        const element = document.getElementById(elementId);
        if (element) {
            element.textContent = message;
            element.classList.add('show');
        }
    }

    // Clear Errors
    function clearErrors(formType) {
        const errorElements = document.querySelectorAll(`.error-message[id$="${formType}Error"]`);
        errorElements.forEach(element => {
            element.textContent = '';
            element.classList.remove('show');
        });
    }

    // Validate Email
    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }

    // Validate Phone
    function validatePhone(phone) {
        const re = /^\+?[\d\s\-\(\)]+$/;
        return re.test(phone);
    }

    // Make functions globally available
    window.showPage = showPage;
    window.switchAuthTab = switchAuthTab;
    window.swapLocations = swapLocations;
    window.setDestination = setDestination;
    window.toggleMobileMenu = toggleMobileMenu;
// ÙÙŠ Ù‚Ø³Ù… State Management Ø£Ø¶Ù:

// ÙÙŠ showUserMenu function:
function showUserMenu() {
    const authButtons = document.getElementById('authButtons');
    const userMenu = document.getElementById('userMenu');
    
    if (authButtons) {
        authButtons.style.display = 'none';
        authButtons.classList.add('hidden');
    }
    
    if (userMenu) {
        userMenu.style.display = 'block';
        userMenu.classList.remove('hidden');
    }
    
    isLoggedIn = true;
}


// ÙÙŠ setupEventListeners function Ø£Ø¶Ù:
// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
document.addEventListener('click', function(event) {
    const userMenu = document.getElementById('userMenu');
    const userDropdown = document.getElementById('userDropdown');
    const userMenuBtn = document.getElementById('userMenuBtn');
    
    if (userMenu && userDropdown && userMenuBtn) {
        if (!userMenu.contains(event.target) && !userMenuBtn.contains(event.target)) {
            userDropdown.style.display = 'none';
        }
    }
});

// ÙÙŠ Toggle User Dropdown function:
function toggleUserDropdown() {
    const dropdown = document.getElementById('userDropdown');
    if (dropdown) {
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    }
}
// ============================================
// EMAIL VALIDATION FUNCTIONS
// ============================================

// Check if email already exists
function checkEmailExists(email) {
    const users = JSON.parse(localStorage.getItem('ethiofly_users')) || [];
    return users.some(user => user.email.toLowerCase() === email.toLowerCase());
}

// Validate email format
function validateEmailFormat(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
}

// Real-time email validation
function setupEmailValidation() {
    const signupEmailInput = document.getElementById('signupEmail');
    
    if (signupEmailInput) {
        // Check on input change
        signupEmailInput.addEventListener('blur', function() {
            validateEmailOnBlur(this.value);
        });
        
        // Real-time validation
        signupEmailInput.addEventListener('input', function() {
            validateEmailOnInput(this.value);
        });
    }
}

// Validate email on blur (when user leaves the field)
function validateEmailOnBlur(email) {
    const emailError = document.getElementById('signupEmailError');
    
    if (!email) {
        showError('signupEmailError', 'Email address is required');
        return false;
    }
    
    if (!validateEmailFormat(email)) {
        showError('signupEmailError', 'Please enter a valid email address');
        return false;
    }
    
    if (checkEmailExists(email)) {
        showError('signupEmailError', 'This email is already registered. Please login instead.');
        return false;
    }
    
    // Clear error if valid
    clearError('signupEmailError');
    return true;
}

// Real-time email validation on input
function validateEmailOnInput(email) {
    const emailError = document.getElementById('signupEmailError');
    
    if (!email) {
        clearError('signupEmailError');
        return;
    }
    
    if (!validateEmailFormat(email)) {
        showError('signupEmailError', 'Please enter a valid email address');
        return;
    }
    
    // Only check for existing email after they've typed a valid format
    if (validateEmailFormat(email) && checkEmailExists(email)) {
        showError('signupEmailError', 'This email is already registered');
        return;
    }
    
    // Clear error if valid
    clearError('signupEmailError');
}

// Show error message
function showError(elementId, message) {
    const element = document.getElementById(elementId);
    if (element) {
        element.textContent = message;
        element.style.display = 'block';
        element.style.color = '#ef4444'; // Red color for error
        element.style.fontSize = '0.85rem';
        element.style.marginTop = '0.25rem';
    }
}
// Toggle password visibility
function togglePasswordVisibility(inputId) {
    const input = document.getElementById(inputId);
    const toggleBtn = input.nextElementSibling;
    const icon = toggleBtn.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.className = 'fas fa-eye-slash';
        toggleBtn.setAttribute('aria-label', 'Hide password');
    } else {
        input.type = 'password';
        icon.className = 'fas fa-eye';
        toggleBtn.setAttribute('aria-label', 'Show password');
    }
}

// Check if user exists and show appropriate message
function checkUserExists(email) {
    const users = JSON.parse(localStorage.getItem('ethiofly_users')) || [];
    return users.find(u => u.email.toLowerCase() === email.toLowerCase());
}

// Auto-focus password field when email is entered
function setupLoginFormEvents() {
    const loginEmail = document.getElementById('loginEmail');
    const loginPassword = document.getElementById('loginPassword');
    
    if (loginEmail && loginPassword) {
        loginEmail.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loginPassword.focus();
            }
        });
        
        // Real-time email validation
        loginEmail.addEventListener('blur', function() {
            const email = this.value.trim();
            if (email && !validateEmailFormat(email)) {
                showError('loginEmailError', 'Please enter a valid email address');
            } else {
                clearError('loginEmailError');
            }
        });
    }
}

// Password strength checker (for signup)
function checkPasswordStrength(password) {
    const strength = {
        score: 0,
        message: '',
        color: '#ef4444' // red
    };
    
    // Length check
    if (password.length >= 8) strength.score += 1;
    if (password.length >= 12) strength.score += 1;
    
    // Complexity checks
    if (/[A-Z]/.test(password)) strength.score += 1; // Has uppercase
    if (/[a-z]/.test(password)) strength.score += 1; // Has lowercase
    if (/\d/.test(password)) strength.score += 1;    // Has number
    if (/[^A-Za-z0-9]/.test(password)) strength.score += 1; // Has special char
    
    // Set message and color based on score
    if (strength.score <= 2) {
        strength.message = 'Weak password';
        strength.color = '#ef4444'; // red
    } else if (strength.score <= 4) {
        strength.message = 'Moderate password';
        strength.color = '#f59e0b'; // yellow
    } else {
        strength.message = 'Strong password';
        strength.color = '#10b981'; // green
    }
    
    return strength;
}

// Update password strength indicator in real-time
function setupPasswordStrengthIndicator() {
    const passwordInput = document.getElementById('signupPassword');
    const strengthIndicator = document.createElement('div');
    strengthIndicator.className = 'password-strength';
    strengthIndicator.innerHTML = `
        <div class="strength-meter">
            <div class="strength-bar"></div>
        </div>
        <div class="strength-text"></div>
    `;
    
    if (passwordInput && passwordInput.parentNode) {
        passwordInput.parentNode.appendChild(strengthIndicator);
        
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            const strength = checkPasswordStrength(password);
            const strengthBar = strengthIndicator.querySelector('.strength-bar');
            const strengthText = strengthIndicator.querySelector('.strength-text');
            
            // Update bar width and color
            const width = Math.min((strength.score / 6) * 100, 100);
            strengthBar.style.width = width + '%';
            strengthBar.style.backgroundColor = strength.color;
            
            // Update text
            strengthText.textContent = password ? strength.message : '';
            strengthText.style.color = strength.color;
        });
    }
}
// ============================================
// COMPARISON MODAL - MISSING FUNCTIONS
// ============================================

// Generate comparison modal HTML
function createComparisonModalHTML(flight, providers, totalPassengers, travelClass) {
    const currencySymbol = getCurrencySymbol(currentCurrency);
    
    return `
        <div class="comparison-modal-overlay" onclick="closeComparisonModal()">
            <div class="comparison-modal" onclick="event.stopPropagation()">
                <!-- Modal Header -->
                <div class="comparison-modal-header">
                    <div class="comparison-flight-info">
                        <div class="flight-route-large">
                            ${flight.departureCode || ''} â†’ ${flight.arrivalCode || ''}
                        </div>
                        <div class="flight-details-small">
                            ${flight.departureDate || 'Today'} â€¢ ${flight.duration || '14h 30m'} â€¢ 
                            ${flight.cabinClass ? flight.cabinClass + ' â€¢ ' : ''}${totalPassengers} passenger${totalPassengers > 1 ? 's' : ''}
                        </div>
                    </div>
                    <button class="comparison-close-btn" onclick="closeComparisonModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Modal Content -->
                <div class="comparison-modal-content">
                    <!-- Providers Comparison Table -->
                    <div class="providers-comparison">
                        ${providers.map((provider, index) => `
                            <div class="provider-card ${index === 0 ? 'provider-best' : ''}">
                                <div class="provider-header">
                                    <div class="provider-logo-container">
                                        <img src="${provider.logo}" alt="${provider.name}" class="provider-logo"
                                             onerror="this.onerror=null; this.src='https://i.postimg.cc/L6sR9Bvr/20260110-010256.png';">
                                    </div>
                                    <div class="provider-name-rating">
                                        <div class="provider-name">${provider.name}</div>
                                        <div class="provider-rating">
                                            <i class="fas fa-star"></i> ${provider.rating}
                                            <span class="reviews">${provider.reviews}</span>
                                        </div>
                                    </div>
                                    ${provider.badge ? `
                                        <div class="provider-badge" style="background: ${provider.badgeColor}">
                                            ${provider.badge}
                                        </div>
                                    ` : ''}
                                </div>
                                
                                <div class="provider-price-section">
                                    <div class="provider-price">
                                        <span class="currency-symbol">${currencySymbol}</span>
                                        <span class="price-amount">${formatNumber(provider.price)}</span>
                                        <span class="per-person">per person</span>
                                    </div>
                                    ${totalPassengers > 1 ? `
                                        <div class="total-price">
                                            Total: <strong>${currencySymbol}${formatNumber(provider.price * totalPassengers)}</strong>
                                        </div>
                                    ` : ''}
                                </div>
                                
                                <div class="provider-features">
                                    <ul>
                                        ${provider.features.map(feature => `
                                            <li><i class="fas fa-check"></i> ${feature}</li>
                                        `).join('')}
                                    </ul>
                                </div>
                                
                                <div class="provider-actions">
                                    <button class="btn-provider-book" 
                                            onclick="handleProviderBooking(
                                                '${flight.id}', 
                                                '${provider.name}', 
                                                ${provider.price}, 
                                                '${provider.deepLink.type}', 
                                                '${encodeURIComponent(provider.deepLink.url || '#')}'
                                            )">
                                        <i class="fas fa-shopping-cart"></i>
                                        Book with ${provider.name}
                                    </button>
                                </div>
                                
                                ${index === 0 ? `
                                    <div class="best-value-ribbon">
                                        <i class="fas fa-crown"></i> BEST VALUE
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Price Comparison Chart -->
                    <div class="price-comparison-chart">
                        <div class="chart-header">
                            <h4><i class="fas fa-chart-bar"></i> Price Comparison</h4>
                            <div class="chart-legend">
                                <span class="legend-item"><span class="legend-color" style="background: #10b981"></span> EthioFly</span>
                                <span class="legend-item"><span class="legend-color" style="background: #ef4444"></span> Expedia</span>
                                <span class="legend-item"><span class="legend-color" style="background: #3b82f6"></span> Aviasales</span>
                            </div>
                        </div>
                        <div class="chart-bars">
                            ${providers.map((provider, index) => {
                                const maxPrice = Math.max(...providers.map(p => p.price));
                                const percentage = (provider.price / maxPrice) * 100;
                                const barHeight = 60 - (percentage / 100) * 50; // Invert for better visual
                                
                                let barColor = '#10b981';
                                if (provider.name === 'Expedia') barColor = '#ef4444';
                                if (provider.name === 'Aviasales') barColor = '#3b82f6';
                                
                                return `
                                    <div class="chart-bar-container">
                                        <div class="chart-bar" style="height: ${barHeight}px; background: ${barColor}"></div>
                                        <div class="chart-label">${provider.name}</div>
                                        <div class="chart-value">${currencySymbol}${formatNumber(provider.price)}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <!-- Additional Info -->
                    <div class="comparison-info">
                        <div class="info-card">
                            <i class="fas fa-shield-alt"></i>
                            <div>
                                <strong>Booking Protection</strong>
                                <p>All bookings include 24/7 customer support and flexible cancellation policies</p>
                            </div>
                        </div>
                        <div class="info-card">
                            <i class="fas fa-clock"></i>
                            <div>
                                <strong>Price Guarantee</strong>
                                <p>Found a better price? Contact us within 24 hours for a price match</p>
                            </div>
                        </div>
                        <div class="info-card">
                            <i class="fas fa-headset"></i>
                            <div>
                                <strong>Ethiopian Support</strong>
                                <p>Get support in Amharic from our Ethiopian customer service team</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="comparison-modal-footer">
                    <button class="btn-secondary" onclick="closeComparisonModal()">
                        <i class="fas fa-times"></i> Close
                    </button>
                    <button class="btn-primary" onclick="bookFlightNow('${flight.id}', 'EthioFly', ${providers[0].price}, '${currentCurrency}')">
                        <i class="fas fa-shopping-cart"></i> Book with EthioFly (Best Price)
                    </button>
                </div>
            </div>
        </div>
    `;
}

// Setup comparison modal events
function setupComparisonModalEvents(modalContainer) {
    // Escape key to close modal
    const escapeHandler = (e) => {
        if (e.key === 'Escape') {
            closeComparisonModal();
        }
    };
    
    document.addEventListener('keydown', escapeHandler);
    
    // Store handler reference for cleanup
    modalContainer._escapeHandler = escapeHandler;
    
    // Prevent body scroll
    document.body.style.overflow = 'hidden';
    
    // Focus on modal for accessibility
    const modal = modalContainer.querySelector('.comparison-modal');
    if (modal) {
        modal.setAttribute('tabindex', '-1');
        modal.focus();
    }
}

// Add comparison modal styles
function addComparisonModalStyles() {
    if (document.getElementById('comparison-modal-styles')) return;
    
    const styles = document.createElement('style');
    styles.id = 'comparison-modal-styles';
    
    styles.textContent = `
        /* Comparison Modal Styles */
        .comparison-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        .comparison-modal {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            overflow: hidden;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Modal Header */
        .comparison-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            background: linear-gradient(135deg, var(--primary), var(--info));
            color: white;
        }
        
        .comparison-flight-info {
            flex: 1;
        }
        
        .flight-route-large {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .flight-details-small {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .comparison-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .comparison-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Modal Content */
        .comparison-modal-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }
        
        /* Providers Comparison */
        .providers-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .provider-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .provider-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .provider-card.provider-best {
            border-color: var(--success);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.15);
        }
        
        .provider-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .provider-logo-container {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
            padding: 5px;
        }
        
        .provider-logo {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .provider-name-rating {
            flex: 1;
        }
        
        .provider-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .provider-rating {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: var(--gray);
        }
        
        .provider-rating i {
            color: #fbbf24;
        }
        
        .reviews {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .provider-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
        }
        
        /* Price Section */
        .provider-price-section {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .provider-price {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 8px;
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 2px;
        }
        
        .currency-symbol {
            font-size: 18px;
            color: var(--primary);
        }
        
        .per-person {
            font-size: 12px;
            color: var(--gray);
            margin-left: 8px;
            font-weight: 400;
        }
        
        .total-price {
            font-size: 14px;
            color: var(--gray);
        }
        
        /* Features List */
        .provider-features ul {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
        }
        
        .provider-features li {
            padding: 6px 0;
            font-size: 14px;
            color: var(--dark);
            display: flex;
            align-items: center;
        }
        
        .provider-features li i {
            color: var(--success);
            margin-right: 10px;
            font-size: 12px;
        }
        
        /* Book Button */
        .btn-provider-book {
            background: linear-gradient(135deg, var(--primary), var(--info));
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-provider-book:hover {
            background: linear-gradient(135deg, var(--info), var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        
        /* Best Value Ribbon */
        .best-value-ribbon {
            position: absolute;
            top: 10px;
            right: -8px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 6px 20px;
            font-size: 12px;
            font-weight: 600;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }
        
        .best-value-ribbon:before {
            content: '';
            position: absolute;
            left: 0;
            bottom: -8px;
            border-left: 8px solid #b45309;
            border-right: 8px solid transparent;
            border-bottom: 8px solid transparent;
        }
        
        .best-value-ribbon i {
            margin-right: 5px;
        }
        
        /* Price Chart */
        .price-comparison-chart {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #e5e7eb;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-header h4 {
            margin: 0;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-header h4 i {
            color: var(--primary);
        }
        
        .chart-legend {
            display: flex;
            gap: 15px;
            font-size: 12px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        
        .chart-bars {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 100px;
            padding: 20px 0;
            gap: 30px;
        }
        
        .chart-bar-container {
            text-align: center;
            flex: 1;
        }
        
        .chart-bar {
            width: 30px;
            margin: 0 auto;
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease;
        }
        
        .chart-label {
            margin-top: 10px;
            font-size: 12px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .chart-value {
            font-size: 11px;
            color: var(--gray);
            margin-top: 4px;
        }
        
        /* Additional Info */
        .comparison-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .info-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .info-card i {
            color: var(--primary);
            font-size: 20px;
            margin-top: 2px;
        }
        
        .info-card strong {
            display: block;
            margin-bottom: 4px;
            color: var(--dark);
        }
        
        .info-card p {
            margin: 0;
            font-size: 13px;
            color: var(--gray);
        }
        
        /* Modal Footer */
        .comparison-modal-footer {
            padding: 20px 24px;
            background: #f8fafc;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .providers-comparison {
                grid-template-columns: 1fr;
            }
            
            .comparison-modal {
                max-height: 95vh;
            }
            
            .comparison-modal-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .comparison-close-btn {
                align-self: flex-end;
                margin-top: -40px;
            }
            
            .chart-bars {
                flex-direction: column;
                height: auto;
                align-items: center;
            }
            
            .chart-bar-container {
                width: 100%;
                display: flex;
                align-items: center;
                gap: 15px;
            }
            
            .chart-bar {
                width: 100%;
                height: 30px;
                border-radius: 4px;
            }
            
            .comparison-info {
                grid-template-columns: 1fr;
            }
        }

/* Mobile optimizations for flight results */
@media (max-width: 480px) {
    .sort-tabs { display:flex; gap:0.5rem; margin-top:8px; }
    .sort-tab { flex:1; padding:8px 10px; border-radius:999px; background:rgba(15,23,42,0.05); border:none; font-weight:600; font-size:0.95rem; }
    .sort-tab.active { background:white; box-shadow: var(--shadow); color: var(--primary-dark); }

    .quick-filters { overflow-x:auto; padding:8px 0; gap:0.5rem; }
    .quick-filter-btn { white-space:nowrap; padding:8px 12px; border-radius:999px; font-weight:600; }

    .flight-card { border-radius:14px; padding:1rem; margin-bottom:1rem; }
    .flight-header { align-items:flex-start; gap:10px; }
    .header-price { margin-left:auto; text-align:right; }
    .header-price-amount { font-weight:700; font-size:1.05rem; color: var(--dark); }
    .header-badge { background:#d1fae5; color:#065f46; padding:4px 8px; border-radius:8px; font-size:0.75rem; margin-top:6px; }

    .flight-details-grid { grid-template-columns: 1fr; gap: 8px; padding-top:0.5rem; }
    .flight-time-block { display:flex; justify-content:space-between; align-items:center; padding:0.5rem 0; background:transparent; }
    .time-large { font-size:1.4rem; }
    .airport-code { font-size:0.9rem; }
    .stop-badge-container { margin-top:8px; }

    .flight-price-section { background: transparent; padding:0; margin-top:0.5rem; display:block; }
    .btn-select-flight { width:100%; padding:14px 16px; border-radius:12px; background: linear-gradient(135deg,#0d9488,#065f46); color:white; font-weight:700; border:none; box-shadow:0 6px 18px rgba(6,95,70,0.18); }

    .flight-meta { display:none; }
    .action-buttons { display:flex; gap:8px; margin-top:8px; }
    .action-buttons .btn { flex:1; }
}
    `;
    
    document.head.appendChild(styles);
}

   </script>

<script>
// Mobile menu toggle
document.addEventListener('DOMContentLoaded', function() {
    const hamburger = document.getElementById('hamburgerBtn');
    const nav = document.getElementById('navLinks');
    if (!hamburger || !nav) return;

    function closeMenu() {
        nav.classList.remove('open');
        hamburger.setAttribute('aria-expanded', 'false');
        hamburger.innerHTML = '<i class="fas fa-bars"></i>';
    }

    hamburger.addEventListener('click', function() {
        const expanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', String(!expanded));
        nav.classList.toggle('open');
        this.innerHTML = nav.classList.contains('open') ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
    });

    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', () => {
            if (nav.classList.contains('open')) closeMenu();
        });
    });

    window.addEventListener('resize', () => {
        if (window.innerWidth > 900 && nav.classList.contains('open')) closeMenu();
    });
});
</script>

<!-- Bottom Navigation (mobile) -->
<nav class="bottom-nav" role="navigation" aria-label="Bottom navigation">
    <a href="#" class="bn-item active" data-page="flights"><i class="fas fa-plane"></i><span>Flights</span></a>
    <a href="#" class="bn-item" data-page="hotels"><i class="fas fa-hotel"></i><span>Hotels</span></a>
    <a href="#" class="bn-item" data-page="profile"><i class="fas fa-user"></i><span>Profile</span></a>
</nav>

<!-- Floating Filter FAB -->
<button class="filter-fab" id="filterFab" aria-label="Filters">
    <i class="fas fa-filter"></i>
</button>




<script>
// Bottom nav: navigate and set active
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.bottom-nav a').forEach(a => {
        a.addEventListener('click', function(e){
            e.preventDefault();
            const page = this.dataset.page;
            if (page) showPage(page);
            document.querySelectorAll('.bottom-nav a').forEach(x => x.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // Filter FAB toggles quick filters visibility and scrolls to it
    const fab = document.getElementById('filterFab');
    const qfContainer = document.getElementById('quickFiltersContainer');
    if (fab && qfContainer) {
        fab.addEventListener('click', function() {
            const q = qfContainer.querySelector('.quick-filters');
            if (q) {
                const isHidden = q.style.display === 'none' || window.getComputedStyle(q).display === 'none';
                q.style.display = isHidden ? 'flex' : 'none';
                if (!isHidden) {
                    q.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    window.scrollTo({ top: qfContainer.offsetTop - 60, behavior: 'smooth' });
                }
            }
        });
    }
});
</script>
<!-- Example: Fetch users from backend SQL database and display in frontend -->
<script>
async function fetchUsers() {
    try {
        const response = await fetch('/api/users');
        const users = await response.json();
        const userList = document.getElementById('userList');
        userList.innerHTML = '';
        users.forEach(user => {
            const li = document.createElement('li');
            li.textContent = `${user.id}: ${user.email} (${user.firstName} ${user.lastName})`;
            userList.appendChild(li);
        });
    } catch (err) {
        console.error('Error fetching users:', err);
    }
}
// Call fetchUsers when the page loads
window.addEventListener('DOMContentLoaded', fetchUsers);
    // Dashboard Tab Switching
    function switchDashboardTab(tabName) {
        // Update tabs
        document.querySelectorAll('.dashboard-nav-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.tab === tabName) {
                btn.classList.add('active');
            }
        });
        
        // Update content
        document.querySelectorAll('.dashboard-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        document.getElementById(tabName + '-tab').classList.add('active');
    }
    
    // Initialize dashboard tabs
    document.addEventListener('DOMContentLoaded', function() {
        // User dashboard tabs
        document.querySelectorAll('#user-dashboard-page .dashboard-nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                switchDashboardTab(this.dataset.tab);
            });
        });
        
        // Admin dashboard tabs
        document.querySelectorAll('#admin-dashboard-page .dashboard-nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                switchDashboardTab(this.dataset.tab);
            });
        });
    });
    
    // Update login handler to redirect to appropriate dashboard
    async function handleLogin(e) {
        e.preventDefault();
        
        const accountType = document.getElementById('accountType').value;
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        // After successful login...
        if (accountType === 'admin') {
            showPage('admin-dashboard');
        } else {
            showPage('user-dashboard');
        }
    }
document.addEventListener("DOMContentLoaded", () => {
    restoreResultsAfterRefresh();
});

function restoreResultsAfterRefresh() {

    // âœ… Restore ONLY if user is still in same session
    if (sessionStorage.getItem("onResultsPage") !== "yes") {
        return; // Don't restore results after closing/reopening website
    }

    const savedFlights = JSON.parse(
        localStorage.getItem("ethiofly_flights") || "[]"
    );

    const savedSearchData = JSON.parse(
        localStorage.getItem("ethiofly_search_data") || "{}"
    );

    if (savedFlights.length > 0) {

        currentFlights = savedFlights;

        // âœ… Show results container
        document.getElementById("searchResults").classList.remove("hidden");

        // Display flights
        displayFlightResults(currentFlights, savedSearchData);
    }
}
function updatePrices(currencyCode) {
  const currency = SUPPORTED_CURRENCIES.find(
    (c) => c.code === currencyCode
  );

  if (!currency) return;

  document.querySelectorAll(".flight-price").forEach((el) => {
    // Keydi original USD haddii uusan jirin
    if (!el.dataset.usd) {
      el.dataset.usd = parseFloat(
        el.innerText.replace(/[^0-9.]/g, "")
      );
    }

    const usdAmount = parseFloat(el.dataset.usd);

    const converted = usdAmount * currency.rate;

    el.innerText = `${currency.symbol} ${converted.toFixed(2)}`;
  });
}

// Dropdown event
document.getElementById("currencySelect").addEventListener("change", (e) => {
  updatePrices(e.target.value);
});

// Default load USD
updatePrices("USD");

</script>
</body>
</html>
